{
  if (partitionsDone.contains(partitionName)) {
    return;
  }
  Set<Long> shardIds=partitionInfo.getShardIds();
  if (shardsDone.keySet().containsAll(shardIds)) {
    ImmutableMap.Builder<Long,String> builder=ImmutableMap.builder();
    for (    Long shardId : shardIds) {
      builder.put(shardId,shardsDone.get(shardId));
    }
    shardManager.commitPartition(tableWriterNode.getTable(),partitionName,partitionInfo.getPartitionKeys(),builder.build());
    checkState(shardsInFlight.addAndGet(-shardIds.size()) >= 0,"shards in flight crashed into the ground");
    partitionsDone.add(partitionName);
  }
}
