{
  GroupBy groupBy=new GroupBy(newGroupColumn());
  PipelinedAggregation aggregation=new PipelinedAggregation(new TupleInfo(SIZE_OF_BYTE,SIZE_OF_LONG),groupBy,new ForwardingSeekableIterator<>(newAggregateColumn()),new Provider<AggregationFunction>(){
    @Override public AggregationFunction get(){
      return new SumAggregation();
    }
  }
);
  List<Pair> expected=ImmutableList.of(new Pair(0,createTuple("a",10L)),new Pair(1,createTuple("b",17L)),new Pair(2,createTuple("c",15L)),new Pair(3,createTuple("d",6L)));
  List<Pair> actual=new ArrayList<>();
  while (aggregation.hasNext()) {
    ValueBlock block=aggregation.next();
    PeekingIterator<Pair> pairs=block.pairIterator();
    while (pairs.hasNext()) {
      Pair pair=pairs.next();
      actual.add(pair);
    }
  }
  Assert.assertEquals(actual,expected);
}
