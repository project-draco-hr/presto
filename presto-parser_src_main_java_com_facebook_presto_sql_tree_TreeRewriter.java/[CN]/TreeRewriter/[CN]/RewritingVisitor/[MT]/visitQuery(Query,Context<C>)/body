{
  if (!context.isDefaultRewrite()) {
    Node result=nodeRewriter.rewriteQuery(node,context.get(),TreeRewriter.this);
    if (result != null) {
      return result;
    }
  }
  With with=null;
  if (node.getWith().isPresent()) {
    with=rewrite(node.getWith().get(),context.get());
  }
  QueryBody queryBody=rewrite(node.getQueryBody(),context.get());
  ImmutableList.Builder<SortItem> orderBy=ImmutableList.builder();
  for (  SortItem sortItem : node.getOrderBy()) {
    orderBy.add(rewrite(sortItem,context.get()));
  }
  if ((with != node.getWith().orNull()) || (queryBody != node.getQueryBody()) || !sameElements(orderBy.build(),node.getOrderBy())) {
    return new Query(Optional.fromNullable(with),queryBody,orderBy.build(),node.getLimit());
  }
  return node;
}
