{
  RowExpression result=new Visitor(types,typeManager,session.getTimeZoneKey()).process(expression,null);
  Preconditions.checkNotNull(result,"translated expression is null");
  if (optimize) {
    ExpressionOptimizer optimizer=new ExpressionOptimizer(functionRegistry,typeManager,session);
    return optimizer.optimize(result);
  }
  return result;
}
