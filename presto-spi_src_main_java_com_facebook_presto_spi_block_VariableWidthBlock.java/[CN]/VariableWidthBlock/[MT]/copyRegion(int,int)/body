{
  int positionCount=getPositionCount();
  if (positionOffset < 0 || length < 0 || positionOffset + length > positionCount) {
    throw new IndexOutOfBoundsException("Invalid position " + positionOffset + " in block with "+ positionCount+ " positions");
  }
  SliceOutput newOffsets=Slices.allocate((length * SIZE_OF_INT) + SIZE_OF_INT).getOutput();
  newOffsets.appendInt(0);
  int sliceLength=0;
  for (int position=positionOffset; position < positionOffset + length; position++) {
    sliceLength+=getLength(position);
    newOffsets.appendInt(sliceLength);
  }
  Slice newSlice=Slices.copyOf(slice,getPositionOffset(positionOffset),sliceLength);
  Slice newValueIsNull=Slices.copyOf(valueIsNull,positionOffset,length);
  return new VariableWidthBlock(length,newSlice,newOffsets.slice(),newValueIsNull);
}
