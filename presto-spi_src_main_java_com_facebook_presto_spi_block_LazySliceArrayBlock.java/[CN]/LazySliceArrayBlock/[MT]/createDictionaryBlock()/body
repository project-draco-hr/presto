{
  if (!dictionary) {
    throw new IllegalStateException("cannot create dictionary block");
  }
  if (isNull == null) {
    return new DictionaryBlock(getPositionCount(),new SliceArrayBlock(values.length,values),wrappedIntArray(ids));
  }
  boolean hasNulls=false;
  int[] newIds=Arrays.copyOf(ids,ids.length);
  for (int position=0; position < positionCount; position++) {
    if (isEntryNull(position)) {
      hasNulls=true;
      newIds[position]=values.length;
    }
  }
  Slice[] newValues=hasNulls ? Arrays.copyOf(values,values.length + 1) : values;
  return new DictionaryBlock(getPositionCount(),new SliceArrayBlock(newValues.length,newValues),wrappedIntArray(newIds));
}
