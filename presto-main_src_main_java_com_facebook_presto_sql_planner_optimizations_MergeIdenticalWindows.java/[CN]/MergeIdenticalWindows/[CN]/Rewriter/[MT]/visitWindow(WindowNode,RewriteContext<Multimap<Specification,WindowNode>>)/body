{
  checkState(!node.getHashSymbol().isPresent(),"MergeIdenticalWindows should be run before HashGenerationOptimizer");
  checkState(node.getPrePartitionedInputs().isEmpty() && node.getPreSortedOrderPrefix() == 0,"MergeIdenticalWindows should be run before AddExchanges");
  return context.rewrite(node.getSource(),ImmutableListMultimap.<Specification,WindowNode>builder().put(node.getSpecification(),node).putAll(context.get()).build());
}
