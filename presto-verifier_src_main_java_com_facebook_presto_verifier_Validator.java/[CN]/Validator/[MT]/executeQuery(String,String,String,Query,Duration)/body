{
  try (Connection connection=DriverManager.getConnection(url,username,password)){
    connection.setClientInfo("ApplicationName","verifier-test-" + queryPair.getName());
    connection.setCatalog(query.getCatalog());
    connection.setSchema(query.getSchema());
    long start=System.nanoTime();
    try (Statement statement=connection.createStatement()){
      TimeLimiter limiter=new SimpleTimeLimiter();
      Stopwatch stopwatch=Stopwatch.createStarted();
      Statement limitedStatement=limiter.newProxy(statement,Statement.class,timeout.toMillis(),TimeUnit.MILLISECONDS);
      try (final ResultSet resultSet=limitedStatement.executeQuery(query.getQuery())){
        List<List<Object>> results=limiter.callWithTimeout(getResultSetConverter(resultSet),timeout.toMillis() - stopwatch.elapsed(TimeUnit.MILLISECONDS),TimeUnit.MILLISECONDS,true);
        return new QueryResult(State.SUCCESS,null,nanosSince(start),results);
      }
 catch (      SQLException|VerifierException e) {
        throw e;
      }
catch (      UncheckedTimeoutException e) {
        throw new SQLTimeoutException(e);
      }
catch (      InterruptedException e) {
        Thread.currentThread().interrupt();
        throw Throwables.propagate(e);
      }
catch (      Exception e) {
        throw Throwables.propagate(e);
      }
    }
   }
 catch (  SQLException e) {
    Exception exception=e;
    if (("Error executing query".equals(e.getMessage()) || "Error fetching results".equals(e.getMessage())) && (e.getCause() instanceof Exception)) {
      exception=(Exception)e.getCause();
    }
    State state=isPrestoQueryInvalid(e) ? State.INVALID : State.FAILED;
    return new QueryResult(state,exception,null,null);
  }
catch (  VerifierException e) {
    return new QueryResult(State.TOO_MANY_ROWS,e,null,null);
  }
}
