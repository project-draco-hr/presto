{
  if (step == Step.FINAL) {
    aggregation.addIntermediate(page.getBlock(intermediateChannel));
  }
 else {
    aggregation.addInput(page);
  }
  if (!memoryManager.canUse(aggregation.getEstimatedSize())) {
    throw new ExceededMemoryLimitException(memoryManager.getMaxMemorySize());
  }
}
