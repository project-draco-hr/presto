{
  if (step == Step.FINAL) {
    for (int i=0; i < blockCursors.length; i++) {
      blockCursors[i]=page.getBlock(inputs.get(i).getChannel()).cursor();
    }
    while (advanceAll(blockCursors)) {
      intermediateValue=function.addIntermediate(blockCursors,fields,intermediateValue);
    }
  }
 else {
    for (int i=0; i < blocks.length; i++) {
      blocks[i]=page.getBlock(inputs.get(i).getChannel());
    }
    intermediateValue=function.addInput(page.getPositionCount(),blocks,fields,intermediateValue);
  }
}
