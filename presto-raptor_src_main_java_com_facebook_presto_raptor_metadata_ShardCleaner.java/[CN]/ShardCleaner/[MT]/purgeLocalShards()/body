{
  while (!Thread.currentThread().isInterrupted()) {
    List<UUID> uuids=dao.getPurgableShardNodesBatch(currentNode,maxTimestamp(localPurgeTime));
    if (uuids.isEmpty()) {
      break;
    }
    long start=System.nanoTime();
    for (    UUID uuid : uuids) {
      deleteFile(storageService.getStorageFile(uuid));
    }
    dao.updatePurgedShardNodes(uuids,getCurrentNodeId());
    log.info("Purged %s local shards in %s",uuids.size(),nanosSince(start));
  }
}
