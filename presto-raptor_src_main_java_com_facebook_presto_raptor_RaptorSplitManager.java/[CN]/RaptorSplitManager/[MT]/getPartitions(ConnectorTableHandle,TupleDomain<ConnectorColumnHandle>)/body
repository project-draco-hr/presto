{
  Stopwatch partitionTimer=Stopwatch.createStarted();
  checkType(tableHandle,RaptorTableHandle.class,"table");
  ConnectorTableMetadata tableMetadata=metadata.getTableMetadata(tableHandle);
  checkState(tableMetadata != null,"no metadata for %s found",tableHandle);
  Set<TablePartition> tablePartitions=shardManager.getPartitions(tableHandle);
  log.debug("Partition retrieval, raptor table %s (%d partitions): %dms",tableHandle,tablePartitions.size(),partitionTimer.elapsed(TimeUnit.MILLISECONDS));
  Multimap<String,? extends PartitionKey> allPartitionKeys=shardManager.getAllPartitionKeys(tableHandle);
  Map<String,ConnectorColumnHandle> columnHandles=metadata.getColumnHandles(tableHandle);
  log.debug("Partition key retrieval, raptor table %s (%d keys): %dms",tableHandle,allPartitionKeys.size(),partitionTimer.elapsed(TimeUnit.MILLISECONDS));
  List<ConnectorPartition> partitions=ImmutableList.copyOf(transform(tablePartitions,partitionMapper(allPartitionKeys,columnHandles)));
  log.debug("Partition generation, raptor table %s (%d partitions): %dms",tableHandle,partitions.size(),partitionTimer.elapsed(TimeUnit.MILLISECONDS));
  return new ConnectorPartitionResult(partitions,tupleDomain);
}
