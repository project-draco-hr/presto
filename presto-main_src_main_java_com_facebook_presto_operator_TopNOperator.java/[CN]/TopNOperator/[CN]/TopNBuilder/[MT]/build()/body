{
  ImmutableList.Builder<RandomAccessBlock[]> minSortedGlobalCandidates=ImmutableList.builder();
  long sampleWeight=1;
  while (!globalCandidates.isEmpty()) {
    RandomAccessBlock[] row=globalCandidates.remove();
    if (sampleWeightChannel.isPresent()) {
      if (globalCandidates.peek() != null && row == globalCandidates.peek()) {
        sampleWeight++;
      }
 else {
        row[sampleWeightChannel.get()]=createBigintBlock(sampleWeight);
        minSortedGlobalCandidates.add(row);
        sampleWeight=1;
      }
    }
 else {
      minSortedGlobalCandidates.add(row);
    }
  }
  return minSortedGlobalCandidates.build().reverse().iterator();
}
