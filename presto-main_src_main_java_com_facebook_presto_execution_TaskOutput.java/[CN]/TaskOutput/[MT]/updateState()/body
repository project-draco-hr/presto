{
  TaskState overallState=taskState.get();
  if (!overallState.isDone()) {
    Map<String,BufferState> outputBufferStates=getOutputBufferStates();
    if (Iterables.any(outputBufferStates.values(),equalTo(BufferState.FAILED))) {
      taskState.set(TaskState.FAILED);
      finishAllBuffers();
    }
 else     if (Iterables.all(outputBufferStates.values(),equalTo(BufferState.FINISHED))) {
      taskState.set(TaskState.FINISHED);
    }
  }
  stats.setBufferedPages(getBufferedPageCount());
}
