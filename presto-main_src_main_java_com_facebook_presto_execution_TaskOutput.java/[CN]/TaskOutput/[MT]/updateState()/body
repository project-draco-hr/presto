{
  TaskState overallState=taskState.get();
  if (!overallState.isDone()) {
    ImmutableList<BufferState> bufferStates=ImmutableList.copyOf(transform(outputBuffers.values(),stateGetter()));
    if (Iterables.any(bufferStates,equalTo(BufferState.FAILED))) {
      taskState.set(TaskState.FAILED);
      stats.recordEnd();
      finishAllBuffers();
    }
 else     if (Iterables.all(bufferStates,equalTo(BufferState.FINISHED))) {
      taskState.set(TaskState.FINISHED);
      stats.recordEnd();
    }
  }
}
