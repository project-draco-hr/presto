{
  while (true) {
    TaskState taskState=this.taskState.get();
    if (taskState.isDone()) {
      return;
    }
    if (this.taskState.compareAndSet(taskState,TaskState.CANCELED)) {
      stats.recordEnd();
      break;
    }
  }
  finishAllBuffers();
  updateState();
}
