{
  updateFinishedState();
  List<SplitExecutionStats> splitStats=null;
  if (full) {
    ImmutableList.Builder<SplitExecutionStats> builder=ImmutableList.builder();
    for (    OperatorStats activeSplit : activeSplits) {
      builder.add(activeSplit.snapshot());
    }
    splitStats=builder.build();
  }
  SharedBufferInfo sharedBufferInfo=sharedBuffer.getInfo();
synchronized (this) {
    TaskState state=getState();
    List<FailureInfo> failures=ImmutableList.of();
    if (state == TaskState.FAILED) {
      failures=toFailures(failureCauses);
    }
    DateTime lastHeartbeat=DateTime.now();
    return new TaskInfo(taskId,nextTaskInfoVersion.getAndIncrement(),state,location,lastHeartbeat,sharedBufferInfo,getNoMoreSplits(),taskContext.getTaskStats(),failures,getOutputs());
  }
}
