{
  TableMetadata tableMetadata=metadata.getTable(table.getName());
  if (tableMetadata == null) {
    throw new SemanticException(table,"Cannot resolve table '%s'",table.getName());
  }
  ImmutableList.Builder<Field> fields=ImmutableList.builder();
  for (  ColumnMetadata column : tableMetadata.getColumns()) {
    QualifiedName prefix=QualifiedName.of(tableMetadata.getCatalogName(),tableMetadata.getSchemaName(),tableMetadata.getTableName());
    Symbol symbol=context.getSymbolAllocator().newSymbol(column.getName(),Type.fromRaw(column.getType()));
    fields.add(new Field(Optional.of(prefix),Optional.of(column.getName()),symbol,Type.fromRaw(column.getType())));
  }
  TupleDescriptor descriptor=new TupleDescriptor(fields.build());
  context.registerTable(table,descriptor);
  return descriptor;
}
