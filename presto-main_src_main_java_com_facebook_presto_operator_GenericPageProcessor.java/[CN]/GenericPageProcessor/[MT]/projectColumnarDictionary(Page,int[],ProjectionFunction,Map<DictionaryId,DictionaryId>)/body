{
  Block outputDictionary=projectDictionary(projection,inputPage);
  int[] outputIds=filterIds(projection,inputPage,selectedPositions);
  int inputChannel=getOnlyElement(projection.getInputChannels());
  DictionaryBlock dictionaryBlock=(DictionaryBlock)inputPage.getBlock(inputChannel);
  DictionaryId sourceId=dictionarySourceIds.get(dictionaryBlock.getDictionarySourceId());
  if (sourceId == null) {
    sourceId=randomDictionaryId();
    dictionarySourceIds.put(dictionaryBlock.getDictionarySourceId(),sourceId);
  }
  return new DictionaryBlock(selectedPositions.length,outputDictionary,wrappedIntArray(outputIds),false,sourceId);
}
