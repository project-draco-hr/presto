{
  UUID shardUuid=columnFileHandle.getShardUuid();
  File shardPath=getShardPath(baseStorageDir,shardUuid);
  ImmutableList.Builder<Iterable<Block>> sourcesBuilder=ImmutableList.builder();
  ColumnFileHandle.Builder builder=ColumnFileHandle.builder(shardUuid,blockEncodingSerde);
  for (  Map.Entry<ConnectorColumnHandle,File> entry : columnFileHandle.getFiles().entrySet()) {
    File file=entry.getValue();
    RaptorColumnHandle columnHandle=checkType(entry.getKey(),RaptorColumnHandle.class,"columnHandle");
    if (file.length() > 0) {
      Slice slice=mappedFileCache.getUnchecked(file.getAbsoluteFile());
      checkState(file.length() == slice.length(),"File %s, length %s was mapped to Slice length %s",file.getAbsolutePath(),file.length(),slice.length());
      File outputFile=getColumnFile(shardPath,columnHandle);
      Files.createParentDirs(outputFile);
      Files.move(file,outputFile);
      builder.addExistingColumn(columnHandle,outputFile);
    }
 else {
      File outputFile=getColumnFile(shardPath,columnHandle);
      builder.addExistingColumn(columnHandle,outputFile);
    }
  }
  List<Iterable<Block>> sources=sourcesBuilder.build();
  ColumnFileHandle targetFileHandle=builder.build();
  if (!sources.isEmpty()) {
    importData(new RaptorPageSource(sources),targetFileHandle);
  }
  targetFileHandle.commit();
  return targetFileHandle;
}
