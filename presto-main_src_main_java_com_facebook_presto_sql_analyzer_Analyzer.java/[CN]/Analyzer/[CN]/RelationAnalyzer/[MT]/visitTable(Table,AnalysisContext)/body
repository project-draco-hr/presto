{
  QualifiedTableName name=MetadataUtil.createQualifiedTableName(session,table.getName());
  TableMetadata tableMetadata=metadata.getTable(name);
  if (tableMetadata == null) {
    throw new SemanticException(table,"Table %s does not exist",name);
  }
  ImmutableList.Builder<Field> fields=ImmutableList.builder();
  for (  ColumnMetadata column : tableMetadata.getColumns()) {
    QualifiedName prefix=QualifiedName.of(tableMetadata.getTable().getCatalogName(),tableMetadata.getTable().getSchemaName(),tableMetadata.getTable().getTableName());
    Symbol symbol=context.getSymbolAllocator().newSymbol(column.getName(),Type.fromRaw(column.getType()));
    Preconditions.checkArgument(column.getColumnHandle().isPresent(),"Column doesn't have a handle");
    fields.add(new Field(Optional.of(prefix),Optional.of(column.getName()),column.getColumnHandle(),symbol,Type.fromRaw(column.getType())));
  }
  TupleDescriptor descriptor=new TupleDescriptor(fields.build());
  context.registerTable(table,descriptor,tableMetadata);
  return descriptor;
}
