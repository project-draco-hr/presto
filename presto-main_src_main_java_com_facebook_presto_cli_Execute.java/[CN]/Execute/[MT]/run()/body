{
  AnsiConsole.systemInstall();
  Main.initializeLogging(false);
  ExecutorService executor=Executors.newCachedThreadPool();
  HttpQueryClient queryClient=null;
  try {
    ApacheHttpClient httpClient=new ApacheHttpClient(new HttpClientConfig().setConnectTimeout(new Duration(1,TimeUnit.DAYS)).setReadTimeout(new Duration(10,TimeUnit.DAYS)));
    queryClient=new HttpQueryClient(query,server,httpClient,executor,codecFactory.jsonCodec(QueryInfo.class),codecFactory.jsonCodec(TaskInfo.class));
    out().print("\n");
    StatusPrinter statusPrinter=new StatusPrinter(queryClient,out());
    statusPrinter.printInitialStatusUpdates();
    QueryInfo queryInfo=queryClient.getQueryInfo();
    if (queryInfo.getState().isDone()) {
      if (queryInfo.getState() == QueryState.CANCELED) {
        AnsiConsole.out().printf("Query %s was canceled\n",queryInfo.getQueryId());
      }
 else       if (queryInfo.getState() == QueryState.FAILED) {
        renderFailure(queryInfo,AnsiConsole.out());
      }
 else {
        AnsiConsole.out().printf("Query %s finished with no output\n",queryInfo.getQueryId());
      }
    }
 else {
      Operator operator=queryClient.getResultsOperator();
      List<String> fieldNames=queryInfo.getFieldNames();
      OutputStats stats=pageOutput(operator,fieldNames);
      statusPrinter.printFinalInfo(stats);
    }
  }
  finally {
    if (!debug && queryClient != null) {
      queryClient.destroy();
    }
    executor.shutdownNow();
  }
}
