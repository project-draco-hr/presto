{
  Main.initializeLogging(false);
  ExecutorService executor=Executors.newCachedThreadPool();
  HttpQueryProvider queryProvider=null;
  try {
    long start=System.nanoTime();
    ApacheHttpClient httpClient=new ApacheHttpClient(new HttpClientConfig().setConnectTimeout(new Duration(1,TimeUnit.MINUTES)).setReadTimeout(new Duration(30,TimeUnit.MINUTES)));
    queryProvider=new HttpQueryProvider(createStaticBodyGenerator(query,Charsets.UTF_8),Optional.<String>absent(),httpClient,executor,server);
    try {
      for (QueryInfo queryInfo=queryProvider.getQueryInfo(); queryInfo.getState() == State.PREPARING; queryInfo=queryProvider.getQueryInfo()) {
        System.err.print("\r" + toInfoString(queryInfo,start));
        System.err.flush();
        Uninterruptibles.sleepUninterruptibly(50,TimeUnit.MILLISECONDS);
      }
    }
  finally {
      System.err.printf("%-" + maxInfoString + "s\r","");
      System.err.flush();
      System.err.print("\r");
    }
    QueryDriversOperator operator=new QueryDriversOperator(10,queryProvider);
    ConsolePrinter consolePrinter=new ConsolePrinter(operator,new DelimitedTuplePrinter());
    long outputPositions=0;
    long outputDataSize=0;
    for (    Page page : consolePrinter) {
      outputPositions+=page.getPositionCount();
      outputDataSize+=page.getDataSize().toBytes();
    }
    System.err.println(toFinalInfo(queryProvider.getQueryInfo(),start,outputPositions,outputDataSize));
  }
  finally {
    if (queryProvider != null) {
      queryProvider.destroy();
    }
    executor.shutdownNow();
  }
}
