{
  Preconditions.checkNotNull(types,"types is null");
  Preconditions.checkArgument(!types.isEmpty(),"types is empty");
  this.types=ImmutableList.copyOf(types);
  int[] offsets=new int[types.size() + 1];
  int currentOffset=0;
  for (int i=0; i < types.size(); i++) {
    Type type=types.get(i);
    if (type.isFixedSize()) {
      offsets[i]=currentOffset;
      currentOffset+=type.getSize();
    }
  }
  boolean hasVariableLengthFields=false;
  int firstVariableLengthField=-1;
  int secondVariableLengthField=-1;
  for (int i=0; i < types.size(); i++) {
    Type type=types.get(i);
    if (!type.isFixedSize()) {
      offsets[i]=currentOffset;
      if (hasVariableLengthFields) {
        currentOffset+=SIZE_OF_SHORT;
        if (secondVariableLengthField == -1) {
          secondVariableLengthField=i;
        }
      }
 else {
        firstVariableLengthField=i;
      }
      hasVariableLengthFields=true;
    }
  }
  if (secondVariableLengthField == -1) {
    secondVariableLengthField=types.size();
  }
  offsets[offsets.length - 1]=currentOffset;
  if (hasVariableLengthFields) {
    size=-1;
  }
 else {
    size=currentOffset;
  }
  fixedSizePart=currentOffset + SIZE_OF_SHORT;
  this.firstVariableLengthField=firstVariableLengthField;
  this.secondVariableLengthField=secondVariableLengthField;
  this.offsets=ImmutableList.copyOf(Ints.asList(offsets));
}
