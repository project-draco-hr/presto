{
  AtomicBoolean success=new AtomicBoolean();
  IndexSourceRewriter indexSourceRewriter=new IndexSourceRewriter(indexManager,symbolAllocator,idAllocator,metadata,session);
  PlanNode rewritten=PlanRewriter.rewriteWith(indexSourceRewriter,planNode,new Context(lookupSymbols,success));
  if (success.get()) {
    return Optional.of(rewritten);
  }
  return Optional.empty();
}
