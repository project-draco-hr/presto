{
  Set<Symbol> probeLookupSymbols=FluentIterable.from(context.get().getLookupSymbols()).filter(in(node.getProbeSource().getOutputSymbols())).toSet();
  if (probeLookupSymbols.isEmpty()) {
    return node;
  }
  PlanNode rewrittenProbeSource=context.rewrite(node.getProbeSource(),new Context(probeLookupSymbols,context.get().getSuccess()));
  PlanNode source=node;
  if (rewrittenProbeSource != node.getProbeSource()) {
    source=new IndexJoinNode(node.getId(),node.getType(),rewrittenProbeSource,node.getIndexSource(),node.getCriteria(),node.getProbeHashSymbol(),node.getIndexHashSymbol());
  }
  return source;
}
