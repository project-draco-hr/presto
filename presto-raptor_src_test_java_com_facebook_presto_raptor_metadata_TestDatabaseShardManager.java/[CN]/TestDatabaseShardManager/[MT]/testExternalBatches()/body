{
  long tableId=1;
  Optional<String> externalBatchId=Optional.of("foo");
  List<ShardNode> shards=ImmutableList.of(new ShardNode(UUID.randomUUID(),"node1"));
  shardManager.commitTable(tableId,shards,externalBatchId);
  shards=ImmutableList.of(new ShardNode(UUID.randomUUID(),"node1"));
  try {
    shardManager.commitTable(tableId,shards,externalBatchId);
    fail("expected external batch exception");
  }
 catch (  PrestoException e) {
    assertEquals(e.getErrorCode(),RAPTOR_EXTERNAL_BATCH_ALREADY_EXISTS.toErrorCode());
  }
}
