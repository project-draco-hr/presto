{
  checkArgument(valueChannel != -1,"Raw input is not allowed for a final aggregation");
  groupedState.ensureCapacity(groupIdsBlock.getGroupCount());
  List<Block> values=ImmutableList.of(page.getBlock(valueChannel));
  Block masks=maskChannel.transform(page.blockGetter()).orNull();
  Block sampleWeights=sampleWeightChannel.transform(page.blockGetter()).orNull();
  for (int position=0; position < groupIdsBlock.getPositionCount(); position++) {
    long sampleWeight=ApproximateUtils.computeSampleWeight(masks,sampleWeights,position);
    if (sampleWeight == 0) {
      continue;
    }
    if (anyIsNull(values,position)) {
      continue;
    }
    groupedState.setGroupId(groupIdsBlock.getGroupId(position));
    processInput(state,values,position,sampleWeight);
  }
}
