{
  tempDir=Files.createTempDir();
  Map<String,String> serverProperties=ImmutableMap.<String,String>builder().put("node.environment","testing").put("static.db.location",tempDir.getAbsolutePath()).build();
  Injector serverInjector=Guice.createInjector(Stage.DEVELOPMENT,new MBeanModule(),new NodeModule(),new TestingHttpServerModule(),new JsonModule(),new JaxrsModule(),new DiscoveryServerModule(),new DiscoveryModule(),new ConfigurationModule(new ConfigurationFactory(serverProperties)),new Module(){
    @Override public void configure(    Binder binder){
      binder.bind(MBeanServer.class).toInstance(new TestingMBeanServer());
    }
  }
);
  server=serverInjector.getInstance(TestingHttpServer.class);
  try {
    server.start();
  }
 catch (  Exception e) {
    try {
      server.stop();
    }
 catch (    Exception ignored) {
    }
    FileUtils.deleteRecursively(tempDir);
    throw e;
  }
}
