{
  if (node.getPartitionBy().isEmpty()) {
    return planSimpleNodeWithProperties(node,parentPreference);
  }
  PlanWithProperties child=planAndEnforce(node.getSource(),parentPreference.withHashSymbol(node,node.getPartitionBy()));
  Symbol hashSymbol=child.getRequiredHashSymbol(node.getPartitionBy());
  return new PlanWithProperties(new RowNumberNode(idAllocator.getNextId(),child.getNode(),node.getPartitionBy(),node.getRowNumberSymbol(),node.getMaxRowCountPerPartition(),Optional.of(hashSymbol)),child.getHashSymbols());
}
