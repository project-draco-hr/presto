{
  RaptorTableHandle handle=checkType(tableHandle,RaptorTableHandle.class,"tableHandle");
  long tableId=handle.getTableId();
  ImmutableList.Builder<RaptorColumnHandle> columnHandles=ImmutableList.builder();
  ImmutableList.Builder<Type> columnTypes=ImmutableList.builder();
  for (  TableColumn column : dao.getTableColumns(tableId)) {
    columnHandles.add(new RaptorColumnHandle(connectorId,column.getColumnName(),column.getColumnId(),column.getDataType()));
    columnTypes.add(column.getDataType());
  }
  long transactionId=shardManager.beginTransaction();
  setTransactionId(transactionId);
  Optional<String> externalBatchId=getExternalBatchId(session);
  List<RaptorColumnHandle> sortColumnHandles=getSortColumnHandles(tableId);
  List<RaptorColumnHandle> bucketColumnHandles=getBucketColumnHandles(tableId);
  return new RaptorInsertTableHandle(connectorId,transactionId,tableId,columnHandles.build(),columnTypes.build(),externalBatchId,sortColumnHandles,nCopies(sortColumnHandles.size(),ASC_NULLS_FIRST),handle.getBucketCount(),bucketColumnHandles);
}
