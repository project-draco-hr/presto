{
  if (!isOptimizedReaderEnabled(session,enabled)) {
    return Optional.absent();
  }
  @SuppressWarnings("deprecation") Deserializer deserializer=getDeserializer(schema);
  RcFileBlockLoader blockLoader;
  if (deserializer instanceof LazyBinaryColumnarSerDe) {
    blockLoader=new RcBinaryBlockLoader(DateTimeZone.forID(session.getTimeZoneKey().getId()));
  }
 else   if (deserializer instanceof ColumnarSerDe) {
    blockLoader=new RcTextBlockLoader(hiveStorageTimeZone,DateTimeZone.forID(session.getTimeZoneKey().getId()));
  }
 else {
    return Optional.absent();
  }
  List<HiveColumnHandle> readColumns=ImmutableList.copyOf(filter(columns,not(isPartitionKeyPredicate())));
  ArrayList<Integer> readHiveColumnIndexes=new ArrayList<>(transform(readColumns,hiveColumnIndexGetter()));
  ColumnProjectionUtils.appendReadColumns(configuration,readHiveColumnIndexes);
  configuration.set(IOConstants.COLUMNS,Joiner.on(',').join(Iterables.transform(readColumns,HiveColumnHandle.nameGetter())));
  for (  String name : schema.stringPropertyNames()) {
    if (name.startsWith("serialization.")) {
      configuration.set(name,schema.getProperty(name));
    }
  }
  RCFile.Reader recordReader;
  try {
    FileSystem fileSystem=path.getFileSystem(configuration);
    int bufferSize=configuration.getInt(IO_FILE_BUFFER_SIZE_KEY,4096);
    recordReader=new RCFile.Reader(fileSystem,path,bufferSize,configuration,start,length);
  }
 catch (  Exception e) {
    throw Throwables.propagate(e);
  }
  try {
    return Optional.of(new RcFilePageSource(recordReader,blockLoader,schema,partitionKeys,columns,hiveStorageTimeZone,typeManager));
  }
 catch (  Exception e) {
    try {
      recordReader.close();
    }
 catch (    Exception ignored) {
    }
    throw Throwables.propagate(e);
  }
}
