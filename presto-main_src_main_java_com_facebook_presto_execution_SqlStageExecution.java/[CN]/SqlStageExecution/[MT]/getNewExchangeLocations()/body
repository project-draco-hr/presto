{
  Multimap<PlanNodeId,URI> exchangeLocations=this.exchangeLocations.get();
  ImmutableMultimap.Builder<PlanNodeId,URI> newExchangeLocations=ImmutableMultimap.builder();
  for (  RemoteSourceNode remoteSourceNode : fragment.getRemoteSourceNodes()) {
    for (    PlanFragmentId planFragmentId : remoteSourceNode.getSourceFragmentIds()) {
      StageExecutionNode subStage=subStages.get(planFragmentId);
      checkState(subStage != null,"Unknown sub stage %s, known stages %s",planFragmentId,subStages.keySet());
      for (      URI taskLocation : subStage.getTaskLocations()) {
        if (!exchangeLocations.containsEntry(remoteSourceNode.getId(),taskLocation)) {
          newExchangeLocations.putAll(remoteSourceNode.getId(),taskLocation);
        }
      }
    }
  }
  return newExchangeLocations.build();
}
