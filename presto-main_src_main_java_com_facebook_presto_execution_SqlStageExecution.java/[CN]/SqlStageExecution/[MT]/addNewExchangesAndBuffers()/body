{
  Preconditions.checkState(!Thread.holdsLock(this),"Can not add exchanges or buffers to tasks while holding a lock on this");
  while (!getState().isDone()) {
    boolean done=exchangesAndBuffersComplete();
    Multimap<PlanNodeId,URI> exchangeLocations=getExchangeLocations();
    Set<String> outputBuffers=getOutputBuffers();
    for (    RemoteTask task : tasks) {
      task.addExchangeLocations(exchangeLocations,done);
      task.addOutputBuffers(outputBuffers,done);
    }
    if (done) {
      return;
    }
    waitForMoreData(exchangeLocations,outputBuffers);
  }
}
