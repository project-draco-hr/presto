{
  Preconditions.checkState(!Thread.holdsLock(this),"Can not cancel while holding a lock on this");
synchronized (this) {
    if (stageState.get().isDone()) {
      return;
    }
    log.debug("Cancelling stage %s",stageId);
    transitionToState(StageState.CANCELED);
  }
  cancelAll();
}
