{
  if (!subStages.isEmpty()) {
    nodeSelector.lockDownNodes();
    for (    Node node : Sets.difference(new HashSet<>(nodeSelector.allNodes()),localNodeTaskMap.keySet())) {
      RemoteTask remoteTask=scheduleTask(nextTaskId.getAndIncrement(),node);
      addStageNode(remoteTask.getTaskInfo().getTaskId());
    }
    setNoMoreStageNodes();
  }
synchronized (this) {
    try {
      TimeUnit.MILLISECONDS.timedWait(this,100);
    }
 catch (    InterruptedException e) {
      Thread.currentThread().interrupt();
      throw Throwables.propagate(e);
    }
  }
  addNewExchangesAndBuffers();
}
