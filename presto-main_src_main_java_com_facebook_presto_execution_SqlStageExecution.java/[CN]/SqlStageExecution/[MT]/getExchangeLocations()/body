{
  ImmutableMultimap.Builder<PlanNodeId,URI> exchangeLocations=ImmutableMultimap.builder();
  for (  PlanNode planNode : fragment.getSources()) {
    if (planNode instanceof ExchangeNode) {
      ExchangeNode exchangeNode=(ExchangeNode)planNode;
      for (      PlanFragmentId planFragmentId : exchangeNode.getSourceFragmentIds()) {
        StageExecutionNode subStage=subStages.get(planFragmentId);
        Preconditions.checkState(subStage != null,"Unknown sub stage %s, known stages %s",planFragmentId,subStages.keySet());
        exchangeLocations.putAll(exchangeNode.getId(),subStage.getTaskLocations());
      }
    }
  }
  return exchangeLocations.build();
}
