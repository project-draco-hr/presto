{
  while (true) {
    TaskState currentState=taskStateMachine.getState();
    if (maxWait.toMillis() <= 1 || currentState.isDone()) {
      return maxWait;
    }
    maxWait=taskStateMachine.waitForStateChange(currentState,maxWait);
  }
}
