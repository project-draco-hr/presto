{
  PlanNode rewrittenSource=planRewriter.rewrite(node.getSource(),null);
  if (rewrittenSource == node.getSource() && context == null) {
    return node;
  }
  long count=node.getCount();
  Optional<Symbol> sampleWeight=node.getSampleWeight();
  if (context != null) {
    count=Math.min(count,context.getCount());
    if (context.getSampleWeight().isPresent()) {
      checkState(sampleWeight.isPresent() && sampleWeight.equals(context.getSampleWeight()),"limit and topN sample weight symbols don't match");
    }
  }
  return new TopNNode(node.getId(),rewrittenSource,count,node.getOrderBy(),node.getOrderings(),node.isPartial(),sampleWeight);
}
