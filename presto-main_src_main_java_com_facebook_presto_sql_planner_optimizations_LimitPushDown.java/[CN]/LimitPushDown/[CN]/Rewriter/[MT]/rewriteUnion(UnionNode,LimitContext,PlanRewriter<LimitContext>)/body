{
  List<Symbol> sampleWeights=null;
  if (context != null && context.getSampleWeight().isPresent()) {
    sampleWeights=node.getSymbolMapping().get(context.getSampleWeight().get());
  }
  List<PlanNode> sources=new ArrayList<>();
  for (int i=0; i < node.getSources().size(); i++) {
    LimitContext rewrittenContext=context;
    if (sampleWeights != null) {
      rewrittenContext=new LimitContext(context.getCount(),Optional.of(sampleWeights.get(i)));
    }
    sources.add(planRewriter.rewrite(node.getSources().get(i),rewrittenContext));
  }
  PlanNode output=new UnionNode(node.getId(),sources,node.getSymbolMapping());
  if (context != null) {
    output=new LimitNode(idAllocator.getNextId(),output,context.getCount(),context.getSampleWeight());
  }
  return output;
}
