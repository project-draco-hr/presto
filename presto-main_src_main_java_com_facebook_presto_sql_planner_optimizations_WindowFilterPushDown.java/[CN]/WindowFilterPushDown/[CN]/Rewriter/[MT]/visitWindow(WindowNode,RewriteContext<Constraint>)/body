{
  if (canOptimizeWindowFunction(node)) {
    PlanNode rewrittenSource=context.rewrite(node.getSource(),null);
    Optional<Integer> limit=getLimit(node,context.get());
    if (node.getOrderBy().isEmpty()) {
      return new RowNumberNode(idAllocator.getNextId(),rewrittenSource,node.getPartitionBy(),getOnlyElement(node.getWindowFunctions().keySet()),limit,Optional.empty());
    }
    if (limit.isPresent()) {
      return new TopNRowNumberNode(idAllocator.getNextId(),rewrittenSource,node.getPartitionBy(),node.getOrderBy(),node.getOrderings(),getOnlyElement(node.getWindowFunctions().keySet()),limit.get(),false,Optional.empty());
    }
  }
  return context.defaultRewrite(node);
}
