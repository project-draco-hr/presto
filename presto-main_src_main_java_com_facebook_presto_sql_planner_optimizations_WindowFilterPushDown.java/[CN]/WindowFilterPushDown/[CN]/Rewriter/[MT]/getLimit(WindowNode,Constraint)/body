{
  if (filter == null || (!filter.getLimit().isPresent() && !filter.getFilterExpression().isPresent())) {
    return Optional.empty();
  }
  if (filter.getLimit().isPresent()) {
    return filter.getLimit();
  }
  if (filterContainsWindowFunctions(node,filter.getFilterExpression().get())) {
    Symbol rowNumberSymbol=getOnlyElement(node.getWindowFunctions().entrySet()).getKey();
    TupleDomain<Symbol> tupleDomain=fromPredicate(metadata,session,filter.getFilterExpression().get(),types).getTupleDomain();
    if (tupleDomain.isNone()) {
      return Optional.empty();
    }
    Domain domain=tupleDomain.getDomains().get(rowNumberSymbol);
    if (domain != null) {
      return getRowNumberUpperBound(domain.getRanges());
    }
  }
  return Optional.empty();
}
