{
  HdfsOrcDataSource orcDataSource;
  try {
    FileSystem fileSystem=path.getFileSystem(configuration);
    long size=fileSystem.getFileStatus(path).getLen();
    FSDataInputStream inputStream=fileSystem.open(path);
    orcDataSource=new HdfsOrcDataSource(path.toString(),inputStream,size);
  }
 catch (  Exception e) {
    throw Throwables.propagate(e);
  }
  ImmutableSet.Builder<Integer> includedColumns=ImmutableSet.builder();
  ImmutableList.Builder<ColumnReference<HiveColumnHandle>> columnReferences=ImmutableList.builder();
  for (  HiveColumnHandle column : columns) {
    if (!column.isPartitionKey()) {
      includedColumns.add(column.getHiveColumnIndex());
      Type type=typeManager.getType(column.getTypeSignature());
      columnReferences.add(new ColumnReference<>(column,column.getHiveColumnIndex(),type));
    }
  }
  OrcPredicate predicate=new TupleDomainOrcPredicate<>(tupleDomain,columnReferences.build());
  try {
    OrcReader reader=new OrcReader(orcDataSource,metadataReader);
    OrcRecordReader recordReader=reader.createRecordReader(includedColumns.build(),predicate,start,length,hiveStorageTimeZone,DateTimeZone.forID(session.getTimeZoneKey().getId()));
    return new OrcPageSource(recordReader,orcDataSource,partitionKeys,columns,hiveStorageTimeZone,typeManager);
  }
 catch (  Exception e) {
    try {
      orcDataSource.close();
    }
 catch (    IOException ignored) {
    }
    throw Throwables.propagate(e);
  }
}
