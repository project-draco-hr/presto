{
  checkNotNull(tupleStream,"tupleStream is null");
  checkState(!finished,"already finished");
  if (!initialized) {
    UncompressedTupleInfoSerde.serialize(tupleStream.getTupleInfo(),sliceOutput);
    initialized=true;
  }
  Cursor cursor=tupleStream.cursor();
  while (cursor.advanceNextPosition()) {
    if (currentStartPosition == -1) {
      currentStartPosition=cursor.getPosition();
    }
    cursor.getTuple().writeTo(buffer);
    tupleCount++;
    if (buffer.size() >= MAX_BLOCK_SIZE) {
      write(sliceOutput,currentStartPosition,tupleCount,buffer.slice());
      tupleCount=0;
      buffer=new DynamicSliceOutput(MAX_BLOCK_SIZE);
      currentStartPosition=-1;
    }
  }
  return this;
}
