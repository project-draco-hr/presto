{
  Preconditions.checkArgument(pageBufferMax > 0,"blockBufferMax must be at least 1");
  this.pageBufferMax=pageBufferMax;
  int processors=Runtime.getRuntime().availableProcessors();
  queryExecutor=new ThreadPoolExecutor(1000,1000,1,TimeUnit.MINUTES,new LinkedBlockingQueue<Runnable>(),threadsNamed("query-processor-%d"));
  shardExecutor=new ThreadPoolExecutor(processors,processors,1,TimeUnit.MINUTES,new SynchronousQueue<Runnable>(),threadsNamed("shard-query-processor-%d"),new ThreadPoolExecutor.CallerRunsPolicy());
  this.importClientFactory=importClientFactory;
  this.importManager=importManager;
  this.metadata=metadata;
  this.dataStreamProvider=dataStreamProvider;
  this.splitManager=splitManager;
  this.queryFragmentRequestJsonCodec=queryFragmentRequestJsonCodec;
  this.sourceHashManager=new SourceHashManager(queryExecutor);
}
