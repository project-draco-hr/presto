{
  Preconditions.checkNotNull(query,"query is null");
  Preconditions.checkArgument(query.length() > 0,"query must not be empty string");
  String queryId=String.valueOf(nextQueryId++);
  final QueryState queryState=new QueryState(1,blockBufferMax);
  ImmutableList<String> strings=ImmutableList.copyOf(Splitter.on(":").split(query));
  String queryBase=strings.get(0);
  Runnable queryTask;
switch (queryBase) {
case "sum":
    queryTask=new SumQuery(queryState,executor,URI.create("http://localhost:8080/v1/presto/query"),URI.create("http://localhost:8080/v1/presto/query"),URI.create("http://localhost:8080/v1/presto/query"),URI.create("http://localhost:8080/v1/presto/query"),URI.create("http://localhost:8080/v1/presto/query"),URI.create("http://localhost:8080/v1/presto/query"),URI.create("http://localhost:8080/v1/presto/query"),URI.create("http://localhost:8080/v1/presto/query"),URI.create("http://localhost:8080/v1/presto/query"),URI.create("http://localhost:8080/v1/presto/query"),URI.create("http://localhost:8080/v1/presto/query"),URI.create("http://localhost:8080/v1/presto/query"),URI.create("http://localhost:8080/v1/presto/query"),URI.create("http://localhost:8080/v1/presto/query"),URI.create("http://localhost:8080/v1/presto/query"),URI.create("http://localhost:8080/v1/presto/query"));
  break;
case "sum-partial":
queryTask=new PartialSumQuery(queryState);
break;
case "import-delimited":
List<Type> types=ImmutableList.copyOf(Iterables.transform(Splitter.on(",").split(strings.get(2)),new Function<String,Type>(){
@Override public Type apply(String input){
return Type.fromName(input);
}
}
));
TupleInfo tupleInfo=new TupleInfo(types);
queryTask=new ImportDelimited(queryState,storageManager,strings.get(1),strings.get(2),tupleInfo,new File(strings.get(3)),Splitter.on(strings.get(4)));
break;
case "import-hive-table":
queryTask=new ImportHiveTableQuery(queryState,hiveClient,executor,strings.get(1),strings.get(2));
break;
case "import-hive-table-partition":
queryTask=new ImportHiveTablePartitionQuery(queryState,hiveImportManager,strings.get(1),strings.get(2),strings.get(3));
break;
default :
throw new IllegalArgumentException("Unsupported query " + query);
}
queries.put(queryId,queryState);
executor.submit(queryTask);
return queryId;
}
