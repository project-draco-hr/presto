{
  this.queryId=queryId;
  this.taskScheduler=taskScheduler;
  this.sessionMetadata=sessionMetadata;
  try {
    Statement statement=SqlParser.createStatement(sql);
    Analyzer analyzer=new Analyzer(this.sessionMetadata);
    AnalysisResult analysis=analyzer.analyze(statement);
    Planner planner=new Planner();
    PlanNode plan=planner.plan((Query)statement,analysis);
    FragmentPlanner fragmentPlanner=new FragmentPlanner(this.sessionMetadata);
    List<PlanFragment> fragments=fragmentPlanner.createFragments(plan,analysis.getSymbolAllocator(),false);
    DistributedExecutionPlanner distributedPlanner=new DistributedExecutionPlanner(nodeManager,splitManager);
    outputStage=distributedPlanner.plan(fragments);
  }
 catch (  Exception e) {
    throw Throwables.propagate(e);
  }
}
