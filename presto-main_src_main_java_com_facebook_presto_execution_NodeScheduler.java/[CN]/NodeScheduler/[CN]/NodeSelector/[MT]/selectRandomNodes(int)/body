{
  checkArgument(limit > 0,"limit must be at least 1");
  List<Node> selected=new ArrayList<>(limit);
  for (  Node node : lazyShuffle(nodeMap.get().get().getNodesByHostAndPort().values())) {
    if (includeCoordinator || !coordinatorNodeId.equals(node.getNodeIdentifier())) {
      selected.add(node);
    }
    if (selected.size() >= limit) {
      break;
    }
  }
  if (doubleScheduling) {
    int uniqueNodes=selected.size();
    int i=0;
    while (selected.size() < limit) {
      if (i >= uniqueNodes) {
        i=0;
      }
      selected.add(selected.get(i));
      i++;
    }
  }
  return selected;
}
