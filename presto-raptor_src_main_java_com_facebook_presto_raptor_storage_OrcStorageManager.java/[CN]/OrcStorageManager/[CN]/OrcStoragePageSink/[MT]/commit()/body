{
  checkState(!committed,"already committed");
  committed=true;
  flush();
  for (  ShardInfo shard : shards) {
    writeShard(shard.getShardUuid());
  }
  return ImmutableList.copyOf(shards);
}
