{
  for (; remainingPositions > 0 && !pageBuilder.isFull(); remainingPositions--) {
    for (    BlockCursor cursor : cursors) {
      checkState(cursor.advanceNextPosition());
    }
    long repeats=rand.nextPoisson(sampleRatio);
    if (rescaled && repeats > 0) {
      repeats*=rand.nextPoisson(1.0 / sampleRatio);
    }
    if (repeats > 0) {
      for (int i=0; i < cursors.length; i++) {
        cursors[i].appendTo(pageBuilder.getBlockBuilder(i));
      }
      pageBuilder.getBlockBuilder(sampleWeightChannel).append(repeats);
    }
  }
  if (pageBuilder.isFull() || (finishing && !pageBuilder.isEmpty())) {
    Page page=pageBuilder.build();
    pageBuilder.reset();
    return page;
  }
  return null;
}
