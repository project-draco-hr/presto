{
  outputBuffers=outputBuffers.withBuffer("out",new UnpartitionedPagePartitionFunction()).withNoMoreBufferIds();
  taskExecution.addResultQueue(outputBuffers);
  BufferResult bufferResult=taskExecution.getResults("out",0,new DataSize(1,Unit.MEGABYTE),new Duration(0,TimeUnit.MILLISECONDS));
  assertFalse(bufferResult.isBufferClosed());
  bufferResult=taskExecution.getResults("out",0,new DataSize(1,Unit.MEGABYTE),new Duration(0,TimeUnit.MILLISECONDS));
  assertFalse(bufferResult.isBufferClosed());
  taskExecution.addSources(ImmutableList.of(new TaskSource(tableScanNodeId,ImmutableSet.<ScheduledSplit>of(),true)));
  assertEquals(taskExecution.getTaskInfo(false).getState(),TaskState.FINISHED);
  bufferResult=taskExecution.getResults("out",0,new DataSize(1,Unit.MEGABYTE),new Duration(500,TimeUnit.MILLISECONDS));
  assertTrue(bufferResult.isBufferClosed());
  bufferResult=taskExecution.getResults("out",0,new DataSize(1,Unit.MEGABYTE),new Duration(500,TimeUnit.MILLISECONDS));
  assertTrue(bufferResult.isBufferClosed());
}
