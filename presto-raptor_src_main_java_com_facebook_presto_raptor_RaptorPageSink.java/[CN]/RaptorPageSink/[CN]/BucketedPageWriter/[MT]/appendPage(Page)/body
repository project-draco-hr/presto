{
  Block[] blocks=new Block[bucketFields.length];
  for (int i=0; i < bucketFields.length; i++) {
    blocks[i]=page.getBlock(bucketFields[i]);
  }
  Page bucketArgs=new Page(page.getPositionCount(),blocks);
  for (int position=0; position < page.getPositionCount(); position++) {
    int bucket=bucketFunction.getBucket(bucketArgs,position);
    PageStore store=pageStores.get(bucket);
    if (store == null) {
      PageBuffer buffer=createPageBuffer(OptionalInt.of(bucket));
      store=new PageStore(buffer,columnTypes);
      pageStores.put(bucket,store);
    }
    store.appendPosition(page,position);
  }
  flushIfNecessary();
}
