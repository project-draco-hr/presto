{
  if (pages.isEmpty()) {
    return;
  }
  if (sortFields.isEmpty()) {
    storagePageSink.appendPages(pages);
  }
 else {
    checkState(pageBuffer.getRowCount() <= Integer.MAX_VALUE);
    long[] orderedAddresses=pageSorter.sort(columnTypes,pages,sortTypes,sortFields,sortOrders,Ints.checkedCast(pageBuffer.getRowCount()));
    int[] orderedPageIndex=new int[orderedAddresses.length];
    int[] orderedPositionIndex=new int[orderedAddresses.length];
    for (int i=0; i < orderedAddresses.length; i++) {
      orderedPageIndex[i]=pageSorter.decodePageIndex(orderedAddresses[i]);
      orderedPositionIndex[i]=pageSorter.decodePositionIndex(orderedAddresses[i]);
    }
    storagePageSink.appendPages(pages,orderedPageIndex,orderedPositionIndex);
  }
}
