{
  PlanNode root=createOutputPlan(analysis);
  PlanSanityChecker.validate(root);
  Map<Symbol,Type> types=analysis.getTypes();
  for (  PlanOptimizer optimizer : planOptimizersFactory.createOptimizations(session)) {
    root=optimizer.optimize(root,types);
  }
  return root;
}
