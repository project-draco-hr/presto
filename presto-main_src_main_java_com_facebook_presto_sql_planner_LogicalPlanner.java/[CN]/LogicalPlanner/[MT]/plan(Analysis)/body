{
  PlanNode root=planStatement(analysis,analysis.getStatement());
  for (  PlanOptimizer optimizer : planOptimizers) {
    root=optimizer.optimize(root,session,symbolAllocator.getTypes(),symbolAllocator,idAllocator);
    requireNonNull(root,format("%s returned a null plan",optimizer.getClass().getName()));
  }
  PlanSanityChecker.validate(root,session,metadata,sqlParser,symbolAllocator.getTypes());
  return new Plan(root,symbolAllocator);
}
