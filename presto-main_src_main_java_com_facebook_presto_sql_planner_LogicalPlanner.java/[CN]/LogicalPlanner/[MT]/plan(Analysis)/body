{
  RelationPlan plan;
  if (analysis.getCreateTableDestination().isPresent()) {
    plan=createTableCreationPlan(analysis);
  }
 else   if (analysis.getInsertTarget().isPresent()) {
    plan=createInsertPlan(analysis);
  }
 else   if (analysis.getDelete().isPresent()) {
    plan=createDeletePlan(analysis);
  }
 else {
    plan=createRelationPlan(analysis);
  }
  PlanNode root=createOutputPlan(plan,analysis);
  PlanSanityChecker.validate(root);
  for (  PlanOptimizer optimizer : planOptimizers) {
    root=optimizer.optimize(root,session,symbolAllocator.getTypes(),symbolAllocator,idAllocator);
    checkNotNull(root,"%s returned a null plan",optimizer.getClass().getName());
  }
  PlanSanityChecker.validate(root);
  return new Plan(root,symbolAllocator);
}
