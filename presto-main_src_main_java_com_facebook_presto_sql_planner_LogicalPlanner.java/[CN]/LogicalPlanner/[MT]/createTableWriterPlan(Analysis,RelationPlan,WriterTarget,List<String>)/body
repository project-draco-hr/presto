{
  List<Symbol> writerOutputs=ImmutableList.of(symbolAllocator.newSymbol("partialrows",BIGINT),symbolAllocator.newSymbol("fragment",VARBINARY));
  PlanNode source=plan.getRoot();
  if (!analysis.isCreateTableAsSelectWithData()) {
    source=new LimitNode(idAllocator.getNextId(),source,0L);
  }
  PlanNode writerNode=new TableWriterNode(idAllocator.getNextId(),source,target,plan.getOutputSymbols(),columnNames,writerOutputs,plan.getSampleWeight());
  List<Symbol> outputs=ImmutableList.of(symbolAllocator.newSymbol("rows",BIGINT));
  TableFinishNode commitNode=new TableFinishNode(idAllocator.getNextId(),writerNode,target,outputs);
  return new RelationPlan(commitNode,analysis.getOutputDescriptor(),outputs,Optional.empty());
}
