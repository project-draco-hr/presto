{
  QualifiedTableName destination=analysis.getCreateTableDestination().get();
  RelationPlan plan=createRelationPlan(analysis);
  TableMetadata tableMetadata=createTableMetadata(destination,getOutputTableColumns(plan),plan.getSampleWeight().isPresent());
  checkState(!plan.getSampleWeight().isPresent() || metadata.canCreateSampledTables(session,destination.getCatalogName()),"Cannot write sampled data to a store that doesn't support sampling");
  return createTableWriterPlan(analysis,plan,tableMetadata,new CreateName(destination.getCatalogName(),tableMetadata));
}
