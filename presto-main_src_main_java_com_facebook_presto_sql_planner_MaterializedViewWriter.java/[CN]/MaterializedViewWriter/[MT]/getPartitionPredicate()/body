{
  checkState(!predicateHandedOut.getAndSet(true),"Predicate can only be handed out once");
  final Set<String> allPartitions=ImmutableSet.copyOf(remainingPartitions);
  return new Predicate<Partition>(){
    @Override public boolean apply(    Partition input){
      remainingPartitions.remove(input.getPartitionId());
      return !allPartitions.contains(input.getPartitionId());
    }
  }
;
}
