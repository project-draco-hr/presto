{
  if (partitionsDone.contains(partitionName)) {
    return;
  }
  Set<UUID> shardUuids=partitionInfo.getShardUuids();
  if (shardsDone.keySet().containsAll(shardUuids)) {
    ImmutableMap.Builder<UUID,String> builder=ImmutableMap.builder();
    for (    UUID shardUuid : shardUuids) {
      builder.put(shardUuid,shardsDone.get(shardUuid));
    }
    Map<UUID,String> shards=builder.build();
    shardManager.commitPartition(writerNode.getTable(),partitionName,partitionInfo.getPartitionKeys(),shards);
    checkState(shardsInFlight.addAndGet(-shardUuids.size()) >= 0,"shards in flight crashed into the ground");
    partitionsDone.add(partitionName);
  }
}
