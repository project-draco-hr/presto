{
  return new OutputReceiver(){
    @Override public void updateOutput(    Object result){
      @SuppressWarnings("unchecked") MaterializedViewWriterResult writerResult=MaterializedViewWriterResult.forMap((Map<String,Object>)result);
      String oldValue=shardsDone.put(writerResult.getShardId(),writerResult.getNodeIdentifier());
      checkState(oldValue == null || oldValue.equals(writerResult.getNodeIdentifier()),"Seen a different node committing a shard (%s vs %s)",oldValue,writerResult.getNodeIdentifier());
      for (      Map.Entry<String,PartitionInfo> entry : finishedPartitions.entrySet()) {
        if (!partitionsDone.contains(entry.getKey())) {
          considerCommittingPartition(entry.getKey(),entry.getValue());
        }
      }
    }
  }
;
}
