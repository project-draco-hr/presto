{
  TranslationMap translations=new TranslationMap(subPlan,analysis);
  translations.setFieldMappings(subPlan.getOutputSymbols());
  ImmutableMap.Builder<Symbol,Expression> projections=ImmutableMap.builder();
  for (  Symbol symbol : subPlan.getRoot().getOutputSymbols()) {
    Expression expression=new QualifiedNameReference(symbol.toQualifiedName());
    projections.put(symbol,expression);
  }
  for (  Expression expression : expressions) {
    Symbol symbol=symbolAllocator.newSymbol(expression,analysis.getType(expression));
    projections.put(symbol,translations.rewrite(expression));
    translations.put(expression,symbol);
  }
  return new PlanBuilder(translations,new ProjectNode(idAllocator.getNextId(),subPlan.getRoot(),projections.build()));
}
