{
  checkArgument(!node.getRelations().isEmpty(),"No relations specified for UNION");
  List<Symbol> outputSymbols=null;
  ImmutableList.Builder<PlanNode> sources=ImmutableList.builder();
  ImmutableListMultimap.Builder<Symbol,Symbol> symbolMapping=ImmutableListMultimap.builder();
  for (  Relation relation : node.getRelations()) {
    RelationPlan relationPlan=process(relation,context);
    if (outputSymbols == null) {
      ImmutableList.Builder<Symbol> outputSymbolBuilder=ImmutableList.builder();
      for (      Symbol symbol : relationPlan.getOutputSymbols()) {
        outputSymbolBuilder.add(symbolAllocator.newSymbol(symbol.getName(),symbolAllocator.getTypes().get(symbol)));
      }
      outputSymbols=outputSymbolBuilder.build();
    }
    for (int i=0; i < outputSymbols.size(); i++) {
      symbolMapping.put(outputSymbols.get(i),relationPlan.getOutputSymbols().get(i));
    }
    sources.add(relationPlan.getRoot());
  }
  PlanNode planNode=new UnionNode(idAllocator.getNextId(),sources.build(),symbolMapping.build());
  if (node.isDistinct()) {
    planNode=distinct(planNode);
  }
  return new RelationPlan(planNode,analysis.getOutputDescriptor(node),planNode.getOutputSymbols());
}
