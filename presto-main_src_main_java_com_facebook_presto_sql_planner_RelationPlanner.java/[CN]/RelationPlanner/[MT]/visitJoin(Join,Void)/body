{
  RelationPlan leftPlan=process(node.getLeft(),context);
  RelationPlan rightPlan=process(node.getRight(),context);
  List<EquiJoinClause> criteria=analysis.getJoinCriteria(node);
  PlanBuilder leftPlanBuilder=appendProjections(leftPlan,Iterables.transform(criteria,leftGetter()));
  PlanBuilder rightPlanBuilder=appendProjections(rightPlan,Iterables.transform(criteria,rightGetter()));
  ImmutableList.Builder<JoinNode.EquiJoinClause> clauses=ImmutableList.builder();
  for (  EquiJoinClause clause : criteria) {
    Symbol leftSymbol=leftPlanBuilder.translate(clause.getLeft());
    Symbol rightSymbol=rightPlanBuilder.translate(clause.getRight());
    clauses.add(new JoinNode.EquiJoinClause(leftSymbol,rightSymbol));
  }
  List<Symbol> outputSymbols=ImmutableList.<Symbol>builder().addAll(leftPlan.getOutputSymbols()).addAll(rightPlan.getOutputSymbols()).build();
  return new RelationPlan(new JoinNode(idAllocator.getNextId(),JoinNode.Type.typeConvert(node.getType()),leftPlanBuilder.getRoot(),rightPlanBuilder.getRoot(),clauses.build()),analysis.getOutputDescriptor(node),outputSymbols);
}
