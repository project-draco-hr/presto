{
  PlanBuilder subPlan=new QueryPlanner(analysis,symbolAllocator,idAllocator,metadata,session).process(node,null);
  TupleDescriptor outputDescriptor=analysis.getOutputDescriptor(node);
  Iterator<Field> outputFields=outputDescriptor.getFields().iterator();
  Iterator<FieldOrExpression> outputExpressions=analysis.getOutputExpressions(node).iterator();
  ImmutableMap.Builder<Field,Symbol> mappings=ImmutableMap.builder();
  while (outputFields.hasNext() && outputExpressions.hasNext()) {
    Field outputField=outputFields.next();
    FieldOrExpression outputExpression=outputExpressions.next();
    Symbol symbol=subPlan.translate(outputExpression);
    mappings.put(outputField,symbol);
  }
  return new RelationPlan(mappings.build(),subPlan.getRoot(),outputDescriptor);
}
