{
  ExpressionAnalyzer expressionAnalyzer=new ExpressionAnalyzer(new Analysis(),session,metadata);
  List<Field> fields=IterableTransformer.<Symbol>on(DependencyExtractor.extractUnique(expression)).transform(new Function<Symbol,Field>(){
    @Override public Field apply(    Symbol symbol){
      return Field.newUnqualified(symbol.getName(),symbolAllocator.getTypes().get(symbol));
    }
  }
).list();
  return expressionAnalyzer.analyze(expression,new TupleDescriptor(fields),new AnalysisContext());
}
