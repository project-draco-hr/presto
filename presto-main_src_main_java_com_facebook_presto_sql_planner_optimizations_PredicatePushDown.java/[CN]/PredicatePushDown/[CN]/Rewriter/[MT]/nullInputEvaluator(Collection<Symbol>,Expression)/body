{
  IdentityHashMap<Expression,Type> expressionTypes=getExpressionTypes(session,metadata,sqlParser,symbolAllocator.getTypes(),expression);
  return ExpressionInterpreter.expressionOptimizer(expression,metadata,session,expressionTypes).optimize(new SymbolResolver(){
    @Override public Object getValue(    Symbol symbol){
      return nullSymbols.contains(symbol) ? null : new QualifiedNameReference(symbol.toQualifiedName());
    }
  }
);
}
