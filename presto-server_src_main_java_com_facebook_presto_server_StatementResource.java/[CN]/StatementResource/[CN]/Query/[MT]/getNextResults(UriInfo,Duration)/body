{
  Iterable<List<Object>> data=getData(maxWaitTime);
  QueryInfo queryInfo=queryManager.getQueryInfo(queryId,false);
  if (queryInfo.getState().isDone()) {
    if (queryInfo.getState() != QueryState.FINISHED) {
      exchangeClient.close();
    }
 else     if (queryInfo.getOutputStage() == null) {
      exchangeClient.close();
      columns=ImmutableList.of(new Column("result","varchar"));
      data=ImmutableSet.<List<Object>>of(ImmutableList.<Object>of("true"));
    }
  }
  URI nextResultsUri=null;
  if ((!queryInfo.getState().isDone()) || (!exchangeClient.isClosed())) {
    nextResultsUri=createNextResultsUri(uriInfo);
  }
  QueryResults queryResults=new QueryResults(queryId.toString(),uriInfo.getRequestUriBuilder().replaceQuery("").replacePath(queryInfo.getSelf().getPath()).build(),findCancelableLeafStage(queryInfo),nextResultsUri,columns,data,toStatementStats(queryInfo),toQueryError(queryInfo));
  if (lastResult != null) {
    lastResultPath=lastResult.getNextUri().getPath();
  }
 else {
    lastResultPath=null;
  }
  lastResult=queryResults;
  return queryResults;
}
