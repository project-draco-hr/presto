{
  TypeRegistry typeRegistry=new TypeRegistry();
  dbi=new DBI("jdbc:h2:mem:test" + System.nanoTime());
  dbi.registerMapper(new TableColumn.Mapper(typeRegistry));
  dbi.registerMapper(new Distribution.Mapper(typeRegistry));
  dummyHandle=dbi.open();
  createTablesWithRetry(dbi);
  RaptorConnectorId connectorId=new RaptorConnectorId("raptor");
  NodeManager nodeManager=new TestingNodeManager();
  NodeSupplier nodeSupplier=new RaptorNodeSupplier(nodeManager,connectorId);
  shardManager=createShardManager(dbi,nodeSupplier,systemTicker());
  metadata=new RaptorMetadata(connectorId.toString(),dbi,shardManager,SHARD_INFO_CODEC,SHARD_DELTA_CODEC);
}
