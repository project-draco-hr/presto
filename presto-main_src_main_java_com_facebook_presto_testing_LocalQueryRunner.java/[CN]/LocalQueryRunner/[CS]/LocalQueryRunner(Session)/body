{
  this.defaultSession=checkNotNull(defaultSession,"defaultSession is null");
  this.hashEnabled=SystemSessionProperties.isOptimizeHashGenerationEnabled(defaultSession,false);
  this.executor=newCachedThreadPool(daemonThreadsNamed("local-query-runner-%s"));
  this.sqlParser=new SqlParser();
  this.nodeManager=new InMemoryNodeManager();
  this.typeRegistry=new TypeRegistry();
  this.indexManager=new IndexManager();
  this.pageSinkManager=new PageSinkManager();
  SystemTablesMetadata systemTablesMetadata=new SystemTablesMetadata();
  SystemSplitManager systemSplitManager=new SystemSplitManager(nodeManager);
  SystemRecordSetProvider systemRecordSetProvider=new SystemRecordSetProvider();
  this.metadata=new MetadataManager(new FeaturesConfig().setExperimentalSyntaxEnabled(true),typeRegistry,systemTablesMetadata);
  this.splitManager=new SplitManager(systemSplitManager);
  this.pageSourceManager=new PageSourceManager(systemRecordSetProvider);
  SystemTablesManager systemTablesManager=new SystemTablesManager(systemTablesMetadata,systemSplitManager,systemRecordSetProvider,ImmutableSet.<SystemTable>of());
  systemTablesManager.addTable(new NodesSystemTable(nodeManager));
  systemTablesManager.addTable(new CatalogSystemTable(metadata));
  this.compiler=new ExpressionCompiler(metadata);
  this.connectorManager=new ConnectorManager(metadata,splitManager,pageSourceManager,indexManager,pageSinkManager,new HandleResolver(),ImmutableMap.<String,ConnectorFactory>of(),nodeManager);
}
