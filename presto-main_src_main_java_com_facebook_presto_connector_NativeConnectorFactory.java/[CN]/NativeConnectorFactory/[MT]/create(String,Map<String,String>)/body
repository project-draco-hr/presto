{
  ImmutableClassToInstanceMap.Builder<Object> builder=ImmutableClassToInstanceMap.builder();
  IDBI dbi=this.dbi.get();
  if (dbi != null) {
    checkState(shardManager.get() != null,"shardManager was not set");
    builder.put(ConnectorMetadata.class,new NativeMetadata(connectorId,dbi,shardManager.get()));
  }
  NativeSplitManager splitManager=this.splitManager.get();
  if (splitManager != null) {
    builder.put(ConnectorSplitManager.class,splitManager);
  }
  builder.put(ConnectorDataStreamProvider.class,dataStreamProvider);
  builder.put(ConnectorHandleResolver.class,HANDLE_RESOLVER);
  builder.put(ConnectorRecordSinkProvider.class,recordSinkProvider);
  builder.put(ConnectorOutputHandleResolver.class,HANDLE_RESOLVER);
  return new StaticConnector(builder.build());
}
