{
  verifyJvmTimeZone();
  checkArgument(!isNullOrEmpty(tableMetadata.getOwner()),"Table owner is null or empty");
  HiveStorageFormat hiveStorageFormat=getHiveStorageFormat(session);
  ImmutableList.Builder<String> columnNames=ImmutableList.builder();
  ImmutableList.Builder<Type> columnTypes=ImmutableList.builder();
  SchemaTableName schemaTableName=tableMetadata.getTable();
  String schemaName=schemaTableName.getSchemaName();
  String tableName=schemaTableName.getTableName();
  buildColumnInfo(tableMetadata,columnNames,columnTypes);
  Path targetPath=getTargetPath(schemaName,tableName,schemaTableName);
  if (!useTemporaryDirectory(targetPath)) {
    return new HiveOutputTableHandle(connectorId,schemaName,tableName,columnNames.build(),columnTypes.build(),tableMetadata.getOwner(),targetPath.toString(),targetPath.toString(),hiveStorageFormat);
  }
  String temporaryPrefix="/tmp/presto-" + StandardSystemProperty.USER_NAME.value();
  Path temporaryRoot=new Path(targetPath,temporaryPrefix);
  Path temporaryPath=new Path(temporaryRoot,randomUUID().toString());
  createDirectories(temporaryPath);
  return new HiveOutputTableHandle(connectorId,schemaName,tableName,columnNames.build(),columnTypes.build(),tableMetadata.getOwner(),targetPath.toString(),temporaryPath.toString(),hiveStorageFormat);
}
