{
  HiveTableHandle handle=checkType(tableHandle,HiveTableHandle.class,"tableHandle");
  HiveTableLayoutHandle layoutHandle=checkType(tableLayoutHandle,HiveTableLayoutHandle.class,"tableLayoutHandle");
  Optional<Table> table=metastore.getTable(handle.getSchemaName(),handle.getTableName());
  if (!table.isPresent()) {
    throw new TableNotFoundException(handle.getSchemaTableName());
  }
  if (table.get().getPartitionColumns().isEmpty()) {
    if (!table.get().getTableType().equals(TableType.MANAGED_TABLE.toString())) {
      throw new PrestoException(NOT_SUPPORTED,"Cannot delete from non-managed Hive table");
    }
    String location=table.get().getStorage().getLocation();
    List<String> notDeletedFiles=recursiveDeleteFilesStartingWith(session.getUser(),location,"");
    if (!notDeletedFiles.isEmpty()) {
      throw new PrestoException(HIVE_FILESYSTEM_ERROR,"Error deleting from unpartitioned table: " + handle.getSchemaTableName());
    }
  }
 else {
    for (    HivePartition hivePartition : getOrComputePartitions(layoutHandle,session,tableHandle)) {
      metastore.dropPartition(handle.getSchemaName(),handle.getTableName(),toPartitionValues(hivePartition.getPartitionId()),true);
    }
  }
  return OptionalLong.empty();
}
