{
  this.planner=checkNotNull(planner,"planner is null");
  this.locationFactory=checkNotNull(locationFactory,"locationFactory is null");
  this.queryMonitor=checkNotNull(queryMonitor,"queryMonitor is null");
  checkNotNull(config,"config is null");
  this.maxBufferSize=config.getSinkMaxBufferSize();
  this.maxTaskMemoryUsage=config.getMaxTaskMemoryUsage();
  this.operatorPreAllocatedMemory=config.getOperatorPreAllocatedMemory();
  this.infoCacheTime=config.getInfoMaxAge();
  this.clientTimeout=config.getClientTimeout();
  taskMasterExecutor=Executors.newCachedThreadPool(threadsNamed("task-processor-%d"));
  taskMasterExecutorMBean=new ThreadPoolExecutorMBean((ThreadPoolExecutor)taskMasterExecutor);
  ExecutorService shardExecutor=Executors.newFixedThreadPool(config.getMaxShardProcessorThreads(),threadsNamed("shard-processor-%d"));
  this.shardExecutor=MoreExecutors.listeningDecorator(shardExecutor);
  this.shardExecutorMBean=new ThreadPoolExecutorMBean((ThreadPoolExecutor)shardExecutor);
  taskManagementExecutor=Executors.newScheduledThreadPool(5,threadsNamed("task-management-%d"));
  taskManagementExecutorMBean=new ThreadPoolExecutorMBean((ThreadPoolExecutor)taskManagementExecutor);
  taskManagementExecutor.scheduleAtFixedRate(new Runnable(){
    @Override public void run(){
      try {
        removeOldTasks();
      }
 catch (      Throwable e) {
        log.warn(e,"Error removing old tasks");
      }
      try {
        failAbandonedTasks();
      }
 catch (      Throwable e) {
        log.warn(e,"Error canceling abandoned tasks");
      }
    }
  }
,200,200,TimeUnit.MILLISECONDS);
}
