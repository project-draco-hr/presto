{
  Preconditions.checkNotNull(metadata,"metadata is null");
  Preconditions.checkNotNull(sourceProvider,"sourceProvider is null");
  Preconditions.checkNotNull(httpServerInfo,"httpServerInfo is null");
  Preconditions.checkNotNull(config,"config is null");
  this.metadata=metadata;
  this.sourceProvider=sourceProvider;
  this.httpServerInfo=httpServerInfo;
  this.pageBufferMax=20;
  this.maxOperatorMemoryUsage=config.getMaxOperatorMemoryUsage();
  this.maxTaskAge=new Duration(config.getMaxQueryAge().toMillis() + SECONDS.toMillis(30),MILLISECONDS);
  this.clientTimeout=config.getClientTimeout();
  taskExecutor=Executors.newCachedThreadPool(threadsNamed("task-processor-%d"));
  shardExecutor=new FairBatchExecutor(config.getMaxShardProcessorThreads(),threadsNamed("shard-processor-%d"));
  taskManagementExecutor=Executors.newScheduledThreadPool(100,threadsNamed("task-management-%d"));
  taskManagementExecutor.scheduleAtFixedRate(new Runnable(){
    @Override public void run(){
      try {
        removeOldTasks();
      }
 catch (      Throwable e) {
        log.warn(e,"Error removing old tasks");
      }
      try {
        failAbandonedTasks();
      }
 catch (      Throwable e) {
        log.warn(e,"Error canceling abandoned tasks");
      }
    }
  }
,200,200,TimeUnit.MILLISECONDS);
}
