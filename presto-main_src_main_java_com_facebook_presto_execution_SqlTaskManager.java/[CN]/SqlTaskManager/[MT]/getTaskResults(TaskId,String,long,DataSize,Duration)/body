{
  checkNotNull(taskId,"taskId is null");
  checkNotNull(outputName,"outputName is null");
  Preconditions.checkArgument(maxSize.toBytes() > 0,"maxSize must be at least 1 byte");
  checkNotNull(maxWaitTime,"maxWaitTime is null");
  TaskExecution taskExecution=tasks.get(taskId);
  if (taskExecution == null) {
    TaskInfo taskInfo=taskInfos.get(taskId);
    if (taskInfo == null) {
      throw new NoSuchElementException("Unknown query task " + taskId);
    }
 else     if (taskInfo.getState() == TaskState.FAILED) {
      Uninterruptibles.sleepUninterruptibly(100,TimeUnit.MILLISECONDS);
      return BufferResult.emptyResults(startingSequenceId,false);
    }
 else {
      return BufferResult.emptyResults(taskInfo.getOutputBuffers().getMasterSequenceId(),true);
    }
  }
  taskExecution.recordHeartbeat();
  return taskExecution.getResults(outputName,startingSequenceId,maxSize,maxWaitTime);
}
