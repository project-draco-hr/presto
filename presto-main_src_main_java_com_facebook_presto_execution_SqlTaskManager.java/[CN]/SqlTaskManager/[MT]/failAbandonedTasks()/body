{
  DateTime now=DateTime.now();
  DateTime oldestAllowedHeartBeat=now.minus((long)clientTimeout.toMillis());
  for (  TaskExecution taskExecution : tasks.values()) {
    try {
      TaskInfo taskInfo=taskExecution.getTaskInfo(false);
      if (taskInfo.getState().isDone()) {
        continue;
      }
      DateTime lastHeartBeat=taskInfo.getStats().getLastHeartBeat();
      if (lastHeartBeat != null && lastHeartBeat.isBefore(oldestAllowedHeartBeat)) {
        log.info("Failing abandoned task %s",taskExecution.getTaskId());
        taskExecution.fail(new AbandonedException("Task " + taskInfo.getTaskId(),lastHeartBeat,now));
      }
    }
 catch (    Exception e) {
      log.warn(e,"Error while inspecting age of task %s",taskExecution.getTaskId());
    }
  }
}
