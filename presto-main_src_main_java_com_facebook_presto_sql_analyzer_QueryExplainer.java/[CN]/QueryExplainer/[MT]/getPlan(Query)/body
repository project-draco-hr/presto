{
  Analyzer analyzer=new Analyzer(session,metadata,Optional.<QueryExplainer>absent());
  Analysis analysis=analyzer.analyze(query);
  PlanNodeIdAllocator idAllocator=new PlanNodeIdAllocator();
  LogicalPlanner logicalPlanner=new LogicalPlanner(session,planOptimizers,idAllocator,metadata,periodicImportManager,storageManager);
  Plan plan=logicalPlanner.plan(analysis);
  return PlanPrinter.printPlan(plan.getRoot(),plan.getTypes());
}
