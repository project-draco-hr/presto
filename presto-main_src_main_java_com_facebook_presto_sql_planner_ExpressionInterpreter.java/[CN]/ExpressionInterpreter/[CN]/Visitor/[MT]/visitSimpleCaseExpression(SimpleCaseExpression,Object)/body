{
  Object operand=process(node.getOperand(),context);
  if (operand instanceof Expression) {
    return node;
  }
  Expression resultClause=node.getDefaultValue().orElse(null);
  if (operand != null) {
    for (    WhenClause whenClause : node.getWhenClauses()) {
      Object value=process(whenClause.getOperand(),context);
      if (value == null) {
        continue;
      }
      if (value instanceof Expression) {
        return node;
      }
      if ((Boolean)invokeOperator(OperatorType.EQUAL,types(node.getOperand(),whenClause.getOperand()),ImmutableList.of(operand,value))) {
        resultClause=whenClause.getResult();
        break;
      }
    }
  }
  if (resultClause == null) {
    return null;
  }
  Object result=process(resultClause,context);
  if (result instanceof Expression) {
    return node;
  }
  return result;
}
