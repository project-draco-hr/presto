{
  ExpressionAnalyzer analyzer=createConstantAnalyzer(metadata,session);
  analyzer.analyze(expression,new TupleDescriptor(),new AnalysisContext());
  Type actualType=analyzer.getExpressionTypes().get(expression);
  if (!canCoerce(actualType,expectedType)) {
    throw new PrestoException(StandardErrorCode.INVALID_SESSION_PROPERTY,String.format("Can not set property of type %s to %s",expectedType.getTypeSignature(),actualType.getTypeSignature()));
  }
  IdentityHashMap<Expression,Type> coercions=new IdentityHashMap<>();
  coercions.putAll(analyzer.getExpressionCoercions());
  coercions.put(expression,expectedType);
  return evaluateConstantExpression(expression,coercions,metadata,session);
}
