{
  requireNonNull(requiredConfig,"requiredConfig is null");
  try (ThreadContextClassLoader ignored=new ThreadContextClassLoader(classLoader)){
    Bootstrap app=new Bootstrap(new AtopModule(atopFactoryClass,typeManager,nodeManager,nodeConfig,connectorId));
    Injector injector=app.strictConfig().doNotInitializeLogging().setRequiredConfigurationProperties(requiredConfig).setOptionalConfigurationProperties(optionalConfig).initialize();
    return injector.getInstance(AtopConnector.class);
  }
 catch (  Exception e) {
    throw Throwables.propagate(e);
  }
}
