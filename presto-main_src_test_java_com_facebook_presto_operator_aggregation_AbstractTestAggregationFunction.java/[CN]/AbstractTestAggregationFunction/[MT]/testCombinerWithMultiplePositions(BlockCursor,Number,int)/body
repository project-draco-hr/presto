{
  List<Block> blocks=new ArrayList<>();
  for (int i=0; i < positions; i++) {
    AggregationFunctionStep function=partialAggregation(getFunction());
    assertTrue(cursor.advanceNextPosition());
    function.add(cursor);
    Tuple tuple=function.evaluate();
    blocks.add(new BlockBuilder(getFunction().getIntermediateTupleInfo()).append(tuple).build());
  }
  if (positions > 0) {
    assertEquals(cursor.getPosition(),positions - 1);
  }
  assertCombineFinalAggregation(blocks,expectedValue);
}
