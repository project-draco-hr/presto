{
  CallSiteBinder callSiteBinder=new CallSiteBinder();
  ClassDefinition classDefinition=new ClassDefinition(new CompilerContext(BOOTSTRAP_METHOD),a(PUBLIC,FINAL),makeClassName("JoinProbe"),type(Object.class),type(JoinProbe.class));
  FieldDefinition lookupSourceField=classDefinition.declareField(a(PRIVATE,FINAL),"lookupSource",LookupSource.class);
  FieldDefinition positionCountField=classDefinition.declareField(a(PRIVATE,FINAL),"positionCount",int.class);
  List<FieldDefinition> blockFields=new ArrayList<>();
  for (int i=0; i < types.size(); i++) {
    FieldDefinition channelField=classDefinition.declareField(a(PRIVATE,FINAL),"block_" + i,com.facebook.presto.spi.block.Block.class);
    blockFields.add(channelField);
  }
  List<FieldDefinition> probeBlockFields=new ArrayList<>();
  for (int i=0; i < probeChannels.size(); i++) {
    FieldDefinition channelField=classDefinition.declareField(a(PRIVATE,FINAL),"probeBlock_" + i,com.facebook.presto.spi.block.Block.class);
    probeBlockFields.add(channelField);
  }
  FieldDefinition probeBlocksArrayField=classDefinition.declareField(a(PRIVATE,FINAL),"probeBlocks",com.facebook.presto.spi.block.Block[].class);
  FieldDefinition positionField=classDefinition.declareField(a(PRIVATE),"position",int.class);
  generateConstructor(classDefinition,probeChannels,lookupSourceField,blockFields,probeBlockFields,probeBlocksArrayField,positionField,positionCountField);
  generateGetChannelCountMethod(classDefinition,blockFields.size());
  generateAppendToMethod(classDefinition,callSiteBinder,types,blockFields,positionField);
  generateAdvanceNextPosition(classDefinition,positionField,positionCountField);
  generateGetCurrentJoinPosition(classDefinition,lookupSourceField,probeBlocksArrayField,positionField);
  generateCurrentRowContainsNull(classDefinition,probeBlockFields,positionField);
  return defineClass(classDefinition,JoinProbe.class,callSiteBinder.getBindings(),getClass().getClassLoader());
}
