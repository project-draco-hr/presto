{
  analysis.setUpdateType("CREATE TABLE");
  QualifiedObjectName targetTable=createQualifiedObjectName(session,node,node.getName());
  analysis.setCreateTableDestination(targetTable);
  for (  Expression expression : node.getProperties().values()) {
    createConstantAnalyzer(metadata,session).analyze(expression,new RelationType(),context);
  }
  analysis.setCreateTableProperties(node.getProperties());
  Optional<TableHandle> targetTableHandle=metadata.getTableHandle(session,targetTable);
  if (targetTableHandle.isPresent()) {
    throw new SemanticException(TABLE_ALREADY_EXISTS,node,"Destination table '%s' already exists",targetTable);
  }
  accessControl.checkCanCreateTable(session.getRequiredTransactionId(),session.getIdentity(),targetTable);
  analysis.setCreateTableAsSelectWithData(node.isWithData());
  RelationType descriptor=process(node.getQuery(),context);
  analysis.setStatement(node);
  validateColumns(node,descriptor);
  return new RelationType(Field.newUnqualified("rows",BIGINT));
}
