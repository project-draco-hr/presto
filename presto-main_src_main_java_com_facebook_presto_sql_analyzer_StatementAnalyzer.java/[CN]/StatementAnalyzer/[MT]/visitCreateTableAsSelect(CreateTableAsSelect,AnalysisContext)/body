{
  analysis.setUpdateType("CREATE TABLE");
  QualifiedTableName targetTable=createQualifiedTableName(session,node,node.getName());
  analysis.setCreateTableDestination(targetTable);
  for (  Expression expression : node.getProperties().values()) {
    createConstantAnalyzer(metadata,session).analyze(expression,new TupleDescriptor(),context);
  }
  analysis.setCreateTableProperties(node.getProperties());
  Optional<TableHandle> targetTableHandle=metadata.getTableHandle(session,targetTable);
  if (targetTableHandle.isPresent()) {
    throw new SemanticException(TABLE_ALREADY_EXISTS,node,"Destination table '%s' already exists",targetTable);
  }
  accessControl.checkCanCreateTable(session.getIdentity(),targetTable);
  analysis.setCreateTableAsSelectWithData(node.getWithData());
  TupleDescriptor descriptor=process(node.getQuery(),context);
  validateColumnNames(node,descriptor);
  return new TupleDescriptor(Field.newUnqualified("rows",BIGINT));
}
