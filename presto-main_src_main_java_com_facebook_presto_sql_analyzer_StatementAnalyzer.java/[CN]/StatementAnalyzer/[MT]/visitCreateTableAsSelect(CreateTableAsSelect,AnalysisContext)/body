{
  analysis.setUpdateType("CREATE TABLE");
  QualifiedObjectName targetTable=createQualifiedObjectName(session,node,node.getName());
  analysis.setCreateTableDestination(targetTable);
  Optional<TableHandle> targetTableHandle=metadata.getTableHandle(session,targetTable);
  if (targetTableHandle.isPresent()) {
    if (node.isNotExists()) {
      analysis.setCreateTableAsSelectNoOp(true);
      return new RelationType(Field.newUnqualified("rows",BIGINT));
    }
    throw new SemanticException(TABLE_ALREADY_EXISTS,node,"Destination table '%s' already exists",targetTable);
  }
  for (  Expression expression : node.getProperties().values()) {
    createConstantAnalyzer(metadata,session).analyze(expression,new RelationType(),context);
  }
  analysis.setCreateTableProperties(node.getProperties());
  accessControl.checkCanCreateTable(session.getRequiredTransactionId(),session.getIdentity(),targetTable);
  analysis.setCreateTableAsSelectWithData(node.isWithData());
  RelationType descriptor=process(node.getQuery(),context);
  validateColumns(node,descriptor);
  return new RelationType(Field.newUnqualified("rows",BIGINT));
}
