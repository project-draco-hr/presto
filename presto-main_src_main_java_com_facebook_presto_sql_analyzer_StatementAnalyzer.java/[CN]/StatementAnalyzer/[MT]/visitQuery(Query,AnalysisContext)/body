{
  AnalysisContext context=new AnalysisContext(parentContext);
  if (node.getApproximate().isPresent()) {
    if (!experimentalSyntaxEnabled) {
      throw new SemanticException(NOT_SUPPORTED,node,"approximate queries are not enabled");
    }
    context.setApproximate(true);
  }
  analyzeWith(node,context);
  TupleAnalyzer analyzer=new TupleAnalyzer(analysis,session,metadata,sqlParser,experimentalSyntaxEnabled);
  TupleDescriptor descriptor=analyzer.process(node.getQueryBody(),context);
  analyzeOrderBy(node,descriptor,context);
  analysis.setOutputDescriptor(node,descriptor);
  analysis.setOutputExpressions(node,descriptorToFields(descriptor));
  analysis.setQuery(node);
  return descriptor;
}
