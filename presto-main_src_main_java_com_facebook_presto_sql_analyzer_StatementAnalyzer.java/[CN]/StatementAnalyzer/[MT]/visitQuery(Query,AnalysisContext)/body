{
  AnalysisContext context=new AnalysisContext(parentContext);
  analyzeWith(node,context);
  TupleAnalyzer analyzer=new TupleAnalyzer(analysis,session,metadata);
  TupleDescriptor descriptor=analyzer.process(node.getQueryBody(),context);
  analyzeOrderBy(node,descriptor,context);
  analysis.setOutputDescriptor(node,descriptor);
  analysis.setOutputExpressions(node,descriptorToFields(descriptor));
  analysis.setQuery(node);
  return descriptor;
}
