{
  QualifiedTableName table=MetadataUtil.createQualifiedTableName(session,showPartitions.getTable());
  Optional<TableHandle> tableHandle=metadata.getTableHandle(session,table);
  if (!tableHandle.isPresent()) {
    throw new SemanticException(MISSING_TABLE,showPartitions,"Table '%s' does not exist",table);
  }
  ImmutableList.Builder<SelectItem> selectList=ImmutableList.builder();
  ImmutableList.Builder<SelectItem> wrappedList=ImmutableList.builder();
  selectList.add(unaliasedName("partition_number"));
  for (  ColumnMetadata column : metadata.getTableMetadata(session,tableHandle.get()).getColumns()) {
    if (!column.isPartitionKey()) {
      continue;
    }
    Expression key=equal(nameReference("partition_key"),new StringLiteral(column.getName()));
    Expression value=caseWhen(key,nameReference("partition_value"));
    value=new Cast(value,column.getType().getTypeSignature().toString());
    Expression function=functionCall("max",value);
    selectList.add(new SingleColumn(function,column.getName()));
    wrappedList.add(unaliasedName(column.getName()));
  }
  Query query=simpleQuery(selectAll(selectList.build()),from(table.getCatalogName(),TABLE_INTERNAL_PARTITIONS),Optional.of(logicalAnd(equal(nameReference("table_schema"),new StringLiteral(table.getSchemaName())),equal(nameReference("table_name"),new StringLiteral(table.getTableName())))),ImmutableList.of(nameReference("partition_number")),Optional.empty(),ImmutableList.of(),Optional.empty());
  query=simpleQuery(selectAll(wrappedList.build()),subquery(query),showPartitions.getWhere(),ImmutableList.of(),Optional.empty(),ImmutableList.<SortItem>builder().addAll(showPartitions.getOrderBy()).add(ascending("partition_number")).build(),showPartitions.getLimit());
  return process(query,context);
}
