{
  PlanFragmentBuilder left=node.getLeft().accept(this,context);
  PlanFragmentBuilder right=node.getRight().accept(this,context);
  if (left.isPartitioned() || right.isPartitioned()) {
    ExchangeNode exchange=new ExchangeNode(right.getId(),right.getRoot().getOutputSymbols());
    JoinNode join=new JoinNode(left.getRoot(),exchange,node.getCriteria());
    left.setRoot(join);
    return left;
  }
 else {
    fragments.remove(left);
    fragments.remove(right);
    JoinNode join=new JoinNode(left.getRoot(),right.getRoot(),node.getCriteria());
    return newPlanFragment(join,false);
  }
}
