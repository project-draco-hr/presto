{
  Visitor visitor=new Visitor(allocator,createSingleNodePlan);
  plan.accept(visitor,null);
  return Lists.transform(visitor.getFragments(),PlanFragmentBuilder.buildFragmentFunction(allocator.getTypes()));
}
