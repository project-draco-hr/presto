{
  if (!finishing) {
    if (cursor != null) {
      int rowsProcessed=cursorProcessor.process(operatorContext.getSession(),cursor,ROWS_PER_PAGE,pageBuilder);
      long bytesProcessed=cursor.getCompletedBytes() - completedBytes;
      long elapsedNanos=cursor.getReadTimeNanos() - readTimeNanos;
      operatorContext.recordGeneratedInput(new DataSize(bytesProcessed,BYTE),rowsProcessed,elapsedNanos);
      completedBytes+=cursor.getCompletedBytes();
      readTimeNanos=cursor.getReadTimeNanos();
      if (rowsProcessed == 0) {
        finishing=true;
      }
    }
 else {
      Page output=operator.getOutput();
      if (output != null) {
        pageProcessor.process(operatorContext.getSession(),output,pageBuilder);
      }
    }
  }
  if (pageBuilder.isEmpty() || (!finishing && !pageBuilder.isFull())) {
    return null;
  }
  Page page=pageBuilder.build();
  pageBuilder.reset();
  return page;
}
