{
  this.blockEncodingManager=checkNotNull(blockEncodingManager,"blockEncodingManager is null");
  checkNotNull(config,"config is null");
  File baseDataDir=checkNotNull(config.getDataDirectory(),"dataDirectory is null");
  this.baseStorageDir=createDirectory(new File(baseDataDir,"storage"));
  this.baseStagingDir=createDirectory(new File(baseDataDir,"staging"));
  this.dbi=checkNotNull(dbi,"dbi is null");
  this.dao=dbi.onDemand(StorageManagerDao.class);
  this.executor=newFixedThreadPool(config.getTasksPerNode(),threadsNamed("local-storage-manager-%s"));
  this.executorMBean=new ThreadPoolExecutorMBean((ThreadPoolExecutor)executor);
  this.shardBoundedExecutor=new KeyBoundedExecutor<>(executor);
  dao.createTableColumns();
  if (config.isCompressed()) {
    defaultEncoding=BlocksFileEncoding.SNAPPY;
  }
 else {
    defaultEncoding=BlocksFileEncoding.RAW;
  }
}
