{
  this.columns=columns;
  ImmutableList.Builder<Converter> converters=ImmutableList.builder();
  ImmutableList.Builder<Closeable> closeableBuilder=ImmutableList.builder();
  for (int i=0; i < columns.size(); i++) {
    HiveColumnHandle column=columns.get(i);
    if (!column.isPartitionKey() && column.getHiveColumnIndex() < messageType.getFieldCount()) {
      parquet.schema.Type parquetType=messageType.getFields().get(column.getHiveColumnIndex());
      if (parquetType.isPrimitive()) {
        converters.add(new ParquetPrimitiveColumnConverter(i));
      }
 else {
        GroupType groupType=parquetType.asGroupType();
switch (column.getTypeSignature().getBase()) {
case StandardTypes.ARRAY:
          ParquetJsonColumnConverter listConverter=new ParquetJsonColumnConverter(new ParquetListJsonConverter(groupType.getName(),null,groupType),i);
        converters.add(listConverter);
      closeableBuilder.add(listConverter);
    break;
case StandardTypes.MAP:
  ParquetJsonColumnConverter mapConverter=new ParquetJsonColumnConverter(new ParquetMapJsonConverter(groupType.getName(),null,groupType),i);
converters.add(mapConverter);
closeableBuilder.add(mapConverter);
break;
case StandardTypes.ROW:
ParquetJsonColumnConverter rowConverter=new ParquetJsonColumnConverter(new ParquetStructJsonConverter(groupType.getName(),null,groupType),i);
converters.add(rowConverter);
closeableBuilder.add(rowConverter);
break;
default :
throw new IllegalArgumentException("Group column " + groupType.getName() + " type "+ groupType.getOriginalType()+ " not supported");
}
}
}
}
this.converters=converters.build();
this.converterCloseables=closeableBuilder.build();
}
