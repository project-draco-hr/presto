{
  if (!context.get().contains(node.getMarkerSymbol())) {
    return context.rewrite(node.getSource(),context.get());
  }
  ImmutableSet.Builder<Symbol> expectedInputs=ImmutableSet.<Symbol>builder().addAll(node.getDistinctSymbols()).addAll(context.get());
  if (node.getHashSymbol().isPresent()) {
    expectedInputs.add(node.getHashSymbol().get());
  }
  PlanNode source=context.rewrite(node.getSource(),expectedInputs.build());
  return new MarkDistinctNode(node.getId(),source,node.getMarkerSymbol(),node.getDistinctSymbols(),node.getHashSymbol());
}
