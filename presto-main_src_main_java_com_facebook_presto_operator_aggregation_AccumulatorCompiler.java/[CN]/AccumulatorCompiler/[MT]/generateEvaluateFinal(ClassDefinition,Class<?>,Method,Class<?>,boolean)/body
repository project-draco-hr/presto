{
  Block body=definition.declareMethod(new CompilerContext(null),a(PUBLIC),"evaluateFinal",type(void.class),arg("state",AccumulatorState.class),arg("confidence",double.class),arg("out",BlockBuilder.class)).getBody();
  if (outputFunction != null) {
    body.comment("output(state, out)").getVariable("state").checkCast(stateClass);
    if (approximate) {
      body.getVariable("confidence");
    }
    body.getVariable("out").invokeStatic(outputFunction).ret();
  }
 else {
    checkArgument(!approximate,"Approximate aggregations must specify an output function");
    body.pushThis().comment("stateSerializer.serialize(state, out)").getField(accumulatorClass,"stateSerializer",AccumulatorStateSerializer.class).getVariable("state").getVariable("out").invokeInterface(AccumulatorStateSerializer.class,"serialize",void.class,Object.class,BlockBuilder.class).ret();
  }
}
