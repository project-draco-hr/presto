{
  MethodDefinition method=declareAddIntermediate(definition,grouped);
  CompilerContext context=method.getCompilerContext();
  Block body=method.getBody();
  if (grouped) {
    generateEnsureCapacity(context,stateField,body);
  }
  Variable positionVariable=context.declareVariable(int.class,"position");
  Block loopBody=generateInvokeInputFunction(context,stateField,positionVariable,null,ImmutableList.of(context.getVariable("block")),parameterMetadatas,intermediateInputFunction,callSiteBinder,grouped);
  body.append(generateBlockNonNullPositionForLoop(context,positionVariable,loopBody)).ret();
}
