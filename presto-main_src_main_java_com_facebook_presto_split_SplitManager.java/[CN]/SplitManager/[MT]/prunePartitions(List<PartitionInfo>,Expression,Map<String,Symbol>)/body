{
  ImmutableList.Builder<PartitionInfo> builder=ImmutableList.builder();
  for (  PartitionInfo partition : partitions) {
    Map<String,String> relevantFields=Maps.filterKeys(partition.getKeyFields(),in(columnNameToSymbol.keySet()));
    ImmutableMap.Builder<Symbol,Object> assignments=ImmutableMap.builder();
    for (    Map.Entry<String,String> entry : relevantFields.entrySet()) {
      Symbol symbol=columnNameToSymbol.get(entry.getKey());
      assignments.put(symbol,entry.getValue());
    }
    SymbolResolver resolver=new LookupSymbolResolver(assignments.build());
    Object optimized=new ExpressionInterpreter(resolver,metadata).process(predicate,null);
    if (!Boolean.FALSE.equals(optimized) && optimized != null) {
      builder.add(partition);
    }
  }
  return builder.build();
}
