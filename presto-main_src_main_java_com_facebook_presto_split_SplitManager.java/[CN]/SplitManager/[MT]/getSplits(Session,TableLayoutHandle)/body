{
  String connectorId=layout.getConnectorId();
  TransactionalConnectorSplitManager splitManager=getConnectorSplitManager(connectorId);
  ConnectorSession connectorSession=session.toConnectorSession(connectorId);
  ConnectorSplitSource source;
  if (layout.getConnectorHandle() instanceof LegacyTableLayoutHandle) {
    LegacyTableLayoutHandle handle=(LegacyTableLayoutHandle)layout.getConnectorHandle();
    if (handle.getPartitions().isEmpty()) {
      return new ConnectorAwareSplitSource(connectorId,layout.getTransactionHandle(),new FixedSplitSource(connectorId,ImmutableList.<ConnectorSplit>of()));
    }
    source=splitManager.getPartitionSplits(layout.getTransactionHandle().getTransactionHandle(),connectorSession,handle.getTable(),handle.getPartitions());
  }
 else {
    source=splitManager.getSplits(layout.getTransactionHandle().getTransactionHandle(),connectorSession,layout.getConnectorHandle());
  }
  return new ConnectorAwareSplitSource(connectorId,layout.getTransactionHandle(),source);
}
