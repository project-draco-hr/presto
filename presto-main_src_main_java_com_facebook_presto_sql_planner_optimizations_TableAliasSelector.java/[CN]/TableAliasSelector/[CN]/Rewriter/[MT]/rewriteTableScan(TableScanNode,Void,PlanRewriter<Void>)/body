{
  TableHandle tableHandle=node.getTable();
  QualifiedTableName tableName=metadata.getTableMetadata(tableHandle).getTable();
  TableAlias tableAlias=aliasDao.getAlias(tableName);
  if (tableAlias == null) {
    return node;
  }
  QualifiedTableName aliasTable=new QualifiedTableName(tableAlias.getDstCatalogName(),tableAlias.getDstSchemaName(),tableAlias.getDstTableName());
  Optional<TableHandle> aliasTableHandle=metadata.getTableHandle(aliasTable);
  if (!aliasTableHandle.isPresent()) {
    return node;
  }
  if (!allNodesPresent(((NativeTableHandle)aliasTableHandle.get()).getTableId())) {
    return node;
  }
  Map<String,ColumnHandle> lookupColumns=metadata.getColumnHandles(aliasTableHandle.get());
  Map<Symbol,ColumnHandle> assignments=node.getAssignments();
  ImmutableMap.Builder<Symbol,ColumnHandle> newAssignmentsBuilder=ImmutableMap.builder();
  for (  Map.Entry<Symbol,ColumnHandle> assignmentEntry : assignments.entrySet()) {
    ColumnMetadata originalColumn=metadata.getColumnMetadata(tableHandle,assignmentEntry.getValue());
    ColumnHandle aliasedColumnHandle=lookupColumns.get(originalColumn.getName());
    checkState(aliasedColumnHandle != null,"no matching column for original column %s found!",originalColumn);
    newAssignmentsBuilder.put(assignmentEntry.getKey(),aliasedColumnHandle);
  }
  return new TableScanNode(node.getId(),aliasTableHandle.get(),newAssignmentsBuilder.build());
}
