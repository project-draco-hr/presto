{
  if (pages.isEmpty()) {
    return pages;
  }
  PageBuilder pageBuilder=new PageBuilder(getTypes(pages));
  ImmutableList.Builder<Page> partitionedPages=ImmutableList.builder();
  for (  Page page : pages) {
    for (int position=0; position < page.getPositionCount(); position++) {
      int partitionHashBucket=getPartitionHashBucket(position,page);
      if (partitionHashBucket != partition) {
        continue;
      }
      page.appendTo(position,pageBuilder);
      if (pageBuilder.isFull()) {
        partitionedPages.add(pageBuilder.build());
        pageBuilder.reset();
      }
    }
  }
  if (!pageBuilder.isEmpty()) {
    partitionedPages.add(pageBuilder.build());
  }
  return partitionedPages.build();
}
