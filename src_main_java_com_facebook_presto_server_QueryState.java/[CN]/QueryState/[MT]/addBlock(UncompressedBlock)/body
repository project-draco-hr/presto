{
  while (!isDone() && !notFull.tryAcquire(1,TimeUnit.SECONDS)) {
  }
synchronized (blockBuffer) {
    if (state == State.CANCELED || state == State.FAILED) {
      notFull.release();
      return;
    }
    if (sourceCount == 0) {
      notFull.release();
      throw new IllegalStateException("All sources are finished");
    }
    blockBuffer.addLast(block);
    notEmpty.release();
  }
}
