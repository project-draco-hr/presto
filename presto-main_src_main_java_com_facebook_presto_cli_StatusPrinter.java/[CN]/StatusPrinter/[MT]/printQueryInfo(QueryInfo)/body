{
  Duration elapsedTime=Duration.nanosSince(start);
  ExecutionStats executionStats=new ExecutionStats();
  StageInfo outputStage=queryInfo.getOutputStage();
  sumStats(outputStage,executionStats);
  int nodes=uniqueNodes(outputStage).size();
  if (REAL_TERMINAL) {
    String querySummary=String.format("Query %s: %s, %,d nodes",queryInfo.getQueryId(),queryInfo.getState(),nodes);
    reprintLine(querySummary);
    String splitsSummary=String.format("Splits: %,d total, %,d pending, %,d running, %,d finished",executionStats.getSplits(),max(0,executionStats.getSplits() - executionStats.getStartedSplits()),max(0,executionStats.getStartedSplits() - executionStats.getCompletedSplits()),executionStats.getCompletedSplits());
    reprintLine(splitsSummary);
    Duration wallTime=new Duration(elapsedTime.toMillis() * nodes,TimeUnit.MILLISECONDS);
    Duration wallTimePerNode=elapsedTime;
    String cpuWallSummary=String.format("CPU wall: %s %s total, %s %s per node",wallTime.toString(TimeUnit.SECONDS),formatDataRate(executionStats.getCompletedDataSize(),wallTime),wallTimePerNode.toString(TimeUnit.SECONDS),formatDataRate(executionStats.getCompletedDataSize(),wallTimePerNode));
    reprintLine(cpuWallSummary);
    Duration userTime=new Duration(executionStats.getSplitCpuTime(),TimeUnit.MILLISECONDS);
    Duration userTimePerNode=new Duration(userTime.toMillis() / nodes,TimeUnit.MILLISECONDS);
    String cpuUserSummary=String.format("CPU user: %s %s total, %s %s per node",userTime.toString(TimeUnit.SECONDS),formatDataRate(executionStats.getCompletedDataSize(),userTime),userTimePerNode.toString(TimeUnit.SECONDS),formatDataRate(executionStats.getCompletedDataSize(),userTimePerNode));
    reprintLine(cpuUserSummary);
    reprintLine("");
    printStageTree(outputStage,"");
  }
 else {
    String querySummary=String.format("Query %s [%s] i[%,d %s %s] o[%,d %s %s] splits[%,d/%,d/%,d]",queryInfo.getQueryId(),queryInfo.getState().toString().charAt(0),executionStats.getInputPositionCount(),formatDataSize(executionStats.getInputDataSize()),formatDataRate(executionStats.getCompletedDataSize(),elapsedTime),executionStats.getOutputPositionCount(),formatDataSize(executionStats.getOutputDataSize()),formatDataRate(executionStats.getOutputDataSize(),elapsedTime),max(0,executionStats.getSplits() - executionStats.getStartedSplits()),max(0,executionStats.getStartedSplits() - executionStats.getCompletedSplits()),executionStats.getCompletedSplits());
    reprintLine(querySummary);
  }
}
