{
  if (total == 0) {
    return Strings.repeat(" ",width);
  }
  int pending=Math.max(0,total - complete - running);
  int completeLength=Math.min(width,ceil(complete * width,total));
  int pendingLength=Math.min(width,ceil(pending * width,total));
  int minRunningLength=running > 0 ? 1 : 0;
  int runningLength=Math.max(Math.min(width,ceil(running * width,total)),minRunningLength);
  if (completeLength + runningLength + pendingLength != width && pending > 0) {
    pendingLength=Math.max(0,width - completeLength - runningLength);
  }
  if (completeLength + runningLength + pendingLength != width) {
    runningLength=Math.max(minRunningLength,width - completeLength - pendingLength);
  }
  if (completeLength + runningLength + pendingLength > width && complete > 0) {
    completeLength=Math.max(0,width - runningLength - pendingLength);
  }
  Preconditions.checkState(completeLength + runningLength + pendingLength == width,"Expected completeLength (%s) + runningLength (%s) + pendingLength (%s) == width (%s), was %s for complete = %s, running = %s, total = %s",completeLength,runningLength,pendingLength,width,completeLength + runningLength + pendingLength,complete,running,total);
  return Strings.repeat("=",completeLength) + Strings.repeat(">",runningLength) + Strings.repeat(" ",pendingLength);
}
