{
  try {
    Preconditions.checkState(fragmentSources.size() == 1,"Expected single source");
    final String sourceName=fragmentSources.keySet().iterator().next();
    List<PlanFragmentSource> sources=fragmentSources.values().iterator().next();
    if (sources.size() == 1) {
      new SplitWorker(taskOutput,fragment,ImmutableMap.<String,PlanFragmentSource>of(sourceName,sources.get(0)),sourceProvider,metadata).call();
    }
 else {
      List<Future<Void>> results=shardExecutor.invokeAll(Lists.transform(sources,new Function<PlanFragmentSource,Callable<Void>>(){
        @Override public Callable<Void> apply(        PlanFragmentSource fragmentSource){
          return new SplitWorker(taskOutput,fragment,ImmutableMap.of(sourceName,fragmentSource),sourceProvider,metadata);
        }
      }
));
      checkQueryResults(results);
    }
    taskOutput.finish();
  }
 catch (  InterruptedException e) {
    Thread.currentThread().interrupt();
    taskOutput.queryFailed(e);
    throw Throwables.propagate(e);
  }
catch (  Exception e) {
    e.printStackTrace();
    taskOutput.queryFailed(e);
    throw Throwables.propagate(e);
  }
}
