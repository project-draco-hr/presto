{
  Set<Symbol> dependencies=SymbolExtractor.extract(root);
  PlanFragment fragment=new PlanFragment(id,root,Maps.filterKeys(allocator.getTypes(),in(dependencies)),distribution,partitionedSource,outputPartitioning,partitionBy,hash);
  return new SubPlan(fragment,children);
}
