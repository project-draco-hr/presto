{
  sqlTaskManager=new SqlTaskManager(planner,new MockLocationFactory(),taskExecutor,new QueryMonitor(new ObjectMapperProvider().get(),new NullEventClient(),new NodeInfo("test")),new TaskManagerConfig().setInfoMaxAge(new Duration(5,TimeUnit.MILLISECONDS)));
  TaskInfo taskInfo=sqlTaskManager.updateTask(session,taskId,testFragment,ImmutableList.<TaskSource>of(),new OutputBuffers(0,false));
  assertEquals(taskInfo.getState(),TaskState.RUNNING);
  taskInfo=sqlTaskManager.cancelTask(taskId);
  assertEquals(taskInfo.getState(),TaskState.CANCELED);
  taskInfo=sqlTaskManager.getTaskInfo(taskInfo.getTaskId(),false);
  assertEquals(taskInfo.getState(),TaskState.CANCELED);
  Thread.sleep(100);
  sqlTaskManager.removeOldTasks();
  try {
    sqlTaskManager.getTaskInfo(taskInfo.getTaskId(),false);
    fail("Expected NoSuchElementException");
  }
 catch (  NoSuchElementException expected) {
  }
}
