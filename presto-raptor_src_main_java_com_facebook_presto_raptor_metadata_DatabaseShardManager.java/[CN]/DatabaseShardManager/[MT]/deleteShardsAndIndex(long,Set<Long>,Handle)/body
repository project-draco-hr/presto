{
  String args=Joiner.on(",").join(nCopies(shardIds.size(),"?"));
  String where=" WHERE shard_id IN (" + args + ")";
  String deleteFromShardNodes="DELETE FROM shard_nodes " + where;
  String deleteFromShards="DELETE FROM shards " + where;
  String deleteFromShardIndex="DELETE FROM " + shardIndexTable(tableId) + where;
  try (PreparedStatement statement=handle.getConnection().prepareStatement(deleteFromShardNodes)){
    bindLongs(statement,shardIds);
    statement.executeUpdate();
  }
   for (  String sql : asList(deleteFromShards,deleteFromShardIndex)) {
    try (PreparedStatement statement=handle.getConnection().prepareStatement(sql)){
      bindLongs(statement,shardIds);
      if (statement.executeUpdate() != shardIds.size()) {
        throw new PrestoException(TRANSACTION_CONFLICT,"Shard was updated by a different transaction. Please retry the operation.");
      }
    }
   }
}
