{
  HashSet<Expression> seenCanonicals=new HashSet<>();
  ImmutableList.Builder<Set<Expression>> builder=ImmutableList.builder();
  for (  Expression expression : map.keySet()) {
    Expression canonical=canonicalize(expression);
    if (!seenCanonicals.contains(canonical)) {
      builder.add(extractEqualExpressions(canonical));
      seenCanonicals.add(canonical);
    }
  }
  return new EqualityInference(builder.build());
}
