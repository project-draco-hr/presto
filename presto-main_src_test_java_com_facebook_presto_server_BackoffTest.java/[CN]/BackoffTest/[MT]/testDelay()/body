{
  TestingTicker ticker=new TestingTicker();
  Backoff backoff=new Backoff(new Duration(15,SECONDS),ticker,new Duration(0,SECONDS),new Duration(1,SECONDS),new Duration(2,SECONDS),new Duration(4,SECONDS),new Duration(8,SECONDS));
  assertEquals(backoff.getFailureCount(),0);
  assertEquals(backoff.getTimeSinceLastSuccess().roundTo(SECONDS),0);
  assertFalse(backoff.failure());
  assertEquals(backoff.getFailureCount(),1);
  assertEquals(backoff.getTimeSinceLastSuccess().roundTo(SECONDS),0);
  long backoffDelay=backoff.getBackoffDelayNanos();
  assertEquals(NANOSECONDS.toSeconds(backoffDelay),0);
  ticker.increment(backoffDelay,NANOSECONDS);
  assertFalse(backoff.failure());
  assertEquals(backoff.getFailureCount(),2);
  assertEquals(backoff.getTimeSinceLastSuccess().roundTo(SECONDS),0);
  backoffDelay=backoff.getBackoffDelayNanos();
  assertEquals(NANOSECONDS.toSeconds(backoffDelay),1);
  ticker.increment(backoffDelay,NANOSECONDS);
  assertFalse(backoff.failure());
  assertEquals(backoff.getFailureCount(),3);
  assertEquals(backoff.getTimeSinceLastSuccess().roundTo(SECONDS),1);
  backoffDelay=backoff.getBackoffDelayNanos();
  assertEquals(NANOSECONDS.toSeconds(backoffDelay),2);
  ticker.increment(backoffDelay,NANOSECONDS);
  assertFalse(backoff.failure());
  assertEquals(backoff.getFailureCount(),4);
  assertEquals(backoff.getTimeSinceLastSuccess().roundTo(SECONDS),3);
  backoffDelay=backoff.getBackoffDelayNanos();
  assertEquals(NANOSECONDS.toSeconds(backoffDelay),4);
  ticker.increment(backoffDelay,NANOSECONDS);
  assertFalse(backoff.failure());
  assertEquals(backoff.getFailureCount(),5);
  assertEquals(backoff.getTimeSinceLastSuccess().roundTo(SECONDS),7);
  backoffDelay=backoff.getBackoffDelayNanos();
  assertEquals(NANOSECONDS.toSeconds(backoffDelay),8);
  ticker.increment(backoffDelay,NANOSECONDS);
  assertTrue(backoff.failure());
  assertEquals(backoff.getFailureCount(),6);
  assertEquals(backoff.getTimeSinceLastSuccess().roundTo(SECONDS),15);
  backoffDelay=backoff.getBackoffDelayNanos();
  assertEquals(NANOSECONDS.toSeconds(backoffDelay),8);
}
