{
  StatusPrinter statusPrinter=null;
  @SuppressWarnings("resource") PrintStream errorChannel=(outputFormat == PAGED) ? out : System.err;
  if (outputFormat == PAGED) {
    statusPrinter=new StatusPrinter(client,out);
    statusPrinter.printInitialStatusUpdates();
  }
 else {
    waitForData();
  }
  if ((!client.isFailed()) && (!client.isGone()) && (!client.isClosed())) {
    QueryResults results=client.isValid() ? client.current() : client.finalResults();
    if (results.getColumns() == null) {
      errorChannel.printf("Query %s has no columns\n",results.getId());
      return;
    }
    List<String> fieldNames=Lists.transform(results.getColumns(),Column.nameGetter());
switch (outputFormat) {
case PAGED:
      pageOutput(Pager.LESS,fieldNames);
    break;
default :
  sendOutput(out,outputFormat,fieldNames);
break;
}
}
if (statusPrinter != null) {
statusPrinter.printFinalInfo();
}
if (client.isClosed()) {
errorChannel.println("Query aborted by user");
}
 else if (client.isGone()) {
errorChannel.println("Query is gone (server restarted?)");
}
 else if (client.isFailed()) {
renderFailure(client.finalResults(),errorChannel);
}
}
