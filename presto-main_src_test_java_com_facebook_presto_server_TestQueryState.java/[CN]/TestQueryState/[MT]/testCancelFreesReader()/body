{
  QueryState queryState=new QueryState(1,5);
  assertRunning(queryState);
  ExecutorService executor=Executors.newCachedThreadPool();
  GetPagesJob getPagesJob=new GetPagesJob(queryState,2,1);
  executor.submit(getPagesJob);
  getPagesJob.waitForStarted();
  getPagesJob.assertBlockedWithCount(0);
  queryState.addPage(createLongPage(0,0));
  getPagesJob.assertBlockedWithCount(1);
  queryState.cancel();
  assertCanceled(queryState);
  getPagesJob.waitForFinished();
  assertEquals(getPagesJob.getPages().size(),1);
}
