{
  OutputBuffers outputBuffers=INITIAL_EMPTY_OUTPUT_BUFFERS.withBuffer("queue",new UnpartitionedPagePartitionFunction());
  SharedBuffer sharedBuffer=new SharedBuffer(TASK_ID,executor,sizeOfPages(5),outputBuffers);
  assertFalse(sharedBuffer.isFinished());
  ExecutorService executor=Executors.newCachedThreadPool();
  GetPagesJob getPagesJob=new GetPagesJob(sharedBuffer,0,2,1);
  executor.submit(getPagesJob);
  getPagesJob.waitForStarted();
  getPagesJob.assertBlockedWithCount(0);
  addPage(sharedBuffer,createPage(0));
  getPagesJob.assertBlockedWithCount(1);
  sharedBuffer.finish();
  assertQueueClosed(sharedBuffer,"queue",1);
  getPagesJob.waitForFinished();
  assertEquals(getPagesJob.getElements().size(),1);
}
