{
  OutputBuffers outputBuffers=INITIAL_EMPTY_OUTPUT_BUFFERS;
  SharedBuffer sharedBuffer=new SharedBuffer(TASK_ID,executor,sizeOfPages(10),outputBuffers);
  assertFalse(sharedBuffer.isFinished());
  outputBuffers=outputBuffers.withNoMoreBufferIds();
  sharedBuffer.setOutputBuffers(outputBuffers);
  assertFalse(sharedBuffer.isFinished());
  sharedBuffer.setOutputBuffers(outputBuffers);
  assertFalse(sharedBuffer.isFinished());
  sharedBuffer.setOutputBuffers(outputBuffers);
  assertFalse(sharedBuffer.isFinished());
  try {
    outputBuffers=INITIAL_EMPTY_OUTPUT_BUFFERS.withBuffer("foo",new UnpartitionedPagePartitionFunction()).withNoMoreBufferIds();
    sharedBuffer.setOutputBuffers(outputBuffers);
    fail("Expected IllegalStateException from addQueue after noMoreQueues has been called");
  }
 catch (  IllegalStateException expected) {
  }
}
