{
  SharedBuffer sharedBuffer=new SharedBuffer(TASK_ID,stateNotificationExecutor,sizeOfPages(5));
  sharedBuffer.setOutputBuffers(INITIAL_EMPTY_OUTPUT_BUFFERS.withBuffer(QUEUE,new UnpartitionedPagePartitionFunction()).withNoMoreBufferIds());
  assertFalse(sharedBuffer.isFinished());
  List<Page> pages=new ArrayList<>();
  for (int i=0; i < 5; i++) {
    Page page=createPage(i);
    addPage(sharedBuffer,page);
    pages.add(page);
  }
  sharedBuffer.setNoMorePages();
  assertBufferResultEquals(TYPES,getBufferResult(sharedBuffer,QUEUE,0,sizeOfPages(5),MAX_WAIT),bufferResult(0,pages));
  assertFalse(sharedBuffer.isFinished());
  assertFalse(sharedBuffer.isFinished());
  sharedBuffer.abort(QUEUE);
  assertTrue(sharedBuffer.isFinished());
}
