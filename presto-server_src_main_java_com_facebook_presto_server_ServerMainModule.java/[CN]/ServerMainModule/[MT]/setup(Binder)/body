{
  ServerConfig serverConfig=buildConfigObject(ServerConfig.class);
  install(new CoordinatorModule());
  if (serverConfig.isCoordinator()) {
    discoveryBinder(binder).bindHttpAnnouncement("presto-coordinator");
  }
  bindFailureDetector(binder,serverConfig.isCoordinator());
  binder.bind(TaskResource.class).in(Scopes.SINGLETON);
  binder.bind(TaskManager.class).to(SqlTaskManager.class).in(Scopes.SINGLETON);
  newExporter(binder).export(TaskManager.class).withGeneratedName();
  binder.bind(TaskExecutor.class).in(Scopes.SINGLETON);
  newExporter(binder).export(TaskExecutor.class).withGeneratedName();
  binder.bind(LocalExecutionPlanner.class).in(Scopes.SINGLETON);
  binder.bind(ExpressionCompiler.class).in(Scopes.SINGLETON);
  bindConfig(binder).to(TaskManagerConfig.class);
  jsonCodecBinder(binder).bindJsonCodec(TaskInfo.class);
  binder.bind(PagesMapper.class).in(Scopes.SINGLETON);
  binder.bind(new TypeLiteral<Supplier<ExchangeClient>>(){
  }
).to(ExchangeClientFactory.class).in(Scopes.SINGLETON);
  httpClientBinder(binder).bindAsyncHttpClient("exchange",ForExchange.class).withTracing();
  bindConfig(binder).to(ExchangeClientConfig.class);
  binder.bind(LocationFactory.class).to(HttpLocationFactory.class).in(Scopes.SINGLETON);
  binder.bind(RemoteTaskFactory.class).to(HttpRemoteTaskFactory.class).in(Scopes.SINGLETON);
  httpClientBinder(binder).bindAsyncHttpClient("scheduler",ForScheduler.class).withTracing();
  bindConfig(binder).to(DatabaseLocalStorageManagerConfig.class);
  binder.bind(LocalStorageManager.class).to(DatabaseLocalStorageManager.class).in(Scopes.SINGLETON);
  newExporter(binder).export(LocalStorageManager.class).withGeneratedName();
  binder.bind(DataStreamManager.class).in(Scopes.SINGLETON);
  binder.bind(DataStreamProvider.class).to(DataStreamManager.class).in(Scopes.SINGLETON);
  newSetBinder(binder,ConnectorDataStreamProvider.class);
  binder.bind(CatalogManager.class).in(Scopes.SINGLETON);
  bindConfig(binder).to(CatalogManagerConfig.class);
  binder.bind(MetadataManager.class).in(Scopes.SINGLETON);
  binder.bind(Metadata.class).to(MetadataManager.class).in(Scopes.SINGLETON);
  binder.install(new HandleJsonModule());
  binder.bind(ConnectorManager.class).in(Scopes.SINGLETON);
  MapBinder<String,ConnectorFactory> connectorFactoryBinder=newMapBinder(binder,String.class,ConnectorFactory.class);
  connectorFactoryBinder.addBinding("native").to(NativeConnectorFactory.class);
  connectorFactoryBinder.addBinding("jmx").to(JmxConnectorFactory.class);
  binder.install(new DualModule());
  binder.install(new InformationSchemaModule());
  binder.install(new SystemTablesModule());
  jsonCodecBinder(binder).bindJsonCodec(TaskUpdateRequest.class);
  jsonCodecBinder(binder).bindJsonCodec(Split.class);
  jsonBinder(binder).addSerializerBinding(Expression.class).to(ExpressionSerializer.class);
  jsonBinder(binder).addDeserializerBinding(Expression.class).to(ExpressionDeserializer.class);
  jsonBinder(binder).addDeserializerBinding(FunctionCall.class).to(FunctionCallDeserializer.class);
  binder.bind(QueryMonitor.class).in(Scopes.SINGLETON);
  eventBinder(binder).bindEventClient(QueryCreatedEvent.class);
  eventBinder(binder).bindEventClient(QueryCompletionEvent.class);
  eventBinder(binder).bindEventClient(SplitCompletionEvent.class);
  String prestoVersion=serverConfig.getPrestoVersion();
  if (prestoVersion == null) {
    prestoVersion=detectPrestoVersion();
  }
  checkState(prestoVersion != null,"presto.version must be provided when it cannot be automatically determined");
  NodeVersion nodeVersion=new NodeVersion(prestoVersion);
  binder.bind(NodeVersion.class).toInstance(nodeVersion);
  ServiceAnnouncementBuilder prestoAnnouncement=discoveryBinder(binder).bindHttpAnnouncement("presto").addProperty("node_version",nodeVersion.toString());
  if (serverConfig.getDataSources() != null) {
    prestoAnnouncement.addProperty("datasources",serverConfig.getDataSources());
  }
  bindDataSource(binder,"presto-metastore",ForMetadata.class,ForShardManager.class);
  jsonCodecBinder(binder).bindJsonCodec(QueryInfo.class);
  jsonCodecBinder(binder).bindJsonCodec(TaskInfo.class);
  jsonCodecBinder(binder).bindJsonCodec(QueryResults.class);
  binder.bind(StatementResource.class).in(Scopes.SINGLETON);
  binder.bind(ExecuteResource.class).in(Scopes.SINGLETON);
  httpClientBinder(binder).bindAsyncHttpClient("execute",ForExecute.class);
  binder.bind(PluginManager.class).in(Scopes.SINGLETON);
  bindConfig(binder).to(PluginManagerConfig.class);
  binder.bind(new TypeLiteral<List<PlanOptimizer>>(){
  }
).toProvider(PlanOptimizersFactory.class).in(Scopes.SINGLETON);
}
