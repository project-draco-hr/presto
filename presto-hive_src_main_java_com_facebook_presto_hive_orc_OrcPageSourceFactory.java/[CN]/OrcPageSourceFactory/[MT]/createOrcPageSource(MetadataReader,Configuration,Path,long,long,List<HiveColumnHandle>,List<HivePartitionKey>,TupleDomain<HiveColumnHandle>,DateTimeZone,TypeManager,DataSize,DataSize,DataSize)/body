{
  OrcDataSource orcDataSource;
  try {
    FileSystem fileSystem=path.getFileSystem(configuration);
    long size=fileSystem.getFileStatus(path).getLen();
    FSDataInputStream inputStream=fileSystem.open(path);
    orcDataSource=new HdfsOrcDataSource(path.toString(),size,maxMergeDistance,maxBufferSize,streamBufferSize,inputStream);
  }
 catch (  Exception e) {
    if (nullToEmpty(e.getMessage()).trim().equals("Filesystem closed") || e instanceof FileNotFoundException) {
      throw new PrestoException(HIVE_CANNOT_OPEN_SPLIT,e);
    }
    throw new PrestoException(HIVE_CANNOT_OPEN_SPLIT,splitError(e,path,start,length),e);
  }
  ImmutableMap.Builder<Integer,Type> includedColumns=ImmutableMap.builder();
  ImmutableList.Builder<ColumnReference<HiveColumnHandle>> columnReferences=ImmutableList.builder();
  for (  HiveColumnHandle column : columns) {
    if (!column.isPartitionKey()) {
      Type type=typeManager.getType(column.getTypeSignature());
      includedColumns.put(column.getHiveColumnIndex(),type);
      columnReferences.add(new ColumnReference<>(column,column.getHiveColumnIndex(),type));
    }
  }
  OrcPredicate predicate=new TupleDomainOrcPredicate<>(effectivePredicate,columnReferences.build());
  try {
    OrcReader reader=new OrcReader(orcDataSource,metadataReader);
    OrcRecordReader recordReader=reader.createRecordReader(includedColumns.build(),predicate,start,length,hiveStorageTimeZone);
    return new OrcPageSource(recordReader,orcDataSource,partitionKeys,columns,hiveStorageTimeZone,typeManager);
  }
 catch (  Exception e) {
    try {
      orcDataSource.close();
    }
 catch (    IOException ignored) {
    }
    if (e instanceof PrestoException) {
      throw (PrestoException)e;
    }
    String message=splitError(e,path,start,length);
    if (e.getClass().getSimpleName().equals("BlockMissingException")) {
      throw new PrestoException(HIVE_MISSING_DATA,message,e);
    }
    throw new PrestoException(HIVE_CANNOT_OPEN_SPLIT,message,e);
  }
}
