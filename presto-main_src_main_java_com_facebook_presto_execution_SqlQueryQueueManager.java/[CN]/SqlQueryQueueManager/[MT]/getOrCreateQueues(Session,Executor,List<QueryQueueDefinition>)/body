{
  ImmutableList.Builder<QueryQueue> queues=ImmutableList.builder();
  for (  QueryQueueDefinition definition : definitions) {
    String expandedName=definition.getExpandedTemplate(session);
    if (!queryQueues.containsKey(expandedName)) {
      QueryQueue queue=new QueryQueue(executor,definition.getMaxQueued(),definition.getMaxConcurrent());
      if (queryQueues.putIfAbsent(expandedName,queue) == null) {
        String objectName=ObjectNames.builder(QueryQueue.class,expandedName).build();
        mbeanExporter.export(objectName,queue);
      }
    }
    queues.add(queryQueues.get(expandedName));
  }
  return queues.build();
}
