{
  List<QueryQueueDefinition> queues=selectQueues(statement,queryExecution.getSession());
  queues=new ArrayList<>(queues);
  Collections.reverse(queues);
  ResourceGroupId groupId=new ResourceGroupId(queues.get(0).getExpandedTemplate(queryExecution.getSession()));
  createGroupIfNecessary(groupId,queryExecution.getSession().toSessionRepresentation(),executor);
  for (  QueryQueueDefinition queue : queues.subList(1,queues.size())) {
    groupId=new ResourceGroupId(groupId,queue.getExpandedTemplate(queryExecution.getSession()));
    createGroupIfNecessary(groupId,queryExecution.getSession().toSessionRepresentation(),executor);
  }
  return groups.get(groupId).add(queryExecution);
}
