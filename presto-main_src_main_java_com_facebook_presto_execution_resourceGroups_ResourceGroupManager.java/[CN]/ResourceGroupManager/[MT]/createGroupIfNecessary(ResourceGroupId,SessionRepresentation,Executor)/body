{
  if (!groups.containsKey(id)) {
    ResourceGroup group;
    if (id.getParent().isPresent()) {
      createGroupIfNecessary(id.getParent().get(),session,executor);
      ResourceGroup parent=groups.get(id.getParent().get());
      requireNonNull(parent,"parent is null");
      group=parent.getOrCreateSubGroup(id.getLastSegment());
    }
 else {
      RootResourceGroup root=new RootResourceGroup(id.getSegments().get(0),executor);
      group=root;
      rootGroups.add(root);
    }
    configurationManager.configure(group,session);
    checkState(groups.put(id,group) == null,"Unexpected existing resource group");
  }
}
