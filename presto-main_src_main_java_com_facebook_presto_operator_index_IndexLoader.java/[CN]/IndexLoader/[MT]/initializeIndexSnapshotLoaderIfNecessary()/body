{
  if (indexSnapshotLoader == null) {
    TaskContext taskContext=taskContextReference.get();
    checkState(taskContext != null,"Task context must be set before index can be built");
    PipelineContext pipelineContext=taskContext.addPipelineContext(false,false);
    indexSnapshotLoader=new IndexSnapshotLoader(driverFactory,pipelineContext,sourcePlanNodeId,pagesIndexOutput,indexSnapshotReference,indexChannels,expectedPositions,maxIndexMemorySize);
  }
}
