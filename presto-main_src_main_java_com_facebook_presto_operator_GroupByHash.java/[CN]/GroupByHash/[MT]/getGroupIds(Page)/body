{
  int positionCount=page.getPositionCount();
  BlockBuilder blockBuilder=BIGINT.createFixedSizeBlockBuilder(positionCount);
  BlockCursor[] cursors=new BlockCursor[channels.length];
  for (int i=0; i < channels.length; i++) {
    cursors[i]=page.getBlock(channels[i]).cursor();
  }
  hashStrategy.setCurrentRow(cursors);
  for (int position=0; position < positionCount; position++) {
    for (    BlockCursor cursor : cursors) {
      checkState(cursor.advanceNextPosition());
    }
    int groupId=pagePositionToGroupId.get(CURRENT_ROW_ADDRESS);
    if (groupId < 0) {
      groupId=addNewGroup(cursors);
    }
    blockBuilder.append(groupId);
  }
  RandomAccessBlock block=blockBuilder.build();
  return new GroupByIdBlock(nextGroupId,block);
}
