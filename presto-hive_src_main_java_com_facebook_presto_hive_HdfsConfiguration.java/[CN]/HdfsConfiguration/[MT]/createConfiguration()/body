{
  Configuration config=new Configuration();
  config.setClass("topology.node.switch.mapping.impl",NoOpDNSToSwitchMapping.class,DNSToSwitchMapping.class);
  if (socksProxy != null) {
    config.setClass("hadoop.rpc.socket.factory.class.default",SocksSocketFactory.class,SocketFactory.class);
    config.set("hadoop.socks.server",socksProxy.toString());
  }
  config.setBoolean("dfs.client.read.shortcircuit",true);
  if (domainSocketPath != null) {
    config.setStrings("dfs.domain.socket.path",domainSocketPath);
  }
  config.setBoolean("dfs.read.shortcircuit",true);
  config.setBoolean("dfs.read.shortcircuit.fallbackwhenfail",true);
  config.setInt("dfs.socket.timeout",Ints.saturatedCast((long)dfsTimeout.toMillis()));
  config.setInt("ipc.ping.interval",Ints.saturatedCast((long)dfsTimeout.toMillis()));
  try {
    ContextFactory factory=ContextFactory.getFactory();
    factory.setAttribute("hdfsclient.class","org.apache.hadoop.metrics.jmx.JMXContext");
    factory.setAttribute("hdfsclient.period","5");
  }
 catch (  IOException e) {
    throw Throwables.propagate(e);
  }
  return config;
}
