{
  checkNotNull(page,"page is null");
  checkState(state == State.RUNNING,"Operator is %s",state);
  BlockCursor[] cursors;
  Type[] types;
  BlockCursor sampleWeightCursor=null;
  if (sampleWeightChannel.isPresent()) {
    cursors=new BlockCursor[page.getChannelCount() - 1];
    types=new Type[page.getChannelCount() - 1];
    sampleWeightCursor=page.getBlock(sampleWeightChannel.get()).cursor();
  }
 else {
    cursors=new BlockCursor[page.getChannelCount()];
    types=new Type[page.getChannelCount()];
  }
  for (int inputChannel=0, outputChannel=0; inputChannel < page.getChannelCount(); inputChannel++) {
    if (sampleWeightChannel.isPresent() && inputChannel == sampleWeightChannel.get()) {
      continue;
    }
    cursors[outputChannel]=page.getBlock(inputChannel).cursor();
    TupleInfo tupleInfo=cursors[outputChannel].getTupleInfo();
    types[outputChannel]=tupleInfo.getType();
    outputChannel++;
  }
  int rows=0;
  for (int position=0; position < page.getPositionCount(); position++) {
    long sampleWeight=1;
    if (sampleWeightCursor != null) {
      checkArgument(sampleWeightCursor.advanceNextPosition());
      sampleWeight=sampleWeightCursor.getLong();
    }
    rows+=sampleWeight;
    recordSink.beginRecord(sampleWeight);
    for (int i=0; i < cursors.length; i++) {
      checkArgument(cursors[i].advanceNextPosition());
      writeField(cursors[i],types[i]);
    }
    recordSink.finishRecord();
  }
  rowCount+=rows;
  for (  BlockCursor cursor : cursors) {
    checkArgument(!cursor.advanceNextPosition());
  }
}
