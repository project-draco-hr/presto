{
  Long tableId=dbi.inTransaction(new TransactionCallback<Long>(){
    @Override public Long inTransaction(    final Handle handle,    TransactionStatus status) throws Exception {
      return runIgnoringConstraintViolation(new Callable<Long>(){
        @Override public Long call() throws Exception {
          MetadataDao dao=handle.attach(MetadataDao.class);
          long tableId=dao.insertTable(catalogName,tableMetadata.getTable().getSchemaName(),tableMetadata.getTable().getTableName());
          int position=1;
          for (          ColumnMetadata column : tableMetadata.getColumns()) {
            dao.insertColumn(tableId,column.getName(),position,column.getType().getName());
            position++;
          }
          return tableId;
        }
      }
,null);
    }
  }
);
  checkState(tableId != null,"table %s already exists",tableMetadata.getTable());
  return new NativeTableHandle(tableMetadata.getTable().getSchemaName(),tableMetadata.getTable().getTableName(),tableId);
}
