{
  final NativeOutputTableHandle table=checkType(outputTableHandle,NativeOutputTableHandle.class,"outputTableHandle");
  dbi.inTransaction(new VoidTransactionCallback(){
    @Override protected void execute(    Handle dbiHandle,    TransactionStatus status){
      MetadataDao dao=dbiHandle.attach(MetadataDao.class);
      long tableId=dao.insertTable(catalogName,table.getSchemaName(),table.getTableName());
      for (int i=0; i < table.getColumnTypes().size(); i++) {
        NativeColumnHandle column=table.getColumnHandles().get(i);
        ColumnType columnType=table.getColumnTypes().get(i);
        dao.insertColumn(tableId,i + 1,column.getColumnName(),i,fromColumnType(columnType).getName());
      }
    }
  }
);
  ImmutableMap.Builder<UUID,String> shards=ImmutableMap.builder();
  for (  String fragment : fragments) {
    Iterator<String> split=Splitter.on(':').split(fragment).iterator();
    String nodeId=split.next();
    UUID shardUuid=UUID.fromString(split.next());
    shards.put(shardUuid,nodeId);
  }
  TableHandle tableHandle=getTableHandle(new SchemaTableName(table.getSchemaName(),table.getTableName()));
  shardManager.commitUnpartitionedTable(tableHandle,shards.build());
}
