{
  Class<?> factoryClass=factory.getClass();
  if (factory instanceof LegacyTransactionConnectorFactory) {
    factoryClass=((LegacyTransactionConnectorFactory)factory).getConnectorFactory().getClass();
  }
  try (ThreadContextClassLoader ignored=new ThreadContextClassLoader(factoryClass.getClassLoader())){
    return factory.create(connectorId,properties);
  }
 }
