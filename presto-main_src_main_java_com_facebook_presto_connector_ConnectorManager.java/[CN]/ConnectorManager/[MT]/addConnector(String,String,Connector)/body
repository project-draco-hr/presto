{
  ConnectorMetadata connectorMetadata=connector.getMetadata();
  checkState(connectorMetadata != null,"Connector %s can not provide metadata",connectorId);
  ConnectorSplitManager connectorSplitManager=connector.getSplitManager();
  checkState(connectorSplitManager != null,"Connector %s does not have a split manager",connectorId);
  ConnectorDataStreamProvider connectorDataStreamProvider=null;
  if (connector instanceof InternalConnector) {
    try {
      connectorDataStreamProvider=((InternalConnector)connector).getDataStreamProvider();
    }
 catch (    UnsupportedOperationException ignored) {
    }
  }
  if (connectorDataStreamProvider == null) {
    ConnectorRecordSetProvider connectorRecordSetProvider=null;
    try {
      connectorRecordSetProvider=connector.getRecordSetProvider();
    }
 catch (    UnsupportedOperationException ignored) {
    }
    checkState(connectorRecordSetProvider != null,"Connector %s does not have a data stream provider",connectorId);
    connectorDataStreamProvider=new RecordSetDataStreamProvider(connectorRecordSetProvider);
  }
  ConnectorHandleResolver connectorHandleResolver=connector.getHandleResolver();
  checkNotNull("Connector %s does not have a handle resolver",connectorId);
  ConnectorRecordSinkProvider connectorRecordSinkProvider=null;
  try {
    connectorRecordSinkProvider=connector.getRecordSinkProvider();
    checkNotNull(connectorRecordSinkProvider,"Connector %s returned a null record sink provider",connectorId);
  }
 catch (  UnsupportedOperationException ignored) {
  }
  ConnectorOutputHandleResolver connectorOutputHandleResolver=null;
  try {
    connectorOutputHandleResolver=connector.getOutputHandleResolver();
    checkNotNull(connectorOutputHandleResolver,"Connector %s returned a null output handle resolver",connectorId);
  }
 catch (  UnsupportedOperationException ignored) {
  }
  ConnectorIndexResolver indexResolver=null;
  try {
    indexResolver=connector.getIndexResolver();
    checkNotNull(indexResolver,"Connector %s returned a null index resolver",connectorId);
  }
 catch (  UnsupportedOperationException ignored) {
  }
  if (catalogName != null) {
    metadataManager.addConnectorMetadata(connectorId,catalogName,connectorMetadata);
    metadataManager.addInternalSchemaMetadata(makeInformationSchemaConnectorId(connectorId),new InformationSchemaMetadata(catalogName));
    splitManager.addConnectorSplitManager(makeInformationSchemaConnectorId(connectorId),new InformationSchemaSplitManager(nodeManager));
    dataStreamManager.addConnectorDataStreamProvider(makeInformationSchemaConnectorId(connectorId),new InformationSchemaDataStreamProvider(metadataManager,splitManager));
  }
 else {
    metadataManager.addInternalSchemaMetadata(connectorId,connectorMetadata);
  }
  splitManager.addConnectorSplitManager(connectorId,connectorSplitManager);
  handleResolver.addHandleResolver(connectorId,connectorHandleResolver);
  dataStreamManager.addConnectorDataStreamProvider(connectorId,connectorDataStreamProvider);
  if (connectorRecordSinkProvider != null) {
    recordSinkManager.addConnectorRecordSinkProvider(connectorRecordSinkProvider);
  }
  if (connectorOutputHandleResolver != null) {
    outputTableHandleResolver.addHandleResolver(connectorId,connectorOutputHandleResolver);
  }
  if (indexResolver != null) {
    indexManager.addIndexResolver(indexResolver);
  }
}
