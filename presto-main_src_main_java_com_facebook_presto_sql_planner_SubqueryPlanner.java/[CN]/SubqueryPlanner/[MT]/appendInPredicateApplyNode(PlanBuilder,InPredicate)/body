{
  subPlan=subPlan.appendProjections(ImmutableList.of(inPredicate.getValue()),symbolAllocator,idAllocator);
  checkState(inPredicate.getValueList() instanceof SubqueryExpression);
  SubqueryExpression subqueryExpression=(SubqueryExpression)inPredicate.getValueList();
  RelationPlan valueListRelation=createRelationPlan(subqueryExpression.getQuery());
  TranslationMap translationMap=subPlan.copyTranslations();
  SymbolReference valueList=getOnlyElement(valueListRelation.getOutputSymbols()).toSymbolReference();
  translationMap.put(inPredicate,new InPredicate(inPredicate.getValue(),valueList));
  return new PlanBuilder(translationMap,new ApplyNode(idAllocator.getNextId(),subPlan.getRoot(),valueListRelation.getRoot(),ImmutableList.of()),subPlan.getSampleWeight());
}
