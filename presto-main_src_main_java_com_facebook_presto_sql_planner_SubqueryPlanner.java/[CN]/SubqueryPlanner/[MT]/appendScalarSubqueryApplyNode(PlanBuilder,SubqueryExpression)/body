{
  if (subPlan.canTranslate(scalarSubquery)) {
    return subPlan;
  }
  EnforceSingleRowNode enforceSingleRowNode=new EnforceSingleRowNode(idAllocator.getNextId(),createRelationPlan(scalarSubquery).getRoot());
  TranslationMap translations=subPlan.copyTranslations();
  translations.put(scalarSubquery,getOnlyElement(enforceSingleRowNode.getOutputSymbols()));
  PlanNode root=subPlan.getRoot();
  if (root.getOutputSymbols().isEmpty()) {
    return new PlanBuilder(translations,enforceSingleRowNode,subPlan.getSampleWeight());
  }
 else {
    return new PlanBuilder(translations,new ApplyNode(idAllocator.getNextId(),root,enforceSingleRowNode,ImmutableList.of()),subPlan.getSampleWeight());
  }
}
