{
  boolean needsToNotify;
synchronized (this) {
    listeners.add(listener);
    needsToNotify=queryState.isDone();
  }
  if (needsToNotify) {
    notifyListeners(ImmutableList.of(listener));
  }
}
