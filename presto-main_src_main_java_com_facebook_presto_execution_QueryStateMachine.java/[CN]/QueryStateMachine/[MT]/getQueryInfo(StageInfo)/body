{
  QueryState state=queryState.get();
  FailureInfo failureInfo=null;
  if (state != FINISHED) {
    failureInfo=toFailure(failureCause);
  }
  int totalTasks=0;
  int runningTasks=0;
  int completedTasks=0;
  int totalDrivers=0;
  int queuedDrivers=0;
  int startedDrivers=0;
  int runningDrivers=0;
  int completedDrivers=0;
  long totalMemoryReservation=0;
  long totalScheduledTime=0;
  long totalCpuTime=0;
  long totalUserTime=0;
  long totalBlockedTime=0;
  long inputDataSize=0;
  long inputPositions=0;
  long outputDataSize=0;
  long outputPositions=0;
  if (rootStage != null) {
    for (    StageInfo stageInfo : getAllStages(rootStage)) {
      StageStats stageStats=stageInfo.getStageStats();
      totalTasks+=stageStats.getTotalTasks();
      runningTasks+=stageStats.getRunningTasks();
      completedTasks+=stageStats.getCompletedTasks();
      totalDrivers=stageStats.getTotalDrivers();
      queuedDrivers=stageStats.getQueuedDrivers();
      startedDrivers=stageStats.getStartedDrivers();
      runningDrivers=stageStats.getRunningDrivers();
      completedDrivers=stageStats.getCompletedDrivers();
      totalMemoryReservation+=stageStats.getTotalMemoryReservation().toBytes();
      totalScheduledTime+=stageStats.getTotalScheduledTime().roundTo(NANOSECONDS);
      totalCpuTime+=stageStats.getTotalCpuTime().roundTo(NANOSECONDS);
      totalUserTime+=stageStats.getTotalUserTime().roundTo(NANOSECONDS);
      totalBlockedTime+=stageStats.getTotalBlockedTime().roundTo(NANOSECONDS);
      inputDataSize+=stageStats.getInputDataSize().toBytes();
      inputPositions+=stageStats.getInputPositions();
      outputDataSize+=stageStats.getOutputDataSize().toBytes();
      outputPositions+=stageStats.getOutputPositions();
    }
  }
  QueryStats queryStats=new QueryStats(createTime,executionStartTime,lastHeartbeat,endTime,queuedTime,analysisTime,distributedPlanningTime,totalTasks,runningTasks,completedTasks,totalDrivers,queuedDrivers,startedDrivers,runningDrivers,completedDrivers,new DataSize(totalMemoryReservation,BYTE).convertToMostSuccinctDataSize(),new Duration(totalScheduledTime,NANOSECONDS).convertToMostSuccinctTimeUnit(),new Duration(totalCpuTime,NANOSECONDS).convertToMostSuccinctTimeUnit(),new Duration(totalUserTime,NANOSECONDS).convertToMostSuccinctTimeUnit(),new Duration(totalBlockedTime,NANOSECONDS).convertToMostSuccinctTimeUnit(),new DataSize(inputDataSize,BYTE).convertToMostSuccinctDataSize(),inputPositions,new DataSize(outputDataSize,BYTE).convertToMostSuccinctDataSize(),outputPositions);
  return new QueryInfo(queryId,session,state,self,outputFieldNames,query,queryStats,rootStage,failureInfo);
}
