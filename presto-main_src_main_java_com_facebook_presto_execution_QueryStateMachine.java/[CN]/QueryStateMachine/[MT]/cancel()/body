{
  queryStats.recordEnd();
synchronized (this) {
    if (failureCause == null) {
      failureCause=new RuntimeException("Query was canceled");
    }
  }
  return queryState.setIf(CANCELED,Predicates.not(inDoneState()));
}
