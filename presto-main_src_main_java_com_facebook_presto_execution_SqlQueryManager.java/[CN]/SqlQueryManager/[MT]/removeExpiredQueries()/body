{
  while (expirationQueue.size() > maxQueryHistory) {
    QueryExecution query=expirationQueue.remove();
    removeQuery(query.getQueryInfo().getQueryId());
  }
  DateTime oldestAllowedQuery=DateTime.now().minus(maxQueryAge.toMillis());
  while (expirationQueue.size() > 0) {
    QueryExecution query=expirationQueue.peek();
    if (query.getQueryInfo().getQueryStats().getEndTime().isAfter(oldestAllowedQuery)) {
      return;
    }
    removeQuery(query.getQueryInfo().getQueryId());
    expirationQueue.remove();
  }
}
