{
  for (  QueryExecution queryExecution : queries.values()) {
    QueryInfo queryInfo=queryExecution.getQueryInfo();
    if (queryInfo.getState().isDone()) {
      continue;
    }
    if (isAbandoned(queryExecution)) {
      log.info("Failing abandoned query %s",queryExecution.getQueryId());
      queryExecution.fail(new AbandonedException("Query " + queryInfo.getQueryId(),queryInfo.getQueryStats().getLastHeartbeat(),DateTime.now()));
    }
  }
}
