{
  checkNotNull(query,"query is null");
  Preconditions.checkArgument(query.length() > 0,"query must not be empty string");
  String queryId=String.valueOf(nextQueryId.getAndIncrement());
  QueryExecution queryExecution;
  Statement statement=SqlParser.createStatement(query);
  QueryExecutionFactory<?> queryExecutionFactory=executionFactories.get(statement.getClass());
  Preconditions.checkState(queryExecutionFactory != null,"Unsupported statement type %s",statement.getClass().getName());
  queryExecution=queryExecutionFactory.createQueryExecution(queryId,query,session,statement);
  queryMonitor.createdEvent(queryExecution.getQueryInfo());
  queries.put(queryId,queryExecution);
  queryExecutor.submit(new QueryStarter(queryExecution));
  return queryExecution.getQueryInfo();
}
