{
  checkNotNull(query,"query is null");
  Preconditions.checkArgument(query.length() > 0,"query must not be empty string");
  String queryId=String.valueOf(nextQueryId.getAndIncrement());
  QueryExecution queryExecution;
  Statement statement=SqlParser.createStatement(query);
  QueryInfo queryInfo=QueryInfo.createQueryInfo(queryId,session,locationFactory.createQueryLocation(queryId),query);
  SimpleQueryExecutionFactory<?> queryExecutionFactory=simpleExecutions.get(statement.getClass());
  if (queryExecutionFactory != null) {
    queryExecution=queryExecutionFactory.createQueryExecution(statement,queryInfo);
  }
 else {
    queryExecution=sqlQueryExecutionFactory.createSqlQueryExecution(statement,queryInfo,maxPendingSplitsPerNode,queryExecutor);
  }
  queries.put(queryId,queryExecution);
  queryExecutor.submit(new QueryStarter(queryExecution));
  return queryExecution.getQueryInfo();
}
