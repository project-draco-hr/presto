{
  if (charset == null) {
    throw new NullPointerException("charset");
  }
  Map<Charset,CharsetEncoder> map=encoders.get();
  CharsetEncoder e=map.get(charset);
  if (e != null) {
    e.reset();
    e.onMalformedInput(CodingErrorAction.REPLACE);
    e.onUnmappableCharacter(CodingErrorAction.REPLACE);
    return e;
  }
  e=charset.newEncoder();
  e.onMalformedInput(CodingErrorAction.REPLACE);
  e.onUnmappableCharacter(CodingErrorAction.REPLACE);
  map.put(charset,e);
  return e;
}
