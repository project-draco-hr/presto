{
  BlockBuilder blockBuilder=VARCHAR.createBlockBuilder(new BlockBuilderStatus());
  VARCHAR.writeString(blockBuilder,"alice");
  VARCHAR.writeString(blockBuilder,"bob");
  VARCHAR.writeString(blockBuilder,"charlie");
  VARCHAR.writeString(blockBuilder,"dave");
  Block block=blockBuilder.build();
  DynamicSliceOutput encoderOutput=new DynamicSliceOutput(1024);
  Encoder encoder=BlocksFileEncoding.SNAPPY.createBlocksWriter(encoderOutput);
  BlockBuilder expectedBlockBuilder=VARCHAR.createBlockBuilder(new BlockBuilderStatus());
  int count=1000;
  for (int i=0; i < count; i++) {
    int position=ThreadLocalRandom.current().nextInt(block.getPositionCount());
    VARCHAR.appendTo(block,position,expectedBlockBuilder);
    encoder.append(block.getSingleValueBlock(position));
  }
  Block expectedBlock=expectedBlockBuilder.build();
  BlockEncoding snappyEncoding=encoder.finish();
  assertTrue(encoderOutput.size() < expectedBlock.getSizeInBytes());
  Block actualBlock=snappyEncoding.readBlock(encoderOutput.slice().getInput());
  BlockAssertions.assertBlockEquals(actualBlock,expectedBlock);
}
