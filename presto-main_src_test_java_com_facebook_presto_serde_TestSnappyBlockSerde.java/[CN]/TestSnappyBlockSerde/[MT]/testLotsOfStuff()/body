{
  ImmutableList<Tuple> tuples=ImmutableList.of(createTuple("alice"),createTuple("bob"),createTuple("charlie"),createTuple("dave"));
  DynamicSliceOutput blockSlice=new DynamicSliceOutput(1024);
  DynamicSliceOutput compressedOutput=new DynamicSliceOutput(1024);
  Encoder encoder=BlocksFileEncoding.SNAPPY.createBlocksWriter(compressedOutput);
  int count=1000;
  Random r=new Random();
  for (int i=0; i < count; i++) {
    int x=r.nextInt(tuples.size());
    tuples.get(x).writeTo(blockSlice);
    encoder.append(ImmutableSet.of(tuples.get(x)));
  }
  Block expectedBlock=new UncompressedBlock(count,TupleInfo.SINGLE_VARBINARY,blockSlice.slice());
  BlockEncoding snappyEncoding=encoder.finish();
  assertTrue(compressedOutput.size() < blockSlice.size());
  Block actualBlock=snappyEncoding.readBlock(compressedOutput.slice().getInput());
  BlockAssertions.assertBlockEquals(actualBlock,expectedBlock);
}
