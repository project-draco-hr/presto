{
  ImmutableList<Tuple> tuples=ImmutableList.of(createTuple("alice"),createTuple("bob"),createTuple("charlie"),createTuple("dave"));
  DynamicSliceOutput encoderOutput=new DynamicSliceOutput(1024);
  Encoder encoder=BlocksFileEncoding.SNAPPY.createBlocksWriter(encoderOutput);
  BlockBuilder expectedBlockBuilder=new BlockBuilder(TupleInfo.SINGLE_VARBINARY);
  int count=1000;
  for (int i=0; i < count; i++) {
    Tuple tuple=tuples.get(ThreadLocalRandom.current().nextInt(tuples.size()));
    expectedBlockBuilder.append(tuple);
    Block block=new BlockBuilder(TupleInfo.SINGLE_VARBINARY).append(tuple).build();
    encoder.append(block);
  }
  Block expectedBlock=expectedBlockBuilder.build();
  BlockEncoding snappyEncoding=encoder.finish();
  assertTrue(encoderOutput.size() < expectedBlock.getDataSize().toBytes());
  Block actualBlock=snappyEncoding.readBlock(encoderOutput.slice().getInput());
  BlockAssertions.assertBlockEquals(actualBlock,expectedBlock);
}
