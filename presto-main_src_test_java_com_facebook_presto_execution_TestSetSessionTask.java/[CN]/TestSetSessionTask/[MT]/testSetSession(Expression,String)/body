{
  TransactionManager transactionManager=createTestTransactionManager();
  QueryStateMachine stateMachine=QueryStateMachine.begin(new QueryId("query"),"set foo.bar = 'baz'",TEST_SESSION,URI.create("fake://uri"),true,transactionManager,executor);
  new SetSessionTask().execute(new SetSession(QualifiedName.of("foo","bar"),expression),TEST_SESSION,metadata,new AllowAllAccessControl(),stateMachine).join();
  Map<String,String> sessionProperties=stateMachine.getSetSessionProperties();
  assertEquals(sessionProperties,ImmutableMap.of("foo.bar",expectedValue));
}
