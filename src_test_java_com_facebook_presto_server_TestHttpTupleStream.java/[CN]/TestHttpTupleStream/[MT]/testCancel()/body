{
  ExecutorService executor=Executors.newCachedThreadPool();
  try {
    AsyncHttpClient httpClient=new AsyncHttpClient(client,executor);
    QueryDriversTupleStream tupleStream=new QueryDriversTupleStream(TupleInfo.SINGLE_VARBINARY,10,new HttpQueryProvider(httpClient,server1.getBaseUrl().resolve("/v1/presto/query")),new HttpQueryProvider(httpClient,server2.getBaseUrl().resolve("/v1/presto/query")),new HttpQueryProvider(httpClient,server3.getBaseUrl().resolve("/v1/presto/query")));
    int count=0;
    QueryDriversBlockIterator iterator=tupleStream.iterator();
    while (count < 20 && iterator.hasNext()) {
      iterator.next();
      count++;
    }
    assertEquals(count,20);
    assertTrue(iterator.hasNext());
    iterator.cancel();
    assertTrue(iterator.hasNext());
    assertNotNull(iterator.next());
    assertFalse(iterator.hasNext());
  }
  finally {
    executor.shutdownNow();
  }
}
