{
  PlanFragment planFragment=new PlanFragment(new PlanFragmentId("32"),null,ImmutableMap.<Symbol,Type>of(),new ExchangeNode(new PlanNodeId("1"),new PlanFragmentId("22"),ImmutableList.<Symbol>of()));
  Session session=new Session(null,DEFAULT_CATALOG,DEFAULT_SCHEMA);
  QueryFragmentRequest fragmentRequest=new QueryFragmentRequest(session,"queryId","stageId",planFragment,ImmutableMap.<PlanNodeId,ExchangePlanFragmentSource>of(),ImmutableList.of("out"));
  Request request=preparePut().setUri(httpServer.getBaseUrl().resolve("/v1/task/foo-" + httpServer.getPort())).setHeader(HttpHeaders.CONTENT_TYPE,MediaType.APPLICATION_JSON).setBodyGenerator(jsonBodyGenerator(jsonCodec(QueryFragmentRequest.class),fragmentRequest)).build();
  JsonResponse<TaskInfo> response=httpClient.execute(request,createFullJsonResponseHandler(jsonCodec(TaskInfo.class)));
  Preconditions.checkState(response.getStatusCode() == 201,"Expected response code from %s to be 201, but was %s: %s",request.getUri(),response.getStatusCode(),response.getStatusMessage());
  TaskInfo taskInfo=response.getValue();
  Assert.assertEquals(taskInfo.getOutputBuffers().size(),1);
  String bufferId=taskInfo.getOutputBuffers().get(0).getBufferId();
  return uriBuilderFrom(taskInfo.getSelf()).appendPath("results").appendPath(bufferId).build();
}
