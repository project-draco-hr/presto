{
  try {
    TaskInfo taskInfo=getTaskInfo();
    if (response.getStatusCode() != HttpStatus.GONE.code()) {
      checkState(response.getStatusCode() == HttpStatus.OK.code(),"Expected response code from %s to be %s, but was %s: %s",taskInfo.getSelf(),HttpStatus.OK.code(),response.getStatusCode(),response.getStatusMessage());
      if (response.hasValue()) {
        try {
          updateTaskInfo(response.getValue());
        }
 catch (        Exception ignored) {
          updateState(false);
          return;
        }
        hasResponseError.set(false);
      }
 else       if (response.getException() != null) {
        if (hasResponseError.compareAndSet(false,true)) {
          log.error(response.getException(),"Error decoding json response from %s",taskInfo.getSelf());
        }
 else {
          log.debug("Error decoding json response from %s",taskInfo.getSelf());
        }
      }
      acknowledgeSources(sources);
      updateIfNecessary();
    }
 else {
      updateTaskInfo(new TaskInfo(taskInfo.getQueryId(),taskInfo.getStageId(),taskInfo.getTaskId(),TaskInfo.MAX_VERSION,TaskState.CANCELED,taskInfo.getSelf(),taskInfo.getOutputBuffers(),taskInfo.getNoMoreSplits(),taskInfo.getStats(),ImmutableList.<SplitExecutionStats>of(),ImmutableList.<FailureInfo>of()));
    }
  }
 catch (  Throwable t) {
    setException(t);
  }
 finally {
    set(null);
  }
}
