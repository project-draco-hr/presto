{
  try {
    TaskInfo taskInfo=getTaskInfo();
    if (response.getStatusCode() == HttpStatus.OK.code() && response.hasValue()) {
      updateTaskInfo(response.getValue());
      lastSuccessfulRequest.set(System.nanoTime());
      consecutiveErrorCount.set(0);
      acknowledgeSources(sources);
      updateIfNecessary();
    }
 else     if (response.getStatusCode() == HttpStatus.INTERNAL_SERVER_ERROR.code()) {
      log.debug(String.format("Server at %s returned %s: %s",taskInfo.getSelf(),response.getStatusCode(),response.getStatusMessage()));
      requestFailed();
      updateState(false);
    }
 else     if (response.getStatusCode() == HttpStatus.SERVICE_UNAVAILABLE.code()) {
      requestFailed();
    }
 else {
      Exception cause=response.getException();
      if (cause == null) {
        cause=new RuntimeException(String.format("Expected response code from %s to be %s, but was %s: %s",taskInfo.getSelf(),HttpStatus.OK.code(),response.getStatusCode(),response.getStatusMessage()));
      }
      failTask(cause);
    }
  }
 catch (  Throwable t) {
    setException(t);
    requestFailed();
  }
 finally {
    set(null);
  }
}
