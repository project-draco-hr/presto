{
  Preconditions.checkState(!Thread.holdsLock(this),"Update state can not be called while holding a lock on this");
synchronized (this) {
    if (noMoreOutputIds == noMore && this.outputIds.containsAll(outputBuffers)) {
      return;
    }
    Preconditions.checkState(!noMoreOutputIds,"New buffers can not be added after noMoreOutputIds has been set");
    noMoreOutputIds=noMore;
    this.outputIds.addAll(outputBuffers);
  }
  updateState();
}
