{
  Preconditions.checkState(!Thread.holdsLock(this),"Update state can not be called while holding a lock on this");
synchronized (this) {
    Preconditions.checkNotNull(split,"split is null");
    Preconditions.checkState(!noMoreSplits,"noMoreSplits has already been set");
    Preconditions.checkState(planFragment.isPartitioned(),"Plan is not partitioned");
    if (!getTaskInfo().getState().isDone()) {
      pendingSplits.put(planFragment.getPartitionedSource(),new ScheduledSplit(nextSplitId.getAndIncrement(),split));
    }
  }
  updateState(false);
}
