{
  HiveOutputTableHandle handle=checkType(tableHandle,HiveOutputTableHandle.class,"tableHandle");
  Path targetPath=new Path(handle.getTargetPath());
  if (handle.hasTemporaryPath()) {
    if (pathExists(targetPath)) {
      SchemaTableName table=new SchemaTableName(handle.getSchemaName(),handle.getTableName());
      throw new RuntimeException(format("Unable to commit creation of table '%s': target directory already exists: %s",table,targetPath));
    }
    rename(new Path(handle.getTemporaryPath()),targetPath);
  }
  List<String> types=FluentIterable.from(handle.getColumnTypes()).transform(columnTypeToHiveType()).transform(hiveTypeNameGetter()).toList();
  boolean sampled=false;
  ImmutableList.Builder<FieldSchema> columns=ImmutableList.builder();
  for (int i=0; i < handle.getColumnNames().size(); i++) {
    String name=handle.getColumnNames().get(i);
    String type=types.get(i);
    if (name.equals(SAMPLE_WEIGHT_COLUMN_NAME)) {
      columns.add(new FieldSchema(name,type,"Presto sample weight column"));
      sampled=true;
    }
 else {
      columns.add(new FieldSchema(name,type,null));
    }
  }
  HiveStorageFormat hiveStorageFormat=handle.getHiveStorageFormat();
  SerDeInfo serdeInfo=new SerDeInfo();
  serdeInfo.setName(handle.getTableName());
  serdeInfo.setSerializationLib(hiveStorageFormat.getSerDe());
  serdeInfo.setParameters(ImmutableMap.<String,String>of());
  StorageDescriptor sd=new StorageDescriptor();
  sd.setLocation(targetPath.toString());
  sd.setCols(columns.build());
  sd.setSerdeInfo(serdeInfo);
  sd.setInputFormat(hiveStorageFormat.getInputFormat());
  sd.setOutputFormat(hiveStorageFormat.getOutputFormat());
  sd.setParameters(ImmutableMap.<String,String>of());
  Table table=new Table();
  table.setDbName(handle.getSchemaName());
  table.setTableName(handle.getTableName());
  table.setOwner(handle.getTableOwner());
  table.setTableType(TableType.MANAGED_TABLE.toString());
  String tableComment="Created by Presto";
  if (sampled) {
    tableComment="Sampled table created by Presto. Only query this table from Hive if you understand how Presto implements sampling.";
  }
  table.setParameters(ImmutableMap.of("comment",tableComment));
  table.setPartitionKeys(ImmutableList.<FieldSchema>of());
  table.setSd(sd);
  metastore.createTable(table);
}
