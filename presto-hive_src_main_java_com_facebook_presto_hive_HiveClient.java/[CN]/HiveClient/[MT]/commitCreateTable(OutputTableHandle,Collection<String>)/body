{
  checkNotNull(tableHandle,"tableHandle is null");
  checkArgument(tableHandle instanceof HiveOutputTableHandle,"tableHandle is not an instance of HiveOutputTableHandle");
  HiveOutputTableHandle handle=(HiveOutputTableHandle)tableHandle;
  Path targetPath=new Path(handle.getTargetPath());
  if (pathExists(targetPath)) {
    SchemaTableName table=new SchemaTableName(handle.getSchemaName(),handle.getTableName());
    throw new RuntimeException(format("Unable to commit creation of table '%s': target directory already exists: %s",table,targetPath));
  }
  rename(new Path(handle.getTemporaryPath()),targetPath);
  List<String> types=FluentIterable.from(handle.getColumnTypes()).transform(columnTypeToHiveType()).transform(hiveTypeNameGetter()).toList();
  ImmutableList.Builder<FieldSchema> columns=ImmutableList.builder();
  for (int i=0; i < handle.getColumnNames().size(); i++) {
    String name=handle.getColumnNames().get(i);
    String type=types.get(i);
    columns.add(new FieldSchema(name,type,null));
  }
  SerDeInfo serdeInfo=new SerDeInfo();
  serdeInfo.setName(handle.getTableName());
  serdeInfo.setSerializationLib(LazyBinaryColumnarSerDe.class.getName());
  StorageDescriptor sd=new StorageDescriptor();
  sd.setLocation(targetPath.toString());
  sd.setCols(columns.build());
  sd.setSerdeInfo(serdeInfo);
  sd.setInputFormat(RCFileInputFormat.class.getName());
  sd.setOutputFormat(RCFileOutputFormat.class.getName());
  Table table=new Table();
  table.setDbName(handle.getSchemaName());
  table.setTableName(handle.getTableName());
  table.setOwner(handle.getTableOwner());
  table.setTableType(TableType.MANAGED_TABLE.toString());
  table.setParameters(ImmutableMap.of("comment","Created by Presto"));
  table.setSd(sd);
  metastore.createTable(table);
}
