{
  if (partitionNames.equals(ImmutableList.of(UnpartitionedPartition.UNPARTITIONED_NAME))) {
    return ImmutableList.<Partition>of(UnpartitionedPartition.INSTANCE);
  }
  Iterable<List<String>> partitionNameBatches=partitionExponentially(partitionNames,partitionBatchSize);
  Iterable<List<Partition>> partitionBatches=transform(partitionNameBatches,new Function<List<String>,List<Partition>>(){
    @Override public List<Partition> apply(    List<String> partitionNameBatch){
      Exception exception=null;
      for (int attempt=0; attempt < 10; attempt++) {
        try {
          List<Partition> partitions=metastore.getPartitionsByNames(databaseName,tableName,partitionNameBatch);
          checkState(partitionNameBatch.size() == partitions.size(),"expected %s partitions but found %s",partitionNameBatch.size(),partitions.size());
          return partitions;
        }
 catch (        NoSuchObjectException|NullPointerException|IllegalStateException|IllegalArgumentException e) {
          throw Throwables.propagate(e);
        }
catch (        Exception e) {
          exception=e;
          log.debug("getPartitions attempt %s failed, will retry. Exception: %s",attempt,e.getMessage());
        }
        try {
          TimeUnit.SECONDS.sleep(1);
        }
 catch (        InterruptedException e) {
          Thread.currentThread().interrupt();
          throw Throwables.propagate(e);
        }
      }
      throw Throwables.propagate(exception);
    }
  }
);
  return concat(partitionBatches);
}
