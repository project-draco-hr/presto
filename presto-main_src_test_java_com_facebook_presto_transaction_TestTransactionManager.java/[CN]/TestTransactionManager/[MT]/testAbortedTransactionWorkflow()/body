{
  try (IdleCheckExecutor executor=new IdleCheckExecutor()){
    TransactionManager transactionManager=TransactionManager.create(new TransactionManagerConfig(),executor.getExecutor(),finishingExecutor);
    Connector c1=new TpchConnectorFactory(new InMemoryNodeManager()).create("c1",ImmutableMap.of());
    transactionManager.addConnector("c1",c1);
    TransactionId transactionId=transactionManager.beginTransaction(false);
    assertEquals(transactionManager.getAllTransactionInfos().size(),1);
    TransactionInfo transactionInfo=transactionManager.getTransactionInfo(transactionId);
    assertFalse(transactionInfo.isAutoCommitContext());
    assertTrue(transactionInfo.getConnectorIds().isEmpty());
    assertFalse(transactionInfo.getWrittenConnectorId().isPresent());
    ConnectorMetadata metadata=transactionManager.getMetadata(transactionId,"c1");
    metadata.listSchemaNames(TEST_SESSION.toConnectorSession("c1"));
    transactionInfo=transactionManager.getTransactionInfo(transactionId);
    assertEquals(transactionInfo.getConnectorIds(),ImmutableList.of("c1"));
    assertFalse(transactionInfo.getWrittenConnectorId().isPresent());
    transactionManager.asyncAbort(transactionId).join();
    assertTrue(transactionManager.getAllTransactionInfos().isEmpty());
  }
 }
