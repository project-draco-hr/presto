{
  ImmutableMap.Builder<String,ExchangePlanFragmentSource> exchangeSources=ImmutableMap.builder();
  for (  StageExecutionPlan dependency : stageExecutionPlan.getDependencies()) {
    List<HttpTaskClient> tasks=stages.get(dependency.getStageId());
    ImmutableMap.Builder<String,URI> sources=ImmutableMap.builder();
    for (    HttpTaskClient provider : tasks) {
      sources.put(provider.getTaskId(),provider.getLocation());
    }
    ExchangePlanFragmentSource exchangeSource=new ExchangePlanFragmentSource(sources.build(),node.getNodeIdentifier(),tasks.get(0).getTupleInfos());
    exchangeSources.put(dependency.getStageId(),exchangeSource);
  }
  return exchangeSources.build();
}
