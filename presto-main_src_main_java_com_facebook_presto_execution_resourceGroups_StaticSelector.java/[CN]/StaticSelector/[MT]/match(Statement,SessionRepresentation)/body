{
  if (userRegex.isPresent() && !userRegex.get().matcher(session.getUser()).matches()) {
    return Optional.empty();
  }
  if (sourceRegex.isPresent()) {
    String source=session.getSource().orElse("");
    if (!sourceRegex.get().matcher(source).matches()) {
      return Optional.empty();
    }
  }
  for (  Map.Entry<String,Pattern> entry : sessionPropertyRegexes.entrySet()) {
    String value=session.getSystemProperties().getOrDefault(entry.getKey(),"");
    if (!entry.getValue().matcher(value).matches()) {
      return Optional.empty();
    }
  }
  return Optional.of(group.expandTemplate(session));
}
