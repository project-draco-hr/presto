{
  List<Object> elements=new ArrayList<>(maxSize);
  queue.drainTo(elements,maxSize);
  if (queue.isEmpty() && !finished.get()) {
    CompletableFuture<?> future=notEmptyFuture.get();
    if (future.isDone()) {
      notEmptyFuture.compareAndSet(future,new CompletableFuture<>());
    }
  }
  if (!queue.isEmpty() || finished.get()) {
    notEmptyFuture.get().complete(null);
  }
  return ImmutableList.copyOf((Collection<T>)elements);
}
