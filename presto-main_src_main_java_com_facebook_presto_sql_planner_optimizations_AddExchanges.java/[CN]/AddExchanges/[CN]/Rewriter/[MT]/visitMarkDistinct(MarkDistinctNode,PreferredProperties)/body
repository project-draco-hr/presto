{
  PreferredProperties preferredChildProperties=determineChildPreferences(preferred,node.getDistinctSymbols(),node.getDistinctSymbols());
  PlanWithProperties child=node.getSource().accept(this,preferredChildProperties);
  if ((child.getProperties().isUnpartitioned() && isBigQueryEnabled(session,false)) || !child.getProperties().isPartitionedOn(node.getDistinctSymbols())) {
    child=withDerivedProperties(partitionedExchange(idAllocator.getNextId(),child.getNode(),node.getDistinctSymbols(),node.getHashSymbol()),child.getProperties());
  }
  return rebaseAndDeriveProperties(node,child);
}
