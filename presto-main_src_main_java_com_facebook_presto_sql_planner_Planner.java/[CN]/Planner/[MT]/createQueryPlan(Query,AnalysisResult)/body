{
  PlanNode root=createRelationPlan(query.getFrom(),analysis);
  if (analysis.getPredicate() != null) {
    root=createFilterPlan(root,analysis.getPredicate());
  }
  if (!analysis.getAggregations().isEmpty()) {
    root=createAggregatePlan(root,analysis.getOutputExpressions(),analysis.getAggregations(),analysis.getGroupByExpressions(),analysis.getSlotAllocator());
  }
 else {
    root=createProjectPlan(root,analysis.getOutputExpressions());
  }
  if (analysis.getLimit() != null) {
    root=new LimitNode(root,analysis.getLimit());
  }
  return root;
}
