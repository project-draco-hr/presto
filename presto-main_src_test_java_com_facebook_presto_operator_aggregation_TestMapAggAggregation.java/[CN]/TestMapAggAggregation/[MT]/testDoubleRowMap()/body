{
  RowType innerRowType=new RowType(ImmutableList.of(BIGINT,DOUBLE),Optional.of(ImmutableList.of("f1","f2")));
  MapType mapType=new MapType(DOUBLE,innerRowType);
  InternalAggregationFunction aggFunc=metadata.getExactFunction(new Signature(NAME,mapType.getTypeSignature().toString(),StandardTypes.DOUBLE,innerRowType.getTypeSignature().toString())).getAggregationFunction();
  PageBuilder builder=new PageBuilder(ImmutableList.of(DOUBLE,innerRowType));
  builder.declarePosition();
  DOUBLE.writeDouble(builder.getBlockBuilder(0),1.0);
  innerRowType.writeObject(builder.getBlockBuilder(1),testRowBigintBigint(1L,1.0));
  builder.declarePosition();
  DOUBLE.writeDouble(builder.getBlockBuilder(0),2.0);
  innerRowType.writeObject(builder.getBlockBuilder(1),testRowBigintBigint(2L,2.0));
  builder.declarePosition();
  DOUBLE.writeDouble(builder.getBlockBuilder(0),3.0);
  innerRowType.writeObject(builder.getBlockBuilder(1),testRowBigintBigint(3L,3.0));
  assertAggregation(aggFunc,1.0,ImmutableMap.of(1.0,ImmutableList.of(1L,1.0),2.0,ImmutableList.of(2L,2.0),3.0,ImmutableList.of(3L,3.0)),builder.build());
}
