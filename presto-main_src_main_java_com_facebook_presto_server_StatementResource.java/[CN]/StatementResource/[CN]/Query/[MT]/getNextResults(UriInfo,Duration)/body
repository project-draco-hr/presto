{
  Iterable<List<Object>> data=getData(maxWaitTime);
  QueryInfo queryInfo=queryManager.getQueryInfo(queryId);
  if (exchangeClient.isClosed() && !queryInfo.getState().isDone()) {
    queryManager.waitForStateChange(queryId,queryInfo.getState(),maxWaitTime);
    queryInfo=queryManager.getQueryInfo(queryId);
  }
  if (queryInfo.getState().isDone()) {
    if (queryInfo.getState() != QueryState.FINISHED) {
      exchangeClient.close();
    }
 else     if (queryInfo.getOutputStage() == null) {
      exchangeClient.close();
      columns=ImmutableList.of(new Column("result","boolean",new ClientTypeSignature(StandardTypes.BOOLEAN,ImmutableList.<ClientTypeSignature>of(),ImmutableList.<Object>of())));
      data=ImmutableSet.<List<Object>>of(ImmutableList.<Object>of(true));
    }
  }
  URI nextResultsUri=null;
  if ((!queryInfo.getState().isDone()) || (!exchangeClient.isClosed())) {
    nextResultsUri=createNextResultsUri(uriInfo);
  }
  setSessionProperties=queryInfo.getSetSessionProperties();
  resetSessionProperties=queryInfo.getResetSessionProperties();
  QueryResults queryResults=new QueryResults(queryId.toString(),uriInfo.getRequestUriBuilder().replaceQuery("").replacePath(queryInfo.getSelf().getPath()).build(),findCancelableLeafStage(queryInfo),nextResultsUri,columns,data,toStatementStats(queryInfo),toQueryError(queryInfo));
  if (lastResult != null) {
    lastResultPath=lastResult.getNextUri().getPath();
  }
 else {
    lastResultPath=null;
  }
  lastResult=queryResults;
  return queryResults;
}
