{
  TaskInfo finalTaskInfo=taskHolder.getFinalTaskInfo();
  if (finalTaskInfo != null) {
    return finalTaskInfo;
  }
  TaskState state=taskStateMachine.getState();
  List<ExecutionFailureInfo> failures=ImmutableList.of();
  if (state == TaskState.FAILED) {
    failures=toFailures(taskStateMachine.getFailureCauses());
  }
  TaskStats taskStats;
  Set<PlanNodeId> noMoreSplits;
  SqlTaskExecution taskExecution=taskHolder.getTaskExecution();
  if (taskExecution != null) {
    taskStats=taskExecution.getTaskContext().getTaskStats();
    noMoreSplits=taskExecution.getNoMoreSplits();
  }
 else {
    taskStats=new TaskStats(taskStateMachine.getCreatedTime());
    noMoreSplits=ImmutableSet.of();
  }
  return new TaskInfo(taskStateMachine.getTaskId(),nextTaskInfoVersion.getAndIncrement(),state,location,lastHeartbeat.get(),sharedBuffer.getInfo(),noMoreSplits,taskStats,failures);
}
