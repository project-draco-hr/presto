{
  int packCapacity=Long.SIZE / bitWidth;
  long mask=-1L >>> (Long.SIZE - bitWidth);
  int itemCount=0;
  Iterator<Long> iter=items.iterator();
  while (iter.hasNext()) {
    long pack=0;
    boolean packUsed=false;
    for (int index=0; index < packCapacity; index++) {
      if (!iter.hasNext()) {
        break;
      }
      long rawValue=iter.next();
      checkArgument(min <= rawValue && rawValue <= max,"Provided value does not fit into bitspace");
      long maskedValue=rawValue & mask;
      itemCount++;
      pack|=maskedValue << (bitWidth * index);
      packUsed=true;
    }
    if (packUsed) {
      sliceOutput.writeLong(pack);
    }
  }
  new Footer(itemCount,bitWidth).serialize(sliceOutput);
}
