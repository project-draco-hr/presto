{
  Set<Symbol> dependencies=SymbolExtractor.extract(root);
  PlanFragment fragment=new PlanFragment(nextFragmentId(),root,Maps.filterKeys(types,in(dependencies)),properties.getOutputLayout(),properties.getDistribution(),properties.getDistributeBy(),properties.getOutputPartitioning(),properties.getPartitionBy(),properties.getNullPartitionPolicy(),properties.getHash());
  return new SubPlan(fragment,properties.getChildren());
}
