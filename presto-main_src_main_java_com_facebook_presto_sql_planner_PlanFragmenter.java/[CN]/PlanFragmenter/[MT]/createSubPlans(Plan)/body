{
  Fragmenter fragmenter=new Fragmenter(plan.getSymbolAllocator().getTypes());
  FragmentProperties properties=new FragmentProperties();
  PlanNode root=PlanRewriter.rewriteWith(fragmenter,plan.getRoot(),properties);
  SubPlan result=fragmenter.buildRootFragment(root,properties);
  result.sanityCheck();
  return result;
}
