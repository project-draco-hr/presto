{
  if (isDone()) {
    return null;
  }
  try {
    if (response.getStatusCode() == Status.GONE.getStatusCode()) {
      done();
      return null;
    }
    if (response.getStatusCode() != 200) {
      throw new UnexpectedResponseException(String.format("Expected response code to be 200, but was %d: %s",response.getStatusCode(),response.getStatusMessage()),request,response);
    }
    String contentType=response.getHeader("Content-Type");
    if (!MediaType.valueOf(contentType).isCompatible(PRESTO_BLOCKS_TYPE)) {
      throw new UnexpectedResponseException(String.format("Expected %s response from server but got %s",PRESTO_BLOCKS_TYPE,contentType),request,response);
    }
    while (true) {
      UncompressedBlock block=UncompressedBlockMapper.readBlock(info,response.getInputStream());
      if (block == null) {
        break;
      }
      queryState.addBlock(block);
    }
    setCurrentRequest(httpClient.execute(prepareGet().setUri(queryUri).build(),this));
    return null;
  }
 catch (  InterruptedException e) {
    Thread.currentThread().interrupt();
    fail(e);
    throw Throwables.propagate(e);
  }
catch (  Throwable e) {
    fail(e);
    throw Throwables.propagate(e);
  }
}
