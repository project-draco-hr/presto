{
  ShardPredicate predicate=ShardPredicate.create(effectivePredicate);
  String sql=format("SELECT shard_uuid, bucket_number, node_ids FROM %s WHERE %s",shardIndexTable(tableId),predicate.getPredicate());
  dao=onDemandDao(dbi,ShardManagerDao.class);
  fetchNodes();
  try {
    connection=dbi.open().getConnection();
    statement=connection.prepareStatement(sql);
    enableStreamingResults(statement);
    predicate.bind(statement);
    log.debug("Running query: %s",statement);
    resultSet=statement.executeQuery();
  }
 catch (  SQLException e) {
    close();
    throw metadataError(e);
  }
}
