{
  if (response.getStatusCode() == HttpStatus.GONE.code()) {
    return createClosedResponse(getToken(response));
  }
  if (response.getStatusCode() == HttpStatus.NO_CONTENT.code()) {
    return createEmptyPagesResponse(getToken(response),getNextToken(response));
  }
  if (response.getStatusCode() != HttpStatus.OK.code()) {
    throw new PageTransportErrorException(format("Expected response code to be 200, but was %s %s: %s",response.getStatusCode(),response.getStatusMessage(),request.getUri()));
  }
  String contentType=response.getHeader(CONTENT_TYPE);
  if ((contentType == null) || !mediaTypeMatches(contentType,PRESTO_PAGES_TYPE)) {
    throw new PageTransportErrorException(format("Expected %s response from server but got %s: %s",PRESTO_PAGES_TYPE,contentType,request.getUri()));
  }
  long token=getToken(response);
  long nextToken=getNextToken(response);
  try (SliceInput input=new InputStreamSliceInput(response.getInputStream())){
    List<Page> pages=ImmutableList.copyOf(readPages(blockEncodingSerde,input));
    return createPagesResponse(token,nextToken,pages);
  }
 catch (  IOException e) {
    throw Throwables.propagate(e);
  }
}
