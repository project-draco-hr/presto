{
  requestsCompleted.incrementAndGet();
  if (response.getStatusCode() == HttpStatus.GONE.code()) {
    bufferFinished();
    return null;
  }
  try {
    if (response.getStatusCode() != HttpStatus.NO_CONTENT.code()) {
      if (response.getStatusCode() != HttpStatus.OK.code()) {
        log.debug("Expected response code to be 200, but was %s: request=%s, response=%s",response.getStatusCode(),request,response);
        return null;
      }
      String contentType=response.getHeader(CONTENT_TYPE);
      if (contentType == null || !MediaType.parse(contentType).is(PRESTO_PAGES_TYPE)) {
        log.debug("Expected %s response from server but got %s: uri=%s, response=%s",PRESTO_PAGES_TYPE,contentType,location,response);
        return null;
      }
      InputStreamSliceInput sliceInput=new InputStreamSliceInput(response.getInputStream());
      Iterator<Page> pageIterator=PagesSerde.readPages(sliceInput);
      while (pageIterator.hasNext()) {
        if (isClosed()) {
          return null;
        }
        Page page=pageIterator.next();
        pagesReceived.incrementAndGet();
        clientCallback.addPage(HttpPageBufferClient.this,page);
      }
    }
  }
 catch (  Throwable e) {
    log.warn(e,"Error fetching pages from  %s: status: %s %s",request.getUri(),response.getStatusCode(),response.getStatusMessage());
    Throwables.propagateIfInstanceOf(e,Error.class);
  }
 finally {
    requestComplete();
  }
  return null;
}
