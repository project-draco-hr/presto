{
  int newSize=arraySize(size + 1,FILL_RATIO);
  int newMask=newSize - 1;
  long[] newKey=new long[newSize];
  Arrays.fill(newKey,-1);
  int[] newValue=new int[newSize];
  int oldIndex=0;
  for (int groupId=0; groupId < nextGroupId; groupId++) {
    while (groupAddressByHash[oldIndex] == -1) {
      oldIndex++;
    }
    long address=groupAddressByHash[oldIndex];
    int pos=getHashPosition(hashPosition(address),newMask);
    while (newKey[pos] != -1) {
      pos=(pos + 1) & newMask;
    }
    newKey[pos]=address;
    newValue[pos]=groupIdsByHash[oldIndex];
    oldIndex++;
  }
  this.mask=newMask;
  this.maxFill=calculateMaxFill(newSize);
  this.groupAddressByHash=newKey;
  this.groupIdsByHash=newValue;
  groupAddressByGroupId.ensureCapacity(maxFill);
}
