{
  setupHive(databaseName);
  HiveClientConfig hiveClientConfig=new HiveClientConfig().setS3AwsAccessKey(awsAccessKey).setS3AwsSecretKey(awsSecretKey);
  String proxy=System.getProperty("hive.metastore.thrift.client.socks-proxy");
  if (proxy != null) {
    hiveClientConfig.setMetastoreSocksProxy(HostAndPort.fromString(proxy));
  }
  HiveCluster hiveCluster=new TestingHiveCluster(hiveClientConfig,host,port);
  ExecutorService executor=newCachedThreadPool(daemonThreadsNamed("hive-s3-%s"));
  hdfsEnvironment=new HdfsEnvironment(new HdfsConfiguration(hiveClientConfig));
  metastoreClient=new TestingHiveMetastore(hiveCluster,executor,hiveClientConfig,writableBucket);
  client=new HiveClient(new HiveConnectorId("hive-test"),hiveClientConfig,metastoreClient,new NamenodeStats(),new HdfsEnvironment(new HdfsConfiguration(hiveClientConfig)),new HadoopDirectoryLister(),sameThreadExecutor(),new TypeRegistry());
}
