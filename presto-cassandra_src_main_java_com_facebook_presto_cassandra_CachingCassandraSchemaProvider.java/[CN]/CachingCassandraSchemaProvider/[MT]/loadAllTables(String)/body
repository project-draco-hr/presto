{
  return retry().stopOn(NotFoundException.class).stopOnIllegalExceptions().run("getAllTables",new Callable<Map<String,String>>(){
    @Override public Map<String,String> call() throws SchemaNotFoundException {
      String caseSensitiveDatabaseName=getCaseSensitiveSchemaName(databaseName);
      if (caseSensitiveDatabaseName == null) {
        caseSensitiveDatabaseName=databaseName;
      }
      List<String> tables=session.getAllTables(caseSensitiveDatabaseName);
      Map<String,String> nameMap=Maps.uniqueIndex(tables,toLowerCase());
      if (tables.isEmpty()) {
        session.getSchema(databaseName);
      }
      return nameMap;
    }
  }
);
}
