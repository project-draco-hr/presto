{
  Visitor visitor=new Visitor(plan.getSymbolAllocator(),createSingleNodePlan,distributedIndexJoins,distributedJoins);
  SubPlanBuilder builder=plan.getRoot().accept(visitor,null);
  SubPlan subplan=builder.build();
  subplan.sanityCheck();
  return subplan;
}
