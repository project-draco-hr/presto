{
  SubPlanBuilder current=node.getSource().accept(this,context);
  checkState(current.getRoot() instanceof TableWriterNode,"table commit node must be preceeded by table writer node");
  OutputTableHandle target=((TableWriterNode)current.getRoot()).getTarget();
  checkNotNull(target,"target table handle should have been constructed when we visited the table writer node");
  if (current.getDistribution() != PlanDistribution.COORDINATOR_ONLY && !createSingleNodePlan) {
    current.setRoot(new SinkNode(idAllocator.getNextId(),current.getRoot(),current.getRoot().getOutputSymbols()));
    current=createCoordinatorOnlyPlan(new ExchangeNode(idAllocator.getNextId(),current.getId(),current.getRoot().getOutputSymbols())).addChild(current.build());
  }
  current.setRoot(new TableCommitNode(node.getId(),current.getRoot(),target,node.getOutputSymbols()));
  return current;
}
