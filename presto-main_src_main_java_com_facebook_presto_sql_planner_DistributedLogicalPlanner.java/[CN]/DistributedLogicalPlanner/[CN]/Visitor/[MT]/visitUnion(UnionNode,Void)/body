{
  if (createSingleNodePlan) {
    ImmutableList.Builder<PlanNode> sourceBuilder=ImmutableList.builder();
    for (    PlanNode source : node.getSources()) {
      sourceBuilder.add(source.accept(this,context).getRoot());
    }
    return newSubPlan(new LocalUnionNode(idAllocator.getNextId(),sourceBuilder.build(),node.getOutputSymbols()));
  }
 else {
    ImmutableList.Builder<SubPlan> sourceBuilder=ImmutableList.builder();
    ImmutableList.Builder<PlanFragmentId> fragmentIdBuilder=ImmutableList.builder();
    for (    PlanNode source : node.getSources()) {
      SubPlanBuilder current=source.accept(this,context);
      current.setRoot(new SinkNode(idAllocator.getNextId(),current.getRoot()));
      fragmentIdBuilder.add(current.getId());
      sourceBuilder.add(current.build());
    }
    return newSubPlan(new ExchangeNode(idAllocator.getNextId(),fragmentIdBuilder.build(),node.getOutputSymbols())).setUnpartitionedSource().setChildren(sourceBuilder.build());
  }
}
