{
  if (createSingleNodePlan) {
    ImmutableList.Builder<PlanNode> sourceBuilder=ImmutableList.builder();
    for (    PlanNode source : node.getSources()) {
      sourceBuilder.add(source.accept(this,context).getRoot());
    }
    UnionNode unionNode=new UnionNode(node.getId(),sourceBuilder.build(),node.getSymbolMapping());
    return unpartitionedSubPlan(unionNode);
  }
 else {
    ImmutableList.Builder<SubPlan> sourceBuilder=ImmutableList.builder();
    ImmutableList.Builder<PlanFragmentId> fragmentIdBuilder=ImmutableList.builder();
    for (int i=0; i < node.getSources().size(); i++) {
      PlanNode subPlan=node.getSources().get(i);
      SubPlanBuilder current=subPlan.accept(this,context);
      current.setRoot(new SinkNode(idAllocator.getNextId(),current.getRoot(),node.sourceOutputLayout(i)));
      fragmentIdBuilder.add(current.getId());
      sourceBuilder.add(current.build());
    }
    ExchangeNode exchangeNode=new ExchangeNode(idAllocator.getNextId(),fragmentIdBuilder.build(),node.getOutputSymbols());
    return unpartitionedSubPlan(exchangeNode).setChildren(sourceBuilder.build());
  }
}
