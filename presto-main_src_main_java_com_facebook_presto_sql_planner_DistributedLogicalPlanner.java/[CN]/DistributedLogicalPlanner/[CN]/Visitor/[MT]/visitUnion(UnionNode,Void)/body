{
  if (createSingleNodePlan) {
    ImmutableList.Builder<PlanNode> sourceBuilder=ImmutableList.builder();
    for (    PlanNode source : node.getSources()) {
      sourceBuilder.add(source.accept(this,context).getRoot());
    }
    UnionNode unionNode=new UnionNode(node.getId(),sourceBuilder.build(),node.getSymbolMapping());
    return createSingleNodePlan(unionNode);
  }
 else {
    ImmutableList.Builder<SubPlan> sourceBuilder=ImmutableList.builder();
    ImmutableList.Builder<PlanFragmentId> fragmentIdBuilder=ImmutableList.builder();
    for (int i=0; i < node.getSources().size(); i++) {
      SubPlan child=node.getSources().get(i).accept(this,context).setOutputLayout(node.sourceOutputLayout(i)).build();
      fragmentIdBuilder.add(child.getFragment().getId());
      sourceBuilder.add(child);
    }
    ExchangeNode exchangeNode=new ExchangeNode(idAllocator.getNextId(),fragmentIdBuilder.build(),node.getOutputSymbols());
    return createSingleNodePlan(exchangeNode).setChildren(sourceBuilder.build());
  }
}
