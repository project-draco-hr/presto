{
  try {
    QueryStats queryStats=queryInfo.getQueryStats();
    FailureInfo failureInfo=queryInfo.getFailureInfo();
    String failureType=failureInfo == null ? null : failureInfo.getType();
    String failureMessage=failureInfo == null ? null : failureInfo.getMessage();
    eventClient.post(new QueryCompletionEvent(queryInfo.getQueryId(),queryInfo.getSession().getUser(),queryInfo.getSession().getSource(),environment,queryInfo.getSession().getCatalog(),queryInfo.getSession().getSchema(),queryInfo.getSession().getRemoteUserAddress(),queryInfo.getSession().getUserAgent(),queryInfo.getState(),queryInfo.getSelf(),queryInfo.getFieldNames(),queryInfo.getQuery(),queryStats.getCreateTime(),queryStats.getExecutionStartTime(),queryStats.getEndTime(),queryStats.getQueuedTime(),queryStats.getAnalysisTime(),queryStats.getDistributedPlanningTime(),queryStats.getTotalScheduledTime(),queryStats.getTotalCpuTime(),queryStats.getRawInputDataSize(),queryStats.getRawInputPositions(),queryStats.getTotalDrivers(),failureType,failureMessage,objectMapper.writeValueAsString(queryInfo.getOutputStage()),objectMapper.writeValueAsString(queryInfo.getFailureInfo()),objectMapper.writeValueAsString(queryInfo.getInputs())));
    logQueryTimeline(queryInfo);
  }
 catch (  JsonProcessingException e) {
    throw Throwables.propagate(e);
  }
}
