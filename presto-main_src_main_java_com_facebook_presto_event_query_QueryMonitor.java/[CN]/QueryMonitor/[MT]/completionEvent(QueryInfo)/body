{
  try {
    ExecutionStats globalExecutionStats=globalExecutionStats(queryInfo.getOutputStage());
    eventClient.post(new QueryCompletionEvent(queryInfo.getQueryId(),queryInfo.getSession().getUser(),queryInfo.getSession().getSource(),queryInfo.getSession().getCatalog(),queryInfo.getSession().getSchema(),queryInfo.getSession().getRemoteUserAddress(),queryInfo.getSession().getUserAgent(),queryInfo.getState(),queryInfo.getSelf(),queryInfo.getFieldNames(),queryInfo.getQuery(),queryInfo.getQueryStats().getCreateTime(),queryInfo.getQueryStats().getExecutionStartTime(),queryInfo.getQueryStats().getEndTime(),queryInfo.getQueryStats().getQueuedTime(),queryInfo.getQueryStats().getAnalysisTime(),queryInfo.getQueryStats().getDistributedPlanningTime(),globalExecutionStats.getSplitWallTime(),globalExecutionStats.getSplitCpuTime(),globalExecutionStats.getCompletedDataSize(),globalExecutionStats.getCompletedPositionCount(),globalExecutionStats.getSplits(),objectMapper.writeValueAsString(queryInfo.getOutputStage()),objectMapper.writeValueAsString(queryInfo.getFailureInfo())));
  }
 catch (  JsonProcessingException e) {
    throw Throwables.propagate(e);
  }
}
