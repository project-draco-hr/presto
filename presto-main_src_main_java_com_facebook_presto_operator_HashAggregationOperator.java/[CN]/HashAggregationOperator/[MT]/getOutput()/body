{
  if (outputIterator == null || !outputIterator.hasNext()) {
    outputIterator=null;
    if (aggregationBuilder == null) {
      return null;
    }
    if (!finishing && !aggregationBuilder.isFull()) {
      return null;
    }
    if (!finishing && step != Step.PARTIAL) {
      throw new ExceededMemoryLimitException(memoryManager.getMaxMemorySize());
    }
    outputIterator=aggregationBuilder.build();
    aggregationBuilder=null;
    if (!outputIterator.hasNext()) {
      outputIterator=null;
      return null;
    }
  }
  return outputIterator.next();
}
