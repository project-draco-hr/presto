{
  checkState(!closed,"Factory is already closed");
  OperatorContext operatorContext;
  if (step.isOutputPartial()) {
    operatorContext=driverContext.addOperatorContext(operatorId,planNodeId,HashAggregationOperator.class.getSimpleName(),maxPartialMemory);
  }
 else {
    operatorContext=driverContext.addOperatorContext(operatorId,planNodeId,HashAggregationOperator.class.getSimpleName());
  }
  HashAggregationOperator hashAggregationOperator=new HashAggregationOperator(operatorContext,groupByTypes,groupByChannels,step,accumulatorFactories,maskChannel,hashChannel,expectedGroups);
  return hashAggregationOperator;
}
