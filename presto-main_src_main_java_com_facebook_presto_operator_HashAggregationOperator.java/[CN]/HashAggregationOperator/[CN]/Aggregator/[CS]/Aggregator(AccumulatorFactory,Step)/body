{
  if (step == Step.FINAL) {
    checkArgument(accumulatorFactory.getInputChannels().size() == 1,"expected 1 input channel for intermediate aggregation");
    intermediateChannel=accumulatorFactory.getInputChannels().get(0);
    aggregation=accumulatorFactory.createGroupedIntermediateAccumulator();
  }
 else {
    intermediateChannel=-1;
    aggregation=accumulatorFactory.createGroupedAccumulator();
  }
  this.step=step;
}
