{
  BlockCursor cursor;
  int field;
  if (input != null) {
    cursor=cursors[input.getChannel()];
    field=input.getField();
  }
 else {
    cursor=null;
    field=-1;
  }
  T oldValue=intermediateValues.get(position);
  long oldSize=0;
  if (oldValue != null) {
    oldSize=function.estimateSizeInBytes(oldValue);
  }
  T newValue;
  if (step == Step.FINAL) {
    newValue=function.addIntermediate(cursor,field,oldValue);
  }
 else {
    newValue=function.addInput(cursor,field,oldValue);
  }
  intermediateValues.set(position,newValue);
  totalElementSizeInBytes+=function.estimateSizeInBytes(newValue) - oldSize;
}
