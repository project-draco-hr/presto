{
  checkNotNull(bufferId,"bufferId is null");
  if (buffers.containsKey(bufferId)) {
    checkHasBuffer(bufferId,pagePartitionFunction);
    return this;
  }
  checkState(!noMoreBufferIds,"No more buffer ids already set");
  return new OutputBuffers(version + 1,false,ImmutableMap.<TaskId,PagePartitionFunction>builder().putAll(buffers).put(bufferId,pagePartitionFunction).build());
}
