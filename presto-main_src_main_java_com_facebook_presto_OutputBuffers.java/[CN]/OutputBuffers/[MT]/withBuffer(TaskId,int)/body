{
  requireNonNull(bufferId,"bufferId is null");
  if (buffers.containsKey(bufferId)) {
    checkHasBuffer(bufferId,partition);
    return this;
  }
  checkState(!noMoreBufferIds,"No more buffer ids already set");
  return new OutputBuffers(version + 1,false,ImmutableMap.<TaskId,Integer>builder().putAll(buffers).put(bufferId,partition).build());
}
