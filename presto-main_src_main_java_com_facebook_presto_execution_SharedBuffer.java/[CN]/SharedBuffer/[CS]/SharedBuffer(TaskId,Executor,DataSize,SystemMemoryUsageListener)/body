{
  checkNotNull(taskId,"taskId is null");
  checkNotNull(executor,"executor is null");
  state=new StateMachine<>(taskId + "-buffer",executor,OPEN,TERMINAL_BUFFER_STATES);
  checkNotNull(maxBufferSize,"maxBufferSize is null");
  checkArgument(maxBufferSize.toBytes() > 0,"maxBufferSize must be at least 1");
  checkNotNull(systemMemoryUsageListener,"systemMemoryUsageListener is null");
  this.memoryManager=new SharedBufferMemoryManager(maxBufferSize.toBytes(),systemMemoryUsageListener);
}
