{
  checkNotNull(page,"page is null");
  if (!state.get().canAddPages()) {
    return immediateFuture(true);
  }
  if (bufferedBytes < maxBufferedBytes) {
    addInternal(page);
    return immediateFuture(true);
  }
  QueuedPage queuedPage=new QueuedPage(page);
  queuedPages.addLast(queuedPage);
  updateState();
  return queuedPage.getFuture();
}
