{
  for (  Entry<String,PagePartitionFunction> entry : outputBuffers.getBuffers().entrySet()) {
    String bufferId=entry.getKey();
    if (!namedQueues.containsKey(bufferId)) {
      checkState(state.get() == QueueState.OPEN,"%s is not OPEN",SharedBuffer.class.getSimpleName());
      NamedQueue namedQueue=new NamedQueue(bufferId,entry.getValue());
      namedQueues.put(bufferId,namedQueue);
      openQueuesBySequenceId.add(namedQueue);
    }
  }
  if (outputBuffers.isNoMoreBufferIds()) {
    namedQueues=ImmutableMap.copyOf(namedQueues);
    if (state.compareAndSet(QueueState.OPEN,QueueState.NO_MORE_QUEUES)) {
      updateState();
    }
  }
}
