{
  checkHoldsLock();
  checkArgument(maxSize.toBytes() > 0,"maxSize must be at least 1 byte");
  long sequenceId=this.sequenceId.get();
  checkArgument(startingSequenceId >= sequenceId,"startingSequenceId is before the beginning of the buffer");
  if (startingSequenceId > sequenceId) {
    this.sequenceId.set(startingSequenceId);
    sequenceId=startingSequenceId;
  }
  if (checkCompletion()) {
    return emptyResults(startingSequenceId,true);
  }
  List<Page> pages=partitionBuffer.getPages(maxSize,sequenceId);
  return new BufferResult(startingSequenceId,startingSequenceId + pages.size(),false,pages);
}
