{
  Preconditions.checkState(Thread.holdsLock(SharedBuffer.this),"Thread must hold a lock on the %s",SharedBuffer.class.getSimpleName());
  if (finished) {
    return emptyResults(true);
  }
  int listOffset=Ints.checkedCast(sequenceId - masterSequenceId);
  if (listOffset >= masterQueue.size()) {
    return emptyResults(false);
  }
  List<T> elements=masterQueue.subList(listOffset,Math.min(listOffset + maxElementCount,masterQueue.size()));
  sequenceId+=elements.size();
  return new BufferResult<>(false,ImmutableList.copyOf(elements));
}
