{
  ClassDefinition definition=new ClassDefinition(a(PUBLIC,FINAL),makeClassName("Grouped" + clazz.getSimpleName()),type(AbstractGroupedAccumulatorState.class),type(clazz),type(GroupedAccumulator.class));
  List<StateField> fields=enumerateFields(clazz);
  Block constructor=definition.declareConstructor(a(PUBLIC)).getBody().pushThis().invokeConstructor(AbstractGroupedAccumulatorState.class);
  Block ensureCapacity=definition.declareMethod(a(PUBLIC),"ensureCapacity",type(void.class),arg("size",long.class)).getBody();
  List<FieldDefinition> fieldDefinitions=new ArrayList<>();
  for (  StateField field : fields) {
    fieldDefinitions.add(generateGroupedField(definition,constructor,ensureCapacity,field));
  }
  constructor.ret();
  ensureCapacity.ret();
  Block getEstimatedSize=definition.declareMethod(a(PUBLIC),"getEstimatedSize",type(long.class)).getBody().comment("long size = 0;").push(0L);
  for (  FieldDefinition field : fieldDefinitions) {
    getEstimatedSize.comment("size += %s.sizeOf();",field.getName()).pushThis().getField(field).invokeVirtual(field.getType(),"sizeOf",type(long.class)).longAdd();
  }
  getEstimatedSize.comment("return size;");
  getEstimatedSize.retLong();
  return defineClass(definition,clazz,classLoader);
}
