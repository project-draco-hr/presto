{
  taskCount.incrementAndGet();
  executor.execute(new Runnable(){
    @Override public void run(){
      try {
        RemoteIterator<LocatedFileStatus> iter=fileSystem.listLocatedStatus(path);
        while (iter.hasNext()) {
          LocatedFileStatus status=iter.next();
          if (isDirectory(status)) {
            recursiveWalk(status.getPath(),callback,taskCount,settableFuture);
          }
 else {
            callback.process(status,status.getBlockLocations());
          }
        }
      }
 catch (      FileNotFoundException e) {
        settableFuture.setException(new FileNotFoundException("Partition location does not exist: " + path));
      }
catch (      IOException|RuntimeException e) {
        settableFuture.setException(e);
      }
 finally {
        if (taskCount.decrementAndGet() == 0) {
          settableFuture.set(null);
        }
      }
    }
  }
);
}
