{
  ImmutableMap.Builder<Symbol,Expression> projections=ImmutableMap.builder();
  for (  Expression expression : expressions) {
    Type coercion=analysis.getCoercion(expression);
    Symbol symbol=symbolAllocator.newSymbol(expression,firstNonNull(coercion,analysis.getType(expression)));
    Expression rewritten=subPlan.rewrite(expression);
    if (coercion != null) {
      rewritten=new Cast(rewritten,coercion.getTypeSignature().toString());
    }
    projections.put(symbol,rewritten);
    translations.put(expression,symbol);
  }
  return projections.build();
}
