{
  Expression predicate=analysis.getPredicate(query);
  if (predicate == null) {
    return subPlan;
  }
  Expression rewritten=subPlan.rewrite(predicate);
  return new PlanBuilder(subPlan.getTranslations(),new FilterNode(idAllocator.getNextId(),subPlan.getRoot(),rewritten));
}
