{
  if (node.getSelect().isDistinct()) {
    checkState(outputs.containsAll(orderBy),"Expected ORDER BY terms to be in SELECT. Broken analysis");
    AggregationNode aggregation=new AggregationNode(idAllocator.getNextId(),subPlan.getRoot(),subPlan.getRoot().getOutputSymbols(),ImmutableMap.<Symbol,FunctionCall>of(),ImmutableMap.<Symbol,Signature>of(),ImmutableMap.<Symbol,Symbol>of(),AggregationNode.Step.SINGLE,Optional.empty(),1.0,Optional.empty());
    return new PlanBuilder(subPlan.getTranslations(),aggregation,subPlan.getSampleWeight());
  }
  return subPlan;
}
