{
  List<DiskRange> ranges=newArrayList(diskRanges);
  Collections.sort(ranges,new Comparator<DiskRange>(){
    @Override public int compare(    DiskRange o1,    DiskRange o2){
      return Long.compare(o1.getOffset(),o2.getOffset());
    }
  }
);
  long maxMergeDistanceBytes=maxMergeDistance.toBytes();
  List<DiskRange> result=new ArrayList<>();
  DiskRange last=ranges.get(0);
  for (int i=1; i < ranges.size(); i++) {
    DiskRange current=ranges.get(i);
    if (last.getEnd() + maxMergeDistanceBytes + 1 >= current.getOffset()) {
      last=last.span(current);
    }
 else {
      result.add(last);
      last=current;
    }
  }
  result.add(last);
  return result;
}
