{
  checkNotNull(taskId,"taskId is null");
  checkNotNull(outputId,"outputId is null");
  try {
    BufferResult result=taskManager.getTaskResults(taskId,outputId,pageSequenceId,DEFAULT_MAX_PAGE_COUNT,DEFAULT_MAX_WAIT_TIME);
    if (!result.isEmpty()) {
      GenericEntity<?> entity=new GenericEntity<>(result.getElements(),new TypeToken<List<Page>>(){
      }
.getType());
      return Response.ok(entity).header(PRESTO_PAGE_SEQUENCE_ID,result.getStartingSequenceId()).build();
    }
 else     if (result.isBufferClosed() || isDone(taskId)) {
      return Response.status(Status.GONE).header(PRESTO_PAGE_SEQUENCE_ID,result.getElements()).build();
    }
 else {
      return Response.status(Status.NO_CONTENT).header(PRESTO_PAGE_SEQUENCE_ID,result.getStartingSequenceId()).build();
    }
  }
 catch (  NoSuchElementException|NoSuchBufferException ignored) {
    if (limiter.tryAcquire()) {
      log.debug(ignored,"Error getting results");
    }
  }
  if (isDone(taskId)) {
    return Response.status(Status.GONE).header(PRESTO_PAGE_SEQUENCE_ID,pageSequenceId).build();
  }
 else {
    return Response.status(Status.NO_CONTENT).header(PRESTO_PAGE_SEQUENCE_ID,pageSequenceId).build();
  }
}
