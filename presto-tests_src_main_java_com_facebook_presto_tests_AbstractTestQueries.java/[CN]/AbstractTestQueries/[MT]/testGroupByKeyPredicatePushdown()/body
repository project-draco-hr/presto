{
  assertQuery("" + "SELECT *\n" + "FROM (\n"+ "  SELECT custkey1, orderstatus1, SUM(totalprice1) totalprice, MAX(custkey2) maxcustkey\n"+ "  FROM (\n"+ "    SELECT *\n"+ "    FROM (\n"+ "      SELECT custkey custkey1, orderstatus orderstatus1, CAST(totalprice AS BIGINT) totalprice1, orderkey orderkey1\n"+ "      FROM orders\n"+ "    ) orders1 \n"+ "    JOIN (\n"+ "      SELECT custkey custkey2, orderstatus orderstatus2, CAST(totalprice AS BIGINT) totalprice2, orderkey orderkey2\n"+ "      FROM orders\n"+ "    ) orders2 ON orders1.orderkey1 = orders2.orderkey2\n"+ "  ) \n"+ "  GROUP BY custkey1, orderstatus1\n"+ ")\n"+ "WHERE custkey1 = maxcustkey\n"+ "AND maxcustkey % 2 = 0 \n"+ "AND orderstatus1 = 'F'\n"+ "AND totalprice > 10000\n"+ "ORDER BY custkey1, orderstatus1, totalprice, maxcustkey");
}
