{
  PlanNode source=node.getSource().accept(this,context);
  Map<Slot,Expression> assignments=new HashMap<>();
  for (  Map.Entry<Slot,Expression> entry : node.getOutputMap().entrySet()) {
    Expression expression=canonicalize(entry.getValue());
    if (entry.getValue() instanceof SlotReference) {
      Slot slot=((SlotReference)entry.getValue()).getSlot();
      if (!slot.equals(entry.getKey())) {
        map(entry.getKey(),slot);
      }
    }
    Slot canonical=canonicalize(entry.getKey());
    if (!assignments.containsKey(canonical)) {
      assignments.put(canonical,expression);
    }
  }
  return new ProjectNode(source,assignments);
}
