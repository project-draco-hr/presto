{
  DynamicClassLoader classLoader=new DynamicClassLoader(MaxByAggregations.class.getClassLoader());
  MaxByStateSerializer stateSerializer=new MaxByStateSerializer();
  Type intermediateType=stateSerializer.getSerializedType();
  List<Type> inputTypes=ImmutableList.of(valueType,keyType);
  MaxByStateFactory stateFactory=new MaxByStateFactory(valueType,keyType);
  AggregationMetadata metadata=new AggregationMetadata(generateAggregationName(NAME,valueType,inputTypes),createInputParameterMetadata(valueType,keyType),lookupInputFunction(),null,null,lookupCombineFunction(),OUTPUT_FUNCTION,MaxByState.class,stateSerializer,stateFactory,valueType,false,true);
  AccumulatorFactory factory=new AccumulatorCompiler().generateAccumulatorFactory(metadata,classLoader);
  return new GenericAggregationFunction(NAME,inputTypes,intermediateType,valueType,false,false,factory);
}
