{
  try {
    ParserRuleContext tree=parseTypeCalculation(calculation);
    if (!allowComplexExpression && !isSimpleExpression(tree)) {
      throw new IllegalArgumentException(format("Complex expressions not allowed, but got [%s]",calculation));
    }
    return new CalculateTypeVisitor(inputs).visit(tree);
  }
 catch (  StackOverflowError e) {
    throw new ParsingException("Type calculation is too large (stack overflow while parsing)");
  }
}
