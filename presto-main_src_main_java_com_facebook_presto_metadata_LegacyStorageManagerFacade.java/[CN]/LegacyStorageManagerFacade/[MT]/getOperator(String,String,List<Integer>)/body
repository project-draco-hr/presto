{
  final TableMetadata table=metadata.getTable("default",databaseName,tableName);
  List<BlockIterable> blockIterables=Lists.transform(fieldIndexes,new Function<Integer,BlockIterable>(){
    @Override public BlockIterable apply(    Integer fieldIndex){
      ColumnMetadata column=getColumn(table,fieldIndex);
      long tableId=getTableId(table);
      long columnId=getColumnId(column);
      ImmutableList.Builder<BlockIterable> blocks=ImmutableList.builder();
      for (      long shardId : shardManager.getShardNodes(tableId).keySet()) {
        blocks.add(storageManager.getBlocks(shardId,columnId));
      }
      return BlockUtils.toBlocks(Iterables.concat(blocks.build()));
    }
  }
);
  return new AlignmentOperator(blockIterables);
}
