{
  Type type=process(expression,context);
  if (!type.equals(expectedType)) {
    if (!type.equals(NULL) && !(type.equals(BIGINT) && expectedType.equals(DOUBLE))) {
      throw new SemanticException(TYPE_MISMATCH,expression,message + " must evaluate to a %s (actual: %s)",expectedType,type);
    }
    expressionCoercions.put(expression,expectedType);
  }
  return type;
}
