{
  checkState(node.getRelations().size() >= 2);
  TupleAnalyzer analyzer=new TupleAnalyzer(analysis,session,metadata,experimentalSyntaxEnabled);
  TupleDescriptor outputDescriptor=analyzer.process(node.getRelations().get(0),context).withOnlyVisibleFields();
  for (  Relation relation : Iterables.skip(node.getRelations(),1)) {
    TupleDescriptor descriptor=analyzer.process(relation,context);
    if (!elementsEqual(transform(outputDescriptor.getVisibleFields(),typeGetter()),transform(descriptor.getVisibleFields(),typeGetter()))) {
      throw new SemanticException(MISMATCHED_SET_COLUMN_TYPES,node,"Union query terms have mismatched columns");
    }
  }
  analysis.setOutputDescriptor(node,outputDescriptor);
  return outputDescriptor;
}
