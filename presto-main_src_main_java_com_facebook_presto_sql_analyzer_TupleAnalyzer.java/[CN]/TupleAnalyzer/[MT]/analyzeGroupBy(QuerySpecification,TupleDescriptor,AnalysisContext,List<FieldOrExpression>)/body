{
  ImmutableList.Builder<FieldOrExpression> groupByExpressionsBuilder=ImmutableList.builder();
  if (!node.getGroupBy().isEmpty()) {
    for (    Expression expression : node.getGroupBy()) {
      FieldOrExpression groupByExpression;
      if (expression instanceof LongLiteral) {
        long ordinal=((LongLiteral)expression).getValue();
        if (ordinal < 1 || ordinal > outputExpressions.size()) {
          throw new SemanticException(INVALID_ORDINAL,expression,"GROUP BY position %s is not in select list",ordinal);
        }
        groupByExpression=outputExpressions.get((int)(ordinal - 1));
      }
 else {
        ExpressionAnalysis expressionAnalysis=analyzeExpression(expression,tupleDescriptor,context);
        analysis.addInPredicates(node,expressionAnalysis.getSubqueryInPredicates());
        groupByExpression=new FieldOrExpression(expression);
      }
      Type type;
      if (groupByExpression.isExpression()) {
        Analyzer.verifyNoAggregatesOrWindowFunctions(metadata,groupByExpression.getExpression(),"GROUP BY");
        type=analysis.getType(groupByExpression.getExpression());
      }
 else {
        type=tupleDescriptor.getFieldByIndex(groupByExpression.getFieldIndex()).getType();
      }
      if (!type.isComparable()) {
        throw new SemanticException(TYPE_MISMATCH,node,"%s is not comparable, and therefore cannot be used in GROUP BY",type);
      }
      groupByExpressionsBuilder.add(groupByExpression);
    }
  }
  List<FieldOrExpression> groupByExpressions=groupByExpressionsBuilder.build();
  analysis.setGroupByExpressions(node,groupByExpressions);
  return groupByExpressions;
}
