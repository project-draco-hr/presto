{
  OrcStorageManager manager=createOrcStorageManager();
  List<Long> columnIds=ImmutableList.of(3L,7L);
  List<Type> columnTypes=ImmutableList.<Type>of(BIGINT,VARCHAR);
  StoragePageSink sink=manager.createStoragePageSink(columnIds,columnTypes);
  List<Page> pages=rowPagesBuilder(columnTypes).row(123,"hello").row(456,"bye").build();
  sink.appendPages(pages);
  List<ShardInfo> shards=sink.commit();
  assertEquals(shards.size(),1);
  ShardInfo shardInfo=Iterables.getOnlyElement(shards);
  UUID shardUuid=shardInfo.getShardUuid();
  File file=storageService.getStorageFile(shardUuid);
  File backupFile=fileBackupStore.getBackupFile(shardUuid);
  assertEquals(shardInfo.getRowCount(),2);
  assertEquals(shardInfo.getCompressedSize(),file.length());
  assertFile(file,"primary shard");
  assertFile(backupFile,"backup shard");
  assertFileEquals(file,backupFile);
  assertTrue(file.delete());
  assertTrue(file.getParentFile().delete());
  assertFalse(file.exists());
  recoveryManager.restoreFromBackup(shardUuid);
  try (OrcDataSource dataSource=manager.openShard(shardUuid)){
    OrcRecordReader reader=createReader(dataSource,columnIds,columnTypes);
    assertEquals(reader.nextBatch(),2);
    LongVector longVector=new LongVector(2);
    reader.readVector(0,longVector);
    assertEquals(longVector.isNull[0],false);
    assertEquals(longVector.isNull[1],false);
    assertEquals(longVector.vector[0],123L);
    assertEquals(longVector.vector[1],456L);
    SliceVector stringVector=new SliceVector(2);
    reader.readVector(1,stringVector);
    assertEquals(stringVector.vector[0],utf8Slice("hello"));
    assertEquals(stringVector.vector[1],utf8Slice("bye"));
    assertEquals(reader.nextBatch(),-1);
  }
 }
