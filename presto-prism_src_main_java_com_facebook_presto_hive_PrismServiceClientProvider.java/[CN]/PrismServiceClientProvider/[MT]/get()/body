{
  List<HostAndPort> services=smcLookup.getServices(prismSmcTier);
  if (services.isEmpty()) {
    throw new RuntimeException(format("No prism servers available for tier '%s'",prismSmcTier));
  }
  Throwable lastException=null;
  for (  HostAndPort service : shuffle(services)) {
    try {
      return thriftClient.open(new UnframedClientConnector(service)).get();
    }
 catch (    InterruptedException e) {
      Thread.currentThread().interrupt();
      throw new RuntimeException("Interrupted",e);
    }
catch (    ExecutionException e) {
      lastException=e.getCause();
    }
  }
  throw new RuntimeException("Unable to connect to any prism servers",lastException);
}
