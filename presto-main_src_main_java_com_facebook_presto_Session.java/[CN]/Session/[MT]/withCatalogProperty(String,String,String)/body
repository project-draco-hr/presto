{
  checkNotNull(catalog,"catalog is null");
  checkNotNull(key,"key is null");
  checkNotNull(value,"value is null");
  Map<String,Map<String,String>> catalogProperties=new LinkedHashMap<>(this.catalogProperties);
  Map<String,String> properties=catalogProperties.get(catalog);
  if (properties == null) {
    properties=new LinkedHashMap<>();
  }
 else {
    properties=new LinkedHashMap<>(properties);
  }
  properties.put(key,value);
  catalogProperties.put(catalog,properties);
  return new Session(user,source,catalog,schema,timeZoneKey,locale,remoteUserAddress,userAgent,startTime,systemProperties,catalogProperties);
}
