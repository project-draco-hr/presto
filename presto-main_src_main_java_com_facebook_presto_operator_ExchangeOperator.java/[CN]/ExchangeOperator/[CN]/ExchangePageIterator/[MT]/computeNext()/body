{
  while (true) {
    boolean allClientsComplete=noMoreLocations.get() && completedClients.size() == locations.size();
    if (!allClientsComplete) {
      scheduleRequestIfNecessary();
    }
    operatorStats.setExchangeStatus(getExchangeStatus());
    long start=System.nanoTime();
    try {
      Page page=pageBuffer.poll(WAIT_TIME_IN_MILLIS,TimeUnit.MILLISECONDS);
      if (page != null) {
        operatorStats.addCompletedDataSize(page.getDataSize().toBytes());
        operatorStats.addCompletedPositions(page.getPositionCount());
        return page;
      }
 else       if (allClientsComplete) {
        return endOfData();
      }
    }
 catch (    InterruptedException e) {
      Thread.currentThread().interrupt();
      throw Throwables.propagate(e);
    }
 finally {
      operatorStats.addExchangeWaitTime(Duration.nanosSince(start));
    }
  }
}
