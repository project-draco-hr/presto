{
  final List<File> files=Lists.transform(absoluteFiles,new Function<File,File>(){
    @Override public File apply(    @Nullable File input){
      return new File(input.getAbsolutePath().replace("/Users/martint/fb/presto/presto/",""));
    }
  }
);
  Preconditions.checkArgument(!files.isEmpty(),"no files in stream");
  final StatsCollectingTupleStreamSerde.StatsAnnotatedTupleStreamDeserializer deserializer=new StatsCollectingTupleStreamSerde.StatsAnnotatedTupleStreamDeserializer(SelfDescriptiveSerde.DESERIALIZER);
  Slice slice=mappedFileCache.getUnchecked(files.get(0).getAbsolutePath());
  TupleInfo tupleInfo=deserializer.deserialize(Range.ALL,slice).getTupleInfo();
  return BlockUtils.toBlocks(tupleInfo,Iterables.concat(Lists.transform(files,new Function<File,Iterable<? extends Block>>(){
    private Range range;
    @Override public Iterable<? extends Block> apply(    File file){
      Slice slice=mappedFileCache.getUnchecked(file.getAbsolutePath());
      long rowCount=deserializer.deserializeStats(slice).getRowCount();
      if (range == null) {
        range=Range.create(0,rowCount - 1);
      }
 else {
        range=Range.create(range.getEnd() + 1,range.getEnd() + rowCount);
      }
      return deserializer.deserializeBlocks(range,slice);
    }
  }
)));
}
