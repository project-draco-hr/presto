{
  List<PlanFragment> fragments=plan.getAllFragments();
  Map<PlanFragmentId,PlanFragment> fragmentsById=Maps.uniqueIndex(fragments,PlanFragment.idGetter());
  PlanFragment fragment=plan.getFragment();
  return new PlanPrinter(fragment.getRoot(),fragment.getSymbols(),metadata,Optional.of(fragmentsById)).toString();
}
