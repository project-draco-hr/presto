{
  List<Split> splits=new ArrayList<>(maxSize);
  splits.add(queue.take());
  queue.drainTo(splits,maxSize - 1);
  int finishedIndex=splits.indexOf(FINISHED_MARKER);
  if (finishedIndex >= 0) {
    queue.add(FINISHED_MARKER);
    splits=splits.subList(0,finishedIndex);
  }
  if (throwable.get() != null) {
    if (throwable.get() instanceof FileNotFoundException) {
      throw new PrestoException(HiveErrorCode.HIVE_FILE_NOT_FOUND.toErrorCode(),throwable.get());
    }
    throw new PrestoException(HiveErrorCode.HIVE_UNKNOWN_ERROR.toErrorCode(),throwable.get());
  }
  if (outstandingSplitCount.addAndGet(-splits.size()) < maxOutstandingSplits) {
    suspendingExecutor.resume();
  }
  return splits;
}
