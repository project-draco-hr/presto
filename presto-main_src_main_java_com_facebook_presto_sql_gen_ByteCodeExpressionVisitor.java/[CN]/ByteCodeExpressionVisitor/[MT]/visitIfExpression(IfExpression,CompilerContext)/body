{
  Type type=expressionTypes.get(node);
  TypedByteCodeNode conditionValue=process(node.getCondition(),context);
  TypedByteCodeNode trueValue=process(node.getTrueValue(),context);
  TypedByteCodeNode falseValue;
  if (node.getFalseValue().isPresent()) {
    falseValue=process(node.getFalseValue().get(),context);
  }
 else {
    falseValue=typedNull(context,type.getJavaType());
  }
  if (conditionValue.getType() == void.class) {
    return falseValue;
  }
  checkState(conditionValue.getType() == boolean.class);
  Block condition=new Block(context).comment(node.toString()).append(conditionValue.getNode()).comment("... and condition value was not null").getVariable("wasNull").invokeStatic(Operations.class,"not",boolean.class,boolean.class).invokeStatic(Operations.class,"and",boolean.class,boolean.class,boolean.class).putVariable("wasNull",false);
  return typedByteCodeNode(new IfStatement(context,condition,trueValue.getNode(),falseValue.getNode()),type);
}
