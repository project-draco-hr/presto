{
  counts.ensureCapacity(groupIdsBlock.getGroupCount());
  means.ensureCapacity(groupIdsBlock.getGroupCount());
  m2s.ensureCapacity(groupIdsBlock.getGroupCount());
  BlockCursor values=valuesBlock.cursor();
  OnlineVarianceCalculator calculator=new OnlineVarianceCalculator();
  for (int position=0; position < groupIdsBlock.getPositionCount(); position++) {
    checkState(values.advanceNextPosition());
    if (!values.isNull()) {
      long groupId=groupIdsBlock.getGroupId(position);
      Slice slice=values.getSlice();
      calculator.deserializeFrom(slice,0);
      calculator.merge(counts.get(groupId),means.get(groupId),m2s.get(groupId));
      counts.set(groupId,calculator.getCount());
      means.set(groupId,calculator.getMean());
      m2s.set(groupId,calculator.getM2());
    }
  }
  checkState(!values.advanceNextPosition());
}
