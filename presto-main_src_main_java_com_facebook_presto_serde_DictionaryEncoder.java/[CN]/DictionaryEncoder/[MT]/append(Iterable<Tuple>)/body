{
  checkNotNull(tuples,"tuples is null");
  checkState(!finished,"already finished");
  Iterable<Tuple> idTuples=Iterables.transform(tuples,new Function<Tuple,Tuple>(){
    @Override public Tuple apply(    Tuple tuple){
      if (tupleInfo == null) {
        tupleInfo=tuple.getTupleInfo();
        dictionaryBuilder=new DictionaryBuilder(tupleInfo.getType());
      }
      int key=dictionaryBuilder.putIfAbsent(tuple);
      return createTuple(key);
    }
  }
);
  idWriter.append(idTuples);
  return this;
}
