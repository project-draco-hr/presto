{
  if (reason instanceof CancellationException) {
    return;
  }
  TaskInfo taskInfo=getTaskInfo();
  if (taskInfo.getState().isDone()) {
    return;
  }
  if (isSocketError(reason)) {
    log.warn("Error updating task %s: %s: %s",taskInfo.getTaskId(),reason.getMessage(),taskInfo.getSelf());
  }
 else {
    log.warn(reason,"Error updating task %s: %s",taskInfo.getTaskId(),taskInfo.getSelf());
  }
  if (errorsSinceLastSuccess.size() < 10) {
    errorsSinceLastSuccess.add(reason);
  }
  long errorCount=this.errorCount.incrementAndGet();
  Duration timeSinceLastSuccess=Duration.nanosSince(lastSuccessfulRequest.get());
  if (errorCount > maxConsecutiveErrorCount && timeSinceLastSuccess.compareTo(minErrorDuration) > 0) {
    PrestoException exception=new PrestoException(TOO_MANY_REQUESTS_FAILED.toErrorCode(),format("Encountered too many errors talking to a worker node. The node may have crashed or be under too much load. This is probably a transient issue, so please retry your query in a few minutes (%s - %s failures, time since last success %s)",taskInfo.getSelf(),errorCount,timeSinceLastSuccess.convertToMostSuccinctTimeUnit()));
    for (    Throwable error : errorsSinceLastSuccess) {
      exception.addSuppressed(error);
    }
    failTask(exception);
    cancel();
  }
}
