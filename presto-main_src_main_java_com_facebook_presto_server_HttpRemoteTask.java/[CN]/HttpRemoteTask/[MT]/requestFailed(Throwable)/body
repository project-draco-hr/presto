{
  if (reason instanceof CancellationException) {
    return;
  }
  TaskInfo taskInfo=getTaskInfo();
  if (taskInfo.getState().isDone()) {
    return;
  }
  if (isExpectedError(reason)) {
    log.warn("Error updating task %s: %s: %s",taskInfo.getTaskId(),reason.getMessage(),taskInfo.getSelf());
  }
 else {
    log.warn(reason,"Error updating task %s: %s",taskInfo.getTaskId(),taskInfo.getSelf());
  }
  if (errorsSinceLastSuccess.size() < 10) {
    errorsSinceLastSuccess.add(reason);
  }
  long errorCount=this.errorCount.incrementAndGet();
  Duration timeSinceLastSuccess=Duration.nanosSince(lastSuccessfulRequest.get());
  if (errorCount > maxConsecutiveErrorCount && timeSinceLastSuccess.compareTo(minErrorDuration) > 0) {
    PrestoException exception=new PrestoException(TOO_MANY_REQUESTS_FAILED,format("%s (%s - %s failures, time since last success %s)",WORKER_NODE_ERROR,taskInfo.getSelf(),errorCount,timeSinceLastSuccess.convertTo(TimeUnit.SECONDS)));
    for (    Throwable error : errorsSinceLastSuccess) {
      exception.addSuppressed(error);
    }
    failTask(exception);
    abort();
  }
}
