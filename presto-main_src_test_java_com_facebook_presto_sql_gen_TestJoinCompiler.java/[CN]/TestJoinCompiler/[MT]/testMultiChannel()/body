{
  JoinCompiler joinCompiler=new JoinCompiler();
  PagesHashStrategyFactory pagesHashStrategyFactory=joinCompiler.compilePagesHashStrategy(5,Ints.asList(1,2,3,4));
  List<Block> extraChannel=ImmutableList.of(BlockAssertions.createStringSequenceBlock(10,20),BlockAssertions.createStringSequenceBlock(20,30),BlockAssertions.createStringSequenceBlock(15,25));
  List<Block> varcharChannel=ImmutableList.of(BlockAssertions.createStringSequenceBlock(10,20),BlockAssertions.createStringSequenceBlock(20,30),BlockAssertions.createStringSequenceBlock(15,25));
  List<Block> longChannel=ImmutableList.of(BlockAssertions.createLongSequenceBlock(10,20),BlockAssertions.createLongSequenceBlock(20,30),BlockAssertions.createLongSequenceBlock(15,25));
  List<Block> doubleChannel=ImmutableList.of(BlockAssertions.createDoubleSequenceBlock(10,20),BlockAssertions.createDoubleSequenceBlock(20,30),BlockAssertions.createDoubleSequenceBlock(15,25));
  List<Block> booleanChannel=ImmutableList.of(BlockAssertions.createBooleanSequenceBlock(10,20),BlockAssertions.createBooleanSequenceBlock(20,30),BlockAssertions.createBooleanSequenceBlock(15,25));
  ImmutableList<List<Block>> channels=ImmutableList.of(extraChannel,varcharChannel,longChannel,doubleChannel,booleanChannel);
  PagesHashStrategy hashStrategy=pagesHashStrategyFactory.createPagesHashStrategy(channels);
  assertEquals(hashStrategy.getChannelCount(),5);
  PagesHashStrategy expectedHashStrategy=new SimplePagesHashStrategy(channels,Ints.asList(1,2,3,4));
  for (int leftBlockIndex=0; leftBlockIndex < varcharChannel.size(); leftBlockIndex++) {
    PageBuilder pageBuilder=new PageBuilder(ImmutableList.of(VARCHAR,VARCHAR,BIGINT,DOUBLE,BOOLEAN));
    int leftPositionCount=varcharChannel.get(leftBlockIndex).getPositionCount();
    for (int leftBlockPosition=0; leftBlockPosition < leftPositionCount; leftBlockPosition++) {
      assertEquals(hashStrategy.hashPosition(leftBlockIndex,leftBlockPosition),expectedHashStrategy.hashPosition(leftBlockIndex,leftBlockPosition));
      assertTrue(hashStrategy.positionEqualsPosition(leftBlockIndex,leftBlockPosition,leftBlockIndex,leftBlockPosition));
      for (int rightBlockIndex=0; rightBlockIndex < varcharChannel.size(); rightBlockIndex++) {
        Block rightBlock=varcharChannel.get(rightBlockIndex);
        for (int rightBlockPosition=0; rightBlockPosition < rightBlock.getPositionCount(); rightBlockPosition++) {
          assertEquals(hashStrategy.positionEqualsPosition(leftBlockIndex,leftBlockPosition,rightBlockIndex,rightBlockPosition),expectedHashStrategy.positionEqualsPosition(leftBlockIndex,leftBlockPosition,rightBlockIndex,rightBlockPosition));
        }
      }
      for (int rightBlockIndex=0; rightBlockIndex < varcharChannel.size(); rightBlockIndex++) {
        Block[] rightBlocks=new Block[4];
        rightBlocks[0]=varcharChannel.get(rightBlockIndex);
        rightBlocks[1]=longChannel.get(rightBlockIndex);
        rightBlocks[2]=doubleChannel.get(rightBlockIndex);
        rightBlocks[3]=booleanChannel.get(rightBlockIndex);
        int rightPositionCount=varcharChannel.get(rightBlockIndex).getPositionCount();
        for (int rightPosition=0; rightPosition < rightPositionCount; rightPosition++) {
          assertEquals(hashStrategy.positionEqualsRow(leftBlockIndex,leftBlockPosition,rightPosition,rightBlocks),expectedHashStrategy.positionEqualsRow(leftBlockIndex,leftBlockPosition,rightPosition,rightBlocks));
        }
      }
      hashStrategy.appendTo(leftBlockIndex,leftBlockPosition,pageBuilder,0);
    }
    Page page=pageBuilder.build();
    assertPageEquals(page,new Page(extraChannel.get(leftBlockIndex),varcharChannel.get(leftBlockIndex),longChannel.get(leftBlockIndex),doubleChannel.get(leftBlockIndex),booleanChannel.get(leftBlockIndex)));
  }
}
