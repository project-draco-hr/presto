{
  PhysicalOperation source=node.getSource().accept(this,context);
  FilterFunction filter;
  try {
    Expression filterExpression=node.getPredicate();
    filterExpression=TreeRewriter.rewriteWith(new SymbolToInputRewriter(source.getLayout()),filterExpression);
    filter=compiler.compileFilterFunction(filterExpression,getInputTypes(source.getLayout(),source.getOperator().getTupleInfos()));
  }
 catch (  Exception e) {
    throw Throwables.propagate(e);
  }
  IdentityProjectionInfo mappings=computeIdentityMapping(node.getOutputSymbols(),source.getLayout(),context.getTypes());
  FilterAndProjectOperator operator=new FilterAndProjectOperator(source.getOperator(),filter,mappings.getProjections());
  return new PhysicalOperation(operator,mappings.getOutputLayout());
}
