{
  LocalExecutionPlanContext context=new LocalExecutionPlanContext(session,types,distribution != PlanDistribution.SOURCE);
  PhysicalOperation physicalOperation=enforceLayout(outputLayout,context,plan.accept(new Visitor(session),context));
  DriverFactory driverFactory=new DriverFactory(context.isInputDriver(),true,ImmutableList.<OperatorFactory>builder().addAll(physicalOperation.getOperatorFactories()).add(outputOperatorFactory.createOutputOperator(context.getNextOperatorId(),physicalOperation.getTypes())).build(),context.getDriverInstanceCount());
  context.addDriverFactory(driverFactory);
  return new LocalExecutionPlan(context.getDriverFactories());
}
