{
  if (stateMachine.isDone()) {
    return;
  }
  StageState outputStageState=outputStageInfo.getState();
  if (outputStageState.isDone()) {
    if (outputStageState.isFailure()) {
      stateMachine.fail(failureCause(outputStageInfo));
    }
 else     if (outputStageState == StageState.CANCELED) {
      stateMachine.fail(new PrestoException(USER_CANCELED,"Query was canceled"));
    }
 else {
      stateMachine.finished();
    }
  }
 else   if (stateMachine.getQueryState() == QueryState.STARTING) {
    if (!outputStageInfo.getTasks().isEmpty()) {
      stateMachine.running();
      stateMachine.recordExecutionStart();
    }
  }
}
