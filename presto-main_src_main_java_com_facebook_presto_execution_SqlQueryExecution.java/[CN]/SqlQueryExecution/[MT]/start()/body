{
  try (SetThreadName ignored=new SetThreadName("Query-%s",stateMachine.getQueryId())){
    try {
      if (!stateMachine.transitionToPlanning()) {
        return;
      }
      SubPlan subplan=analyzeQuery();
      planDistribution(subplan);
      if (!stateMachine.transitionToStarting()) {
        return;
      }
      SqlStageExecution stage=outputStage.get();
      if (!stateMachine.isDone()) {
        stage.start();
      }
    }
 catch (    Throwable e) {
      fail(e);
      Throwables.propagateIfInstanceOf(e,Error.class);
    }
  }
 }
