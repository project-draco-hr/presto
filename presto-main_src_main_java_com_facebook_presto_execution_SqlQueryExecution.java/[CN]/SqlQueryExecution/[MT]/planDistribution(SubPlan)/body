{
  long distributedPlanningStart=System.nanoTime();
  DistributedExecutionPlanner distributedPlanner=new DistributedExecutionPlanner(splitManager,getSession(queryInfo));
  StageExecutionPlan outputStageExecutionPlan=distributedPlanner.plan(subplan);
  queryExecutionState.checkQueryState(QueryState.PLANNING);
  updateFieldNames(queryInfo,ImmutableList.copyOf(outputStageExecutionPlan.getFieldNames()));
  SqlStageExecution outputStage=new SqlStageExecution(getQueryId(queryInfo),locationFactory,outputStageExecutionPlan,nodeManager,remoteTaskFactory,getSession(queryInfo),maxPendingSplitsPerNode,queryExecutor);
  SqlQueryExecution.this.outputStage.set(outputStage);
  getQueryStats(queryInfo).recordDistributedPlanningTime(distributedPlanningStart);
}
