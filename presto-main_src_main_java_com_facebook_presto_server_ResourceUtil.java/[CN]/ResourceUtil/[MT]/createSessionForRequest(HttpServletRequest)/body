{
  SessionBuilder sessionBuilder=Session.builder().setUser(getRequiredHeader(servletRequest,PRESTO_USER,"User")).setSource(servletRequest.getHeader(PRESTO_SOURCE)).setCatalog(getRequiredHeader(servletRequest,PRESTO_CATALOG,"Catalog")).setSchema(getRequiredHeader(servletRequest,PRESTO_SCHEMA,"Schema")).setRemoteUserAddress(servletRequest.getRemoteAddr()).setUserAgent(servletRequest.getHeader(USER_AGENT));
  String timeZoneId=servletRequest.getHeader(PRESTO_TIME_ZONE);
  if (timeZoneId != null) {
    sessionBuilder.setTimeZoneKey(getTimeZoneKey(timeZoneId));
  }
  String language=servletRequest.getHeader(PRESTO_LANGUAGE);
  if (language != null) {
    sessionBuilder.setLocale(Locale.forLanguageTag(language));
  }
  Multimap<String,Entry<String,String>> sessionPropertiesByCatalog=HashMultimap.create();
  for (  String sessionHeader : splitSessionHeader(servletRequest.getHeaders(PRESTO_SESSION))) {
    parseSessionHeader(sessionHeader,sessionPropertiesByCatalog);
  }
  sessionBuilder.setSystemProperties(toMap(sessionPropertiesByCatalog.get(null)));
  for (  Entry<String,Collection<Entry<String,String>>> entry : sessionPropertiesByCatalog.asMap().entrySet()) {
    if (entry.getKey() != null) {
      sessionBuilder.setCatalogProperties(entry.getKey(),toMap(entry.getValue()));
    }
  }
  return sessionBuilder.build();
}
