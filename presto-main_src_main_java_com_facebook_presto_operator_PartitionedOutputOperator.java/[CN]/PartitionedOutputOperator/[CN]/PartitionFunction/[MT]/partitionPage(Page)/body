{
  requireNonNull(page,"page is null");
  for (int position=0; position < page.getPositionCount(); position++) {
    if (nullChannel.isPresent() && page.getBlock(nullChannel.getAsInt()).isNull(position)) {
      for (int i=0; i < partitionCount; i++) {
        PageBuilder pageBuilder=pageBuilders.get(i);
        pageBuilder.declarePosition();
        for (int channel=0; channel < sourceTypes.size(); channel++) {
          Type type=sourceTypes.get(channel);
          type.appendTo(page.getBlock(channel),position,pageBuilder.getBlockBuilder(channel));
        }
      }
    }
 else {
      int partitionHashBucket=partitionGenerator.getPartitionBucket(partitionCount,position,page);
      PageBuilder pageBuilder=pageBuilders.get(partitionHashBucket);
      pageBuilder.declarePosition();
      for (int channel=0; channel < sourceTypes.size(); channel++) {
        Type type=sourceTypes.get(channel);
        type.appendTo(page.getBlock(channel),position,pageBuilder.getBlockBuilder(channel));
      }
    }
  }
  return flush(false);
}
