{
  checkNotNull(fields,"fields is null");
  this.allFields=ImmutableList.copyOf(fields);
  this.visibleFields=ImmutableList.copyOf(Iterables.filter(fields,isVisiblePredicate()));
  int index=0;
  ImmutableMap.Builder<Field,Integer> builder=ImmutableMap.builder();
  for (  Field field : fields) {
    builder.put(field,index++);
  }
  fieldIndexes=builder.build();
}
