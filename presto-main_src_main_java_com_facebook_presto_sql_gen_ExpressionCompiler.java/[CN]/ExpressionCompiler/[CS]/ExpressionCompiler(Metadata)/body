{
  this.metadata=metadata;
  this.bootstrapFunctionBinder=new BootstrapFunctionBinder(checkNotNull(metadata,"metadata is null"));
  try {
    ClassDefinition classDefinition=new ClassDefinition(new CompilerContext(null),a(PUBLIC,FINAL),typeFromPathName("Bootstrap" + CLASS_ID.incrementAndGet()),type(Object.class));
    FieldDefinition bootstrapField=classDefinition.declareField(a(PUBLIC,STATIC,FINAL),"BOOTSTRAP",type(AtomicReference.class,BootstrapFunctionBinder.class));
    classDefinition.getClassInitializer().getBody().newObject(AtomicReference.class).dup().invokeConstructor(AtomicReference.class).putStaticField(bootstrapField);
    classDefinition.declareMethod(new CompilerContext(null),a(PUBLIC,STATIC),"bootstrap",type(CallSite.class),arg("lookup",Lookup.class),arg("name",String.class),arg("type",MethodType.class),arg("bindingId",long.class)).getBody().comment("return BOOTSTRAP.get().bootstrap(name, type, bindingId);").getStaticField(bootstrapField).invokeVirtual(AtomicReference.class,"get",Object.class).checkCast(BootstrapFunctionBinder.class).getVariable("name").getVariable("type").getVariable("bindingId").invokeVirtual(BootstrapFunctionBinder.class,"bootstrap",CallSite.class,String.class,MethodType.class,long.class).retObject();
    Class<?> bootstrapClass=defineClass(classDefinition,Object.class,new DynamicClassLoader());
    AtomicReference<BootstrapFunctionBinder> bootstrapReference=(AtomicReference<BootstrapFunctionBinder>)bootstrapClass.getField("BOOTSTRAP").get(null);
    bootstrapReference.set(bootstrapFunctionBinder);
    bootstrapMethod=bootstrapClass.getMethod("bootstrap",Lookup.class,String.class,MethodType.class,long.class);
  }
 catch (  ReflectiveOperationException e) {
    throw Throwables.propagate(e);
  }
}
