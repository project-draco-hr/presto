{
  MethodDefinition filterAndProjectMethod=classDefinition.declareMethod(new CompilerContext(bootstrap.getBootstrapMethod()),a(PUBLIC),"filterAndProjectRowOriented",type(int.class),arg("cursor",RecordCursor.class),arg("pageBuilder",PageBuilder.class));
  CompilerContext compilerContext=filterAndProjectMethod.getCompilerContext();
  LocalVariableDefinition completedPositionsVariable=compilerContext.declareVariable(int.class,"completedPositions");
  filterAndProjectMethod.getBody().comment("int completedPositions = 0;").putVariable(completedPositionsVariable,0);
  LabelNode done=new LabelNode("done");
  ForLoopBuilder forLoop=ForLoop.forLoopBuilder(compilerContext).initialize(NOP).condition(new Block(compilerContext).comment("completedPositions < 16384").getVariable(completedPositionsVariable).push(16384).invokeStatic(CompilerOperations.class,"lessThan",boolean.class,int.class,int.class)).update(new Block(compilerContext).comment("completedPositions++").incrementVariable(completedPositionsVariable,(byte)1));
  Block forLoopBody=new Block(compilerContext);
  forLoop.body(forLoopBody);
  forLoopBody.comment("if (pageBuilder.isFull()) break;").append(new Block(compilerContext).getVariable("pageBuilder").invokeVirtual(PageBuilder.class,"isFull",boolean.class).ifTrueGoto(done));
  forLoopBody.comment("if (!cursor.advanceNextPosition()) break;").append(new Block(compilerContext).getVariable("cursor").invokeInterface(RecordCursor.class,"advanceNextPosition",boolean.class).ifFalseGoto(done));
  IfStatementBuilder ifStatement=new IfStatementBuilder(compilerContext);
  ifStatement.condition(new Block(compilerContext).pushThis().getVariable("cursor").invokeVirtual(classDefinition.getType(),"filter",type(boolean.class),type(RecordCursor.class)));
  Block trueBlock=new Block(compilerContext);
  ifStatement.ifTrue(trueBlock);
  if (projections.isEmpty()) {
    trueBlock.getVariable("pageBuilder").invokeVirtual(PageBuilder.class,"declarePosition",void.class);
  }
 else {
    for (int projectionIndex=0; projectionIndex < projections.size(); projectionIndex++) {
      trueBlock.pushThis();
      trueBlock.getVariable("cursor");
      trueBlock.getVariable("pageBuilder").push(projectionIndex).invokeVirtual(PageBuilder.class,"getBlockBuilder",BlockBuilder.class,int.class);
      trueBlock.invokeVirtual(classDefinition.getType(),"project_" + projectionIndex,type(void.class),type(RecordCursor.class),type(BlockBuilder.class));
    }
  }
  forLoopBody.append(ifStatement.build());
  filterAndProjectMethod.getBody().append(forLoop.build()).visitLabel(done).comment("return completedPositions;").getVariable("completedPositions").retInt();
}
