{
  MethodDefinition filterAndProjectMethod=classDefinition.declareMethod(new CompilerContext(bootstrapMethod),a(PUBLIC),"filterAndProjectRowOriented",type(void.class),arg("cursor",RecordCursor.class),arg("pageBuilder",PageBuilder.class));
  CompilerContext compilerContext=filterAndProjectMethod.getCompilerContext();
  LocalVariableDefinition completedPositionsVariable=compilerContext.declareVariable(long.class,"completedPositions");
  filterAndProjectMethod.getBody().comment("long completedPositions = 0;").putVariable(completedPositionsVariable,0L);
  LabelNode done=new LabelNode("done");
  WhileLoopBuilder whileLoop=WhileLoop.whileLoopBuilder(compilerContext).condition(new Block(compilerContext).getVariable("pageBuilder").invokeVirtual(PageBuilder.class,"isFull",boolean.class).ifNotZeroGoto(done).getVariable("cursor").invokeInterface(RecordCursor.class,"advanceNextPosition",boolean.class));
  Block whileLoopBody=new Block(compilerContext);
  whileLoopBody.comment("completedPositions++").getVariable(completedPositionsVariable).push(1L).invokeStatic(Operations.class,"add",long.class,long.class,long.class).putVariable(completedPositionsVariable);
  whileLoopBody.comment("if (Operations.shouldCheckDone(completedPositions))").append(new IfStatement(compilerContext,new Block(compilerContext).getVariable(completedPositionsVariable).invokeStatic(AbstractFilterAndProjectOperator.class,"shouldCheckDoneFlag",boolean.class,long.class),new Block(compilerContext).comment("if (operatorStats.isDone()) break;").pushThis().getField(operatorStatsField).invokeVirtual(OperatorStats.class,"isDone",boolean.class).ifTrueGoto(done),NOP));
  IfStatementBuilder ifStatement=new IfStatementBuilder(compilerContext);
  ifStatement.condition(new Block(compilerContext).pushThis().getVariable("cursor").invokeVirtual(classDefinition.getType(),"filter",type(boolean.class),type(RecordCursor.class)));
  Block trueBlock=new Block(compilerContext);
  if (projections.isEmpty()) {
    trueBlock.getVariable("pageBuilder").invokeVirtual(PageBuilder.class,"declarePosition",void.class);
  }
 else {
    for (int projectionIndex=0; projectionIndex < projections.size(); projectionIndex++) {
      trueBlock.pushThis();
      trueBlock.getVariable("cursor");
      trueBlock.getVariable("pageBuilder").push(projectionIndex).invokeVirtual(PageBuilder.class,"getBlockBuilder",BlockBuilder.class,int.class);
      trueBlock.invokeVirtual(classDefinition.getType(),"project_" + projectionIndex,type(void.class),type(RecordCursor.class),type(BlockBuilder.class));
    }
  }
  ifStatement.ifTrue(trueBlock);
  whileLoopBody.append(ifStatement.build());
  filterAndProjectMethod.getBody().append(whileLoop.body(whileLoopBody).build()).visitLabel(done);
  LocalVariableDefinition completedDataSizeVariable=compilerContext.declareVariable(long.class,"completedDataSize");
  filterAndProjectMethod.getBody().comment("long completedDataSize = cursor.getCompletedBytes();").getVariable("cursor").invokeInterface(RecordCursor.class,"getCompletedBytes",long.class).putVariable(completedDataSizeVariable);
  Block shouldUpdateCompletedDataSize=new Block(compilerContext).comment("completedDataSize > this.currentCompletedSize").getVariable(completedDataSizeVariable).pushThis().getField(currentCompletedSizeField).invokeStatic(Operations.class,"greaterThan",boolean.class,long.class,long.class);
  Block updateCompletedDataSize=new Block(compilerContext);
  updateCompletedDataSize.comment("operatorStats.addCompletedDataSize(completedDataSize - this.currentCompletedSize);").pushThis().getField(operatorStatsField).getVariable(completedDataSizeVariable).pushThis().getField(currentCompletedSizeField).invokeStatic(Operations.class,"subtract",long.class,long.class,long.class).invokeVirtual(OperatorStats.class,"addCompletedDataSize",void.class,long.class);
  updateCompletedDataSize.comment("this.currentCompletedSize = completedDataSize").pushThis().getVariable(completedDataSizeVariable).putField(currentCompletedSizeField);
  filterAndProjectMethod.getBody().append(new IfStatement(compilerContext,shouldUpdateCompletedDataSize,updateCompletedDataSize,NOP));
  filterAndProjectMethod.getBody().comment("operatorStats.addCompletedPositions(completedPositions);").pushThis().getField(operatorStatsField).getVariable(completedPositionsVariable).invokeVirtual(OperatorStats.class,"addCompletedPositions",void.class,long.class);
  filterAndProjectMethod.getBody().ret();
}
