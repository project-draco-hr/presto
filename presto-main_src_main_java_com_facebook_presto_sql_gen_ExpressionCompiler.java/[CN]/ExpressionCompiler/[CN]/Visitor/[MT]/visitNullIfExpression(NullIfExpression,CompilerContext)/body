{
  TypedByteCodeNode first=process(node.getFirst(),context);
  TypedByteCodeNode second=process(node.getSecond(),context);
  LabelNode end=new LabelNode("end");
  Block block=new Block(context).append(first.node).append(ifWasNullClearAndGoto(context,end,first.type,first.type)).dup(first.type).append(second.node).append(ifWasNullClearAndGoto(context,end,first.type,first.type,first.type,second.type));
  Block conditionBlock=new Block(context).invokeStatic(Operations.class,"equal",boolean.class,first.type,second.type);
  Block trueBlock=new Block(context).loadConstant(true).storeVariable("wasNull").pop(first.type).loadJavaDefault(first.type);
  block.append(new IfStatement(context,conditionBlock,trueBlock,NOP)).visitLabel(end);
  return typedByteCodeNode(block,first.type);
}
