{
  checkNotNull(block,"block is null");
  checkState(!finished,"already finished");
  if (encoding == null) {
    encoding=new RunLengthBlockEncoding(block.getEncoding());
  }
  for (int position=0; position < block.getPositionCount(); position++) {
    if (lastValue == null) {
      lastValue=block.getSingleValueBlock(position);
    }
 else     if (!type.equalTo(lastValue,0,block,position)) {
      writeBlock();
      lastValue=block.getSingleValueBlock(position);
    }
    positionCount++;
  }
  return this;
}
