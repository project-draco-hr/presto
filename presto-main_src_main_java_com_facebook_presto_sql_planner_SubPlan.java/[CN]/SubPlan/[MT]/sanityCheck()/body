{
  Multiset<PlanFragmentId> exchangeIds=IterableTransformer.on(fragment.getSources()).select(instanceOf(ExchangeNode.class)).cast(ExchangeNode.class).transformAndFlatten(ExchangeNode.sourceFragmentIdsGetter()).bag();
  Multiset<PlanFragmentId> childrenIds=IterableTransformer.on(children).transform(SubPlan.fragmentGetter()).transform(PlanFragment.idGetter()).bag();
  Preconditions.checkState(exchangeIds.equals(childrenIds),"Subplan exchange ids don't match child fragment ids (%s vs %s)",exchangeIds,childrenIds);
  for (  SubPlan child : children) {
    child.sanityCheck();
  }
}
