{
  String contentType=response.getHeader("Content-Type");
  if (!com.google.common.net.MediaType.parse(contentType).is(MEDIA_TYPE_JSON)) {
    return new JsonResponse<>(response.getStatusCode(),response.getStatusMessage(),response.getHeaders(),jsonCodec);
  }
  try {
    String json=CharStreams.toString(new InputStreamReader(response.getInputStream(),Charsets.UTF_8));
    return new JsonResponse<>(response.getStatusCode(),response.getStatusMessage(),response.getHeaders(),jsonCodec,json);
  }
 catch (  IOException e) {
    throw new RuntimeException("Error reading JSON response from server",e);
  }
}
