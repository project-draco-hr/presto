{
  if (complete.get()) {
    return new TestingResponse(HttpStatus.GONE,ImmutableListMultimap.<String,String>of(),new byte[0]);
  }
  List<Page> responsePages=new ArrayList<>();
  while (true) {
    Page page=pages.poll();
    if (page == null) {
      break;
    }
    responsePages.add(page);
  }
  if (responsePages.isEmpty()) {
    return new TestingResponse(HttpStatus.NO_CONTENT,ImmutableListMultimap.<String,String>of(),new byte[0]);
  }
  DynamicSliceOutput sliceOutput=new DynamicSliceOutput(64);
  PagesSerde.writePages(sliceOutput,responsePages);
  byte[] bytes=sliceOutput.slice().getBytes();
  return new TestingResponse(HttpStatus.OK,ImmutableListMultimap.of(CONTENT_TYPE,PRESTO_PAGES),bytes);
}
