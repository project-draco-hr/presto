{
  TopicAndPartition topicAndPartition=new TopicAndPartition(partition.getTopicName(),partition.getPartitionIdAsInt());
  PartitionOffsetRequestInfo partitionOffsetRequestInfo=new PartitionOffsetRequestInfo(kafka.api.OffsetRequest.LatestTime(),Integer.MAX_VALUE);
  OffsetRequest offsetRequest=new OffsetRequest(ImmutableMap.of(topicAndPartition,partitionOffsetRequestInfo),kafka.api.OffsetRequest.CurrentVersion(),consumer.clientId());
  OffsetResponse offsetResponse=consumer.getOffsetsBefore(offsetRequest);
  if (offsetResponse.hasError()) {
    short errorCode=offsetResponse.errorCode(partition.getTopicName(),partition.getPartitionIdAsInt());
    log.warn("Offset response has error: %d",errorCode);
    throw new PrestoException(KafkaErrorCode.KAFKA_SPLIT_ERROR.toErrorCode(),"could not fetch data from Kafka, error code is '" + errorCode + "'");
  }
  return offsetResponse.offsets(partition.getTopicName(),partition.getPartitionIdAsInt());
}
