{
  KafkaTableHandle kafkaTableHandle=convertTableHandle(tableHandle);
  ImmutableList.Builder<ConnectorSplit> builder=ImmutableList.builder();
  for (  ConnectorPartition cp : partitions) {
    checkState(cp instanceof KafkaPartition,"Found an unknown partition type: %s",cp.getClass().getSimpleName());
    KafkaPartition partition=(KafkaPartition)cp;
    SimpleConsumer leaderConsumer=consumerManager.getConsumer(partition.getPartitionLeader());
    long[] offsets=findAllOffsets(leaderConsumer,partition);
    for (int i=offsets.length - 1; i > 0; i--) {
      KafkaSplit split=new KafkaSplit(connectorId,partition.getTopicName(),kafkaTableHandle.getKeyDataFormat(),kafkaTableHandle.getMessageDataFormat(),partition.getPartitionIdAsInt(),offsets[i],offsets[i - 1],partition.getPartitionNodes());
      builder.add(split);
    }
  }
  return new FixedSplitSource(connectorId,builder.build());
}
