{
  int bytesRead=0;
  byte[] bytes=new byte[4096];
  while (bytesRead < length) {
    int newBytes=in.read(bytes);
    if (newBytes < 0) {
      break;
    }
    dataOutputStream.write(bytes,0,Math.min(newBytes,length - bytesRead));
    bytesRead+=newBytes;
  }
  return bytesRead;
}
