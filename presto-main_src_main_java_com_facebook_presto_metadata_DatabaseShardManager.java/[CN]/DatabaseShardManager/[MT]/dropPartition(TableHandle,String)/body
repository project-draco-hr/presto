{
  checkNotNull(tableHandle,"tableHandle is null");
  checkState(tableHandle.getDataSourceType() == DataSourceType.NATIVE,"can only commit partitions for native tables");
  final long tableId=((NativeTableHandle)tableHandle).getTableId();
  dbi.inTransaction(new VoidTransactionCallback(){
    @Override protected void execute(    Handle handle,    TransactionStatus status) throws Exception {
      ShardManagerDao dao=handle.attach(ShardManagerDao.class);
      List<Long> shardIds=dao.getAllShards(tableId,partitionName);
      for (      Long shardId : shardIds) {
        dao.deleteShardFromShardNodes(shardId);
        dao.deleteShardFromPartitionShards(shardId);
        dao.deleteShard(shardId);
      }
      dao.dropPartition(tableId,partitionName);
    }
  }
);
}
