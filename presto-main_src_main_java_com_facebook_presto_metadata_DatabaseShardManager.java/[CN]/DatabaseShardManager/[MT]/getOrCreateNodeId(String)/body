{
  Long id=dao.getNodeId(nodeIdentifier);
  if (id != null) {
    return id;
  }
  runIgnoringConstraintViolation(new Runnable(){
    @Override public void run(){
      dao.insertNode(nodeIdentifier);
    }
  }
);
  id=dao.getNodeId(nodeIdentifier);
  if (id == null) {
    throw new IllegalStateException("node does not exist after insert");
  }
  return id;
}
