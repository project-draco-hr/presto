{
  channelCount=iterator.getChannelCount();
  indexes=new ChannelIndex[channelCount];
  List<TupleInfo> tupleInfos=iterator.getTupleInfos();
  for (int channel=0; channel < indexes.length; channel++) {
    indexes[channel]=new ChannelIndex(expectedPositions,tupleInfos.get(channel));
  }
  long currentSize=0;
  int positionCount=0;
  try (PageIterator pageIterator=iterator){
    while (pageIterator.hasNext()) {
      if (operatorStats.isDone()) {
        break;
      }
      currentSize=taskMemoryManager.updateOperatorReservation(currentSize,getEstimatedSize());
      Page page=pageIterator.next();
      positionCount+=page.getPositionCount();
      Block[] blocks=page.getBlocks();
      for (int channel=0; channel < indexes.length; channel++) {
        indexes[channel].indexBlock((UncompressedBlock)blocks[channel]);
      }
    }
  }
   this.positionCount=positionCount;
}
